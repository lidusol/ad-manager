!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@alyle/ui"),require("rxjs"),require("rxjs/operators"),require("@angular/cdk/platform"),require("@angular/common"),require("@angular/cdk/scrolling")):"function"==typeof define&&define.amd?define("@alyle/ui/image-cropper",["exports","@angular/core","@alyle/ui","rxjs","rxjs/operators","@angular/cdk/platform","@angular/common","@angular/cdk/scrolling"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).ly=t.ly||{},t.ly["image-Cropper"]={}),t.ng.core,t.ly.core,t.rxjs,t.rxjs.operators,t.ng.cdk.platform,t.ng.common,t.ng.cdk.scrolling)}(this,(function(t,e,i,r,n,o,a,s){"use strict";function h(t,e,i){for(var r=t.width,n=t.height,o=r/(e=Math.round(e)),a=n/(i=Math.round(i)),s=Math.ceil(o/2),h=Math.ceil(a/2),c=t.getContext("2d"),l=c.getImageData(0,0,r,n),p=c.createImageData(e,i),u=l.data,d=p.data,g=0;g<i;g++)for(var m=0;m<e;m++){var f=4*(m+g*e),_=0,v=0,y=0,w=0,b=0,x=0,E=0,C=g*a,S=Math.floor(m*o),R=Math.ceil((m+1)*o),M=Math.floor(g*a),I=Math.ceil((g+1)*a);R=Math.min(R,r),I=Math.min(I,n);for(var O=M;O<I;O++)for(var L=Math.abs(C-O)/h,A=m*o,P=L*L,D=S;D<R;D++){var z=Math.abs(A-D)/s,k=Math.sqrt(P+z*z);if(!(k>=1)){var F=4*(D+O*r);E+=(_=2*k*k*k-3*k*k+1)*u[F+3],y+=_,u[F+3]<255&&(_=_*u[F+3]/250),w+=_*u[F],b+=_*u[F+1],x+=_*u[F+2],v+=_}}d[f]=w/v,d[f+1]=b/v,d[f+2]=x/v,d[f+3]=E/y}return t.width=e,t.height=i,c.putImageData(p,0,0),c}var c,l,p=o.normalizePassiveListenerOptions({passive:!1}),u=function(t,e){var r=e.selectorsOf(u),n=t.after;return{$name:g.и,$priority:-2,root:function(){return function(e){return e+"{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:flex;overflow:hidden;position:relative;justify-content:center;align-items:center;}"+i.st2c(t.cropper&&t.cropper.root&&(t.cropper.root instanceof i.StyleCollection?t.cropper.root.setTransformer((function(t){return t(r)})):t.cropper.root(r)),""+e)}},imgContainer:function(t){return t+"{cursor:move;position:absolute;top:0;left:0;display:flex;touch-action:none;}"+t+" > canvas{display:block;}"},overlay:function(t){return""+i.st2c(i.LY_COMMON_STYLES.fill,""+t)},area:function(t){return t+"{pointer-events:none;box-shadow:0 0 0 20000px rgba(0, 0, 0, 0.4);margin:auto;}"+i.st2c(i.LY_COMMON_STYLES.fill,""+t)+i.st2c(i.LY_COMMON_STYLES.fill,t+":before,"+t+":after")+t+":before,"+t+":after{content:'';}"+t+":before{width:0;height:0;margin:auto;border-radius:50%;background:#fff;border:solid 2px rgb(255, 255, 255);}"+t+":after{border:solid 2px rgb(255, 255, 255);border-radius:inherit;}"},resizer:function(t){return t+"{width:10px;height:10px;background:#fff;border-radius:3px;position:absolute;touch-action:none;bottom:0;"+n+":0;pointer-events:all;cursor:"+("right"===n?"nwse-resize":"nesw-resize")+";}"+i.st2c(i.LY_COMMON_STYLES.fill,t+":before")+t+":before{content:'';width:20px;height:20px;transform:translate(-25%, -25%);}"},defaultContent:function(t){return t+"{display:flex;align-items:center;justify-content:center;}"+i.st2c(i.LY_COMMON_STYLES.fill,t+","+t+" > input")+t+" *:not(input){pointer-events:none;}"+t+" > input{background:transparent;opacity:0;width:100%;height:100%;}"}}},d=function(){this.width=250,this.height=200,this.minWidth=40,this.minHeight=40,this.antiAliased=!0,this.output=t.ImgResolution.Default};(c=t.ImgResolution||(t.ImgResolution={}))[c.Default=0]="Default",c[c.OriginalImage=1]="OriginalImage",(l=t.ImgCropperError||(t.ImgCropperError={}))[l.Size=0]="Size",l[l.Type=1]="Type",l[l.Other=2]="Other";var g=function(){function o(t,i,o,a,s,h,c){var l=this;this.sRenderer=t,this._renderer=i,this._elementRef=o,this.cd=a,this._ngZone=s,this.classes=this.sRenderer.renderSheet(u,!0),this._imgRect={},this._rotation=0,this.scaleChange=new e.EventEmitter,this.minScaleChange=new e.EventEmitter,this.maxScaleChange=new e.EventEmitter,this.loaded=new e.EventEmitter,this.imageLoaded=new e.EventEmitter,this.ready=new e.EventEmitter,this.cropped=new e.EventEmitter,this.cleaned=new e.EventEmitter,this.error=new e.EventEmitter,this._destroy=new r.Subject,this._pointerDown=function(t){l._isSliding||!_(t)&&0!==t.button||l._ngZone.run((function(){l._isSliding=!0,l.offset={x:l._imgRect.x,y:l._imgRect.y,left:l._imgRect.xc,top:l._imgRect.yc},l._lastPointerEvent=t,l._startPointerEvent=f(t),t.preventDefault(),l._bindGlobalEvents(t)}))},this._pointerMove=function(t){if(l._isSliding){t.preventDefault(),l._lastPointerEvent=t;var e=void 0,i=void 0,r=l._imgCanvas.nativeElement,n=l._scal3Fix,o=l.config,a=l.offset,s=f(t),h=s.x-l._startPointerEvent.x,c=s.y-l._startPointerEvent.y;if(!n||!a)return;var p=r.height*n<o.height&&o.extraZoomOut,u=r.width*n<o.width&&o.extraZoomOut,d=o.width/2/n>=a.left-h/n,g=o.width/2/n+r.width-(a.left-h/n)<=o.width/n,m=o.height/2/n>=a.top-c/n,_=o.height/2/n+r.height-(a.top-c/n)<=o.height/n;(d&&!u||!d&&u)&&(e=a.x+a.left-o.width/2/n),(g&&!u||!g&&u)&&(e=a.x+a.left+o.width/2/n-r.width),(m&&!p||!m&&p)&&(i=a.y+a.top-o.height/2/n),(_&&!p||!_&&p)&&(i=a.y+a.top+o.height/2/n-r.height),void 0===e&&(e=h/n+a.x),void 0===i&&(i=c/n+a.y),l._setStylesForContImg({x:e,y:i})}},this._pointerUp=function(t){l._isSliding&&(t.preventDefault(),l._removeGlobalEvents(),l._isSliding=!1,l._startPointerEvent=null,l._cropIfAutoCrop())},this._windowBlur=function(){l._lastPointerEvent&&l._pointerUp(l._lastPointerEvent)},this._document=h,c.change().pipe(n.takeUntil(this._destroy)).subscribe((function(){return l._ngZone.run((function(){return l.updateCropperPosition()}))}))}return Object.defineProperty(o.prototype,"config",{get:function(){return this._config},set:function(t){if(this._config=i.mergeDeep({},new d,t),this._configPrimary=i.mergeDeep({},this._config),this._primaryAreaWidth=this.config.width,this._primaryAreaHeight=this.config.height,this._config.round&&this.config.width!==this.config.height)throw new Error(o.и+": Both width and height must be equal when using `ImgCropperConfig.round = true`");var e=this._config.maxFileSize;e&&(this.maxFileSize=e)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"scale",{get:function(){return this._scale},set:function(t){this.setScale(t)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"minScale",{get:function(){return this._minScale},enumerable:!1,configurable:!0}),o.prototype.ngOnInit=function(){var t=this;this._ngZone.runOutsideAngular((function(){var e=t._imgContainer.nativeElement;e.addEventListener("mousedown",t._pointerDown,p),e.addEventListener("touchstart",t._pointerDown,p)}))},o.prototype.ngOnDestroy=function(){this._destroy.next(),this._destroy.complete();var t=this._imgContainer.nativeElement;this._lastPointerEvent=null,this._removeGlobalEvents(),t.removeEventListener("mousedown",this._pointerDown,p),t.removeEventListener("touchstart",this._pointerDown,p)},o.prototype._imgLoaded=function(t){if(t){this._img=t;var e=this._imgCanvas.nativeElement;e.width=t.width,e.height=t.height;var i=e.getContext("2d");i.clearRect(0,0,t.width,t.height),i.drawImage(t,0,0),this._updateMinScale(e),this._updateMaxScale()}},o.prototype._setStylesForContImg=function(t){var e={};if(null!=t.x&&null!=t.y){var i=this._rootRect(),r=i.width/2-t.x,n=i.height/2-t.y;this._imgRect.x=t.x,this._imgRect.y=t.y,this._imgRect.xc=r,this._imgRect.yc=n}for(var o in e.transform="translate3d("+this._imgRect.x+"px,"+this._imgRect.y+"px, 0)",e.transform+="scale("+this._scal3Fix+")",e.transformOrigin=this._imgRect.xc+"px "+this._imgRect.yc+"px 0",e["-webkit-transform"]=e.transform,e["-webkit-transform-origin"]=e.transformOrigin,e)e.hasOwnProperty(o)&&this._renderer.setStyle(this._imgContainer.nativeElement,o,e[o])},o.prototype.updateCropperPosition=function(){this.isLoaded&&(this.updatePosition(),this._updateAreaIfNeeded())},o.prototype.selectInputEvent=function(e){var i=this;this._currentInputElement=e.target;var o=e.target;if(!o.files||1===o.files.length){var a=o.files[0].size,s=o.value.replace(/.*(\/|\\)/,"");if(this.maxFileSize&&a>this.maxFileSize){var h={name:s,type:o.files[0].type,size:a,error:t.ImgCropperError.Size};return this.clean(),void this.error.emit(h)}new r.Observable((function(t){var e=new FileReader;e.onerror=function(e){return t.error(e)},e.onabort=function(e){return t.error(e)},e.onload=function(e){return setTimeout((function(){t.next(e),t.complete()}))},e.readAsDataURL(o.files[0])})).pipe(n.take(1),n.takeUntil(this._destroy)).subscribe((function(t){var e=t.target.result;i.loadImage({name:s,size:o.files[0].size,type:i.config.type||o.files[0].type,originalDataURL:e}),i.cd.markForCheck()}),(function(){var e={name:s,size:a,error:t.ImgCropperError.Other,errorMsg:"The File could not be loaded.",type:o.files[0].type};i.clean(),i.error.emit(e)}))}},o.prototype.setScale=function(t,e){var i=t>=this.minScale&&t<=1?t:this.minScale,r=null!=t&&t!==this.scale&&i!==this.scale;if(this._scale=t,r){if(this._scal3Fix=i,this._updateAbsoluteScale(),this.isLoaded){if(!r)return;var n=Object.assign({},this._imgRect);this.offset={x:n.x,y:n.y,left:n.xc,top:n.yc},this._setStylesForContImg({}),this._simulatePointerMove()}else{if(!this.minScale)return;this._setStylesForContImg(Object.assign({},this._getCenterPoints()))}this.scaleChange.emit(t),e||this._cropIfAutoCrop()}},o.prototype._getCenterPoints=function(){var t=this._elementRef.nativeElement,e=this._imgCanvas.nativeElement;return{x:(t.offsetWidth-e.width)/2,y:(t.offsetHeight-e.height)/2}},o.prototype.fitToScreen=function(){var t=this._elementRef.nativeElement,e=t.offsetWidth,i=t.offsetHeight,r=this._img,n={width:e/r.width,height:i/r.height},o=Math.max(n.width,n.height);this.setScale(o)},o.prototype.fit=function(){this.setScale(this.minScale)},o.prototype._simulatePointerMove=function(){this._isSliding=!0,this._startPointerEvent={x:0,y:0},this._pointerMove({clientX:0,clientY:0,type:"n",preventDefault:function(){}}),this._isSliding=!1,this._startPointerEvent=null},o.prototype._markForCheck=function(){this.cd.markForCheck()},o.prototype.updatePosition=function(t,e){var i,r,n=this._rootRect(),o=this._areaCropperRect(),a=o.width>n.width?n.width:o.width,s=o.height>n.height?n.height:o.height;null==t&&null==e&&(t=this._imgRect.xc,e=this._imgRect.yc),i=o.left-n.left,r=o.top-n.top,i-=t-a/2,r-=e-s/2,this._setStylesForContImg({x:i,y:r})},o.prototype._slideEnd=function(){this._cropIfAutoCrop()},o.prototype._cropIfAutoCrop=function(){this.config.autoCrop&&this.crop()},o.prototype.zoomIn=function(){var t=this._scal3Fix+.05;t>this.minScale&&t<=this._maxScale?this.setScale(t):this.setScale(this._maxScale)},o.prototype.clean=function(){if(this._currentInputElement&&(this._currentInputElement.value="",this._currentInputElement=null),this.isLoaded){this._imgRect={},this.offset=void 0,this.scale=void 0,this._scal3Fix=void 0,this._rotation=0,this._minScale=void 0,this._isLoadedImg=!1,this.isLoaded=!1,this.isCropped=!1,this._currentLoadConfig=void 0,this.config=this._configPrimary;var t=this._imgCanvas.nativeElement;t.width=0,t.height=0,this.cleaned.emit(null),this.cd.markForCheck()}},o.prototype.zoomOut=function(){var t=this._scal3Fix-.05;t>this.minScale&&t<=this._maxScale?this.setScale(t):this.fit()},o.prototype.center=function(){var t=Object.assign({},this._getCenterPoints());this._setStylesForContImg(t),this._cropIfAutoCrop()},o.prototype.loadImage=function(e,i){var o=this;this.clean();var a=this._currentLoadConfig="string"==typeof e?{originalDataURL:e}:Object.assign({},e),s=a.originalDataURL;this._primaryAreaWidth=this._configPrimary.width,this._primaryAreaHeight=this._configPrimary.height,a.areaWidth&&a.areaHeight&&(this.config.width=a.areaWidth,this.config.height=a.areaHeight);var h=function(t){var e=new Image;return e.crossOrigin="anonymous",e.src=t,e}(s=function(t){if(window.atob&&(c=t,c.startsWith("data:image/svg+xml;base64,"))){var e=t.length/5,i=window.atob(t.replace("data:image/svg+xml;base64,","")),r=document.createElement("span");r.innerHTML=i;var n=r.querySelector("svg");r.setAttribute("style","display:none"),document.body.appendChild(r);var o=parseFloat(getComputedStyle(n).width)||1,a=parseFloat(getComputedStyle(n).height)||1,s=Math.max(o,a);n.setAttribute("width",e/(o/s)+"px"),n.setAttribute("height",e/(a/s)+"px");var h="data:image/svg+xml;base64,"+window.btoa(r.innerHTML);return document.body.removeChild(r),h}var c;return t}(s)),c=Object.assign({},a);new r.Observable((function(t){h.onerror=function(e){return t.error(e)},h.onabort=function(e){return t.error(e)},h.onload=function(){return t.next(null)}})).pipe(n.take(1),n.takeUntil(this._destroy)).subscribe((function(){o._imgLoaded(h),o._isLoadedImg=!0,o.imageLoaded.emit(c),o.cd.markForCheck(),o._ngZone.runOutsideAngular((function(){o._ngZone.onStable.asObservable().pipe(n.take(1),n.takeUntil(o._destroy)).subscribe((function(){return setTimeout((function(){return o._ngZone.run((function(){return o._positionImg(c,i)}))}))}))}))}),(function(){var e={name:a.name,error:t.ImgCropperError.Type,type:a.type,size:a.size};o.error.emit(e)}))},o.prototype._updateAreaIfNeeded=function(){if(this._config.responsiveArea){var t=this._rootRect(),e=this._areaCropperRect(),i=this.config.minWidth||1,r=this.config.minHeight||1;if(e.width>t.width||e.height>t.height||e.width<this._primaryAreaWidth||e.height<this._primaryAreaHeight){var n=Math.max(this.config.width,i),o=Math.max(t.width,i),a=Math.min(Math.max(t.width,i),Math.max(t.height,r)),s=this._scal3Fix,h=0;this.config.round?this.config.width=this.config.height=a:n===e.width&&(o>this._primaryAreaWidth?(this.config.width=this._primaryAreaWidth,this.config.height=this._primaryAreaWidth*e.height/e.width,h=s*this._primaryAreaWidth/e.width):(this.config.width=o,this.config.height=o*e.height/e.width,h=s*o/e.width),this._updateMinScale(),this._updateMaxScale(),this.setScale(h,!0),this._markForCheck())}}},o.prototype._updateAbsoluteScale=function(){var t=this._scal3Fix/(this.config.width/this._primaryAreaWidth);this._absoluteScale=t},o.prototype.setImageUrl=function(t,e){this.loadImage(t,e)},o.prototype._positionImg=function(t,e){var i=this,r=this._currentLoadConfig;this._updateMinScale(this._imgCanvas.nativeElement),this._updateMaxScale(),this.isLoaded=!1,e?e():(r.scale?this.setScale(r.scale,!0):this.setScale(this.minScale,!0),this.rotate(r.rotation||0),this._updateAreaIfNeeded(),this._markForCheck(),this._ngZone.runOutsideAngular((function(){i._ngZone.onStable.asObservable().pipe(n.take(1),n.takeUntil(i._destroy)).subscribe((function(){null!=r.xOrigin&&null!=r.yOrigin&&i.updatePosition(r.xOrigin,r.yOrigin),i._updateAreaIfNeeded(),i.isLoaded=!0,i._cropIfAutoCrop(),i._ngZone.run((function(){i._markForCheck(),i.ready.emit(t),i.loaded.emit(t)}))}))})))},o.prototype.rotate=function(t){var e=m(t);e<0&&(e+=360);var i=m((this._rotation||0)+e);if(i!==this._rotation){var r,n,o,a=e*Math.PI/180,s=this._imgCanvas.nativeElement,h=(r=s,n=document.createElement("canvas"),o=n.getContext("2d"),n.width=r.width,n.height=r.height,o.drawImage(r,0,0),n),c=s.getContext("2d");this._rotation=i,c.clearRect(0,0,h.width,h.height);var l="rotate("+e+"deg) scale("+1/this._scal3Fix+")",p=this._imgRect.xc+"px "+this._imgRect.yc+"px 0";s.style.transform=l,s.style.webkitTransform=l,s.style.transformOrigin=p,s.style.webkitTransformOrigin=p;var u=s.getBoundingClientRect(),d=u.left,g=u.top,f=s.getBoundingClientRect();s.removeAttribute("style");var _=f.width,v=f.height;c.canvas.width=_,c.canvas.height=v,c.clearRect(0,0,_,v),c.translate(_/2,v/2),c.rotate(a),c.drawImage(h,-h.width/2,-h.height/2),this._updateMinScale(s),this._updateMaxScale(),this.scale<this.minScale&&this.setScale(0,!0);var y=this._rootRect();this._setStylesForContImg({x:d-y.left,y:g-y.top});var w=Object.assign({},this._imgRect);this.offset={x:w.x,y:w.y,left:w.xc,top:w.yc},this._setStylesForContImg({}),this._simulatePointerMove(),this._cropIfAutoCrop()}},o.prototype._updateMinScale=function(t){t||(t=this._imgCanvas.nativeElement);var e=this.config,i=(e.extraZoomOut?Math.min:Math.max)(e.width/t.width,e.height/t.height);this._minScale=i,this.minScaleChange.emit(i)},o.prototype._updateMaxScale=function(){var t=this.config.width/this._primaryAreaWidth;this._maxScale=t,this.maxScaleChange.emit(t)},o.prototype.crop=function(t){var e=t?i.mergeDeep({},this.config||new d,t):this.config,r=this._imgCrop(e);return this.cd.markForCheck(),r},o.prototype._imgCrop=function(e){var i=document.createElement("canvas"),r=this._areaCropperRect(),n=this._canvasRect(),o=this._scal3Fix,a=(r.left-n.left)/o,s=(r.top-n.top)/o,c=e.output,l=this._currentLoadConfig,p=e.width,u=e.height;i.width=p/o,i.height=u/o;var d=i.getContext("2d");e.fill&&(d.fillStyle=e.fill,d.fillRect(0,0,i.width,i.height)),d.drawImage(this._imgCanvas.nativeElement,-a,-s);var g=i;if(e.output===t.ImgResolution.Default)h(g,this._configPrimary.width,this._configPrimary.height);else if("object"==typeof c)if(c.width&&c.height)h(g,c.width,c.height);else if(c.width){var m=u*c.width/p;h(g,c.width,m)}else if(c.height){h(g,p*c.height/u,c.height)}var f=l.originalDataURL.startsWith("http")?l.type||e.type:e.type||l.type,_={dataURL:g.toDataURL(f),type:f,name:l.name,areaWidth:this._primaryAreaWidth,areaHeight:this._primaryAreaHeight,width:g.width,height:g.height,originalDataURL:l.originalDataURL,scale:this._absoluteScale,rotation:this._rotation,left:(r.left-n.left)/this._scal3Fix,top:(r.top-n.top)/this._scal3Fix,size:l.size,xOrigin:this._imgRect.xc,yOrigin:this._imgRect.yc,position:{x:this._imgRect.xc,y:this._imgRect.yc}};return this.isCropped=!0,this.cropped.emit(_),_},o.prototype._rootRect=function(){return this._elementRef.nativeElement.getBoundingClientRect()},o.prototype._areaCropperRect=function(){return this._areaRef.nativeElement.getBoundingClientRect()},o.prototype._canvasRect=function(){return this._imgCanvas.nativeElement.getBoundingClientRect()},o.prototype._bindGlobalEvents=function(t){var e=this._document,i=_(t),r=i?"touchmove":"mousemove",n=i?"touchend":"mouseup";e.addEventListener(r,this._pointerMove,p),e.addEventListener(n,this._pointerUp,p),i&&e.addEventListener("touchcancel",this._pointerUp,p);var o=this._getWindow();void 0!==o&&o&&o.addEventListener("blur",this._windowBlur)},o.prototype._removeGlobalEvents=function(){var t=this._document;t.removeEventListener("mousemove",this._pointerMove,p),t.removeEventListener("mouseup",this._pointerUp,p),t.removeEventListener("touchmove",this._pointerMove,p),t.removeEventListener("touchend",this._pointerUp,p),t.removeEventListener("touchcancel",this._pointerUp,p);var e=this._getWindow();void 0!==e&&e&&e.removeEventListener("blur",this._windowBlur)},o.prototype._getWindow=function(){return this._document.defaultView||window},o}();function m(t){var e=t%360;if(e%90)throw new Error("LyCropper: Invalid `"+t+"` degree, only accepted values: 0, 90, 180, 270 & 360.");return e}g.и="LyImageCropper",g.decorators=[{type:e.Component,args:[{changeDetection:e.ChangeDetectionStrategy.OnPush,preserveWhitespaces:!1,selector:"ly-img-cropper, ly-image-cropper",template:'\x3c!-- (selectstart): On Safari starting to slide temporarily triggers text selection mode which\nshow the wrong cursor. We prevent it by stopping the `selectstart` event. --\x3e\n<div #_imgContainer\n  [className]="classes.imgContainer"\n  (selectstart)="$event.preventDefault()"\n>\n  <canvas #_imgCanvas></canvas>\n</div>\n<ly-cropper-area #_area\n  [round]="!!config.round"\n  [resizableArea]="!!config.resizableArea"\n  [keepAspectRatio]="!!config.keepAspectRatio"\n  *ngIf="_isLoadedImg; else content"\n  [ngStyle]="{\n    width: config.width + \'px\',\n    height: config.height + \'px\'\n  }"></ly-cropper-area>\n<ng-template #content>\n  <div [className]="classes.defaultContent">\n    <input #_fileInput type="file" (change)="selectInputEvent($event)" accept="image/*">\n    <ng-content></ng-content>\n  </div>\n</ng-template>\n',providers:[i.StyleRenderer]}]}],g.ctorParameters=function(){return[{type:i.StyleRenderer},{type:e.Renderer2},{type:e.ElementRef},{type:e.ChangeDetectorRef},{type:e.NgZone},{type:void 0,decorators:[{type:e.Inject,args:[a.DOCUMENT]}]},{type:s.ViewportRuler}]},g.propDecorators={_imgContainer:[{type:e.ViewChild,args:["_imgContainer",{static:!0}]}],_areaRef:[{type:e.ViewChild,args:["_area",{read:e.ElementRef}]}],_imgCanvas:[{type:e.ViewChild,args:["_imgCanvas",{static:!0}]}],config:[{type:e.Input}],scale:[{type:e.Input}],maxFileSize:[{type:e.Input}],scaleChange:[{type:e.Output}],minScaleChange:[{type:e.Output,args:["minScale"]}],maxScaleChange:[{type:e.Output,args:["maxScale"]}],loaded:[{type:e.Output}],imageLoaded:[{type:e.Output}],ready:[{type:e.Output}],cropped:[{type:e.Output}],cleaned:[{type:e.Output}],error:[{type:e.Output}]};function f(t){var e=_(t)?t.touches[0]||t.changedTouches[0]:t;return{x:e.clientX,y:e.clientY}}function _(t){return"t"===t.type[0]}Object.create;function v(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,n,o=i.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return a}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(v(arguments[e]));return t}Object.create;var w=o.normalizePassiveListenerOptions({passive:!1}),b=(100*Math.sqrt(2)-100)/2/Math.sqrt(2),x=function(){function t(t,e,i,r,n){var o=this;this.sRenderer=t,this._elementRef=e,this._ngZone=i,this._cropper=r,this.classes=this.sRenderer.renderSheet(u,"area"),this._pointerDown=function(t){o._isSliding||!C(t)&&0!==t.button||(t.preventDefault(),o._ngZone.run((function(){o._isSliding=!0,o._lastPointerEvent=t,o._startPointerEvent=E(t),o._startAreaRect=o._cropper._areaCropperRect(),o._startImgRect=o._cropper._canvasRect(),t.preventDefault(),o._bindGlobalEvents(t)})))},this._pointerMove=function(t){if(o._isSliding){t.preventDefault(),o._lastPointerEvent=t;var e=o._elementRef.nativeElement,i=o._cropper.config,r=i.width,n=i.height,a=i.minWidth,s=i.minHeight,h=E(t),c=h.x-o._startPointerEvent.x,l=h.y-o._startPointerEvent.y,p=o._startAreaRect,u=o._startImgRect,d=o.round,g=o._cropper.config.keepAspectRatio||t.shiftKey,m=0,f=0,_=o._cropper._rootRect();if(d){var v=r/2/Math.sqrt(2)+c,w=n/2/Math.sqrt(2)+l;m=f=2*Math.sqrt(Math.pow(v,2)+Math.pow(w,2))}else g?(m=r+2*c,f=n+2*l,r!==n?r>n?f=n/(r/m):n>r&&(m=r/(n/f)):m=f=Math.max(m,f)):(m=r+2*c,f=n+2*l);m<a&&(m=a),f<s&&(f=s);var b=p.x+p.width/2,x=p.y+p.height/2,C=u.y>x-f/2,S=x+f/2>u.bottom,R=Math.min(2*(x-u.y),2*(u.bottom-x)),M=u.x>b-m/2,I=b+m/2>u.right,O=Math.min(2*(b-u.x),2*(u.right-b)),L=Math.min(O,R);if(d)(C||S||M||I)&&(f=m=L);else if(g){var A=[],P=[];(C||S)&&Math.min()&&(f=R,P.push(f),m=r/(n/R),A.push(m)),(M||I)&&(m=O,A.push(m),f=n/(r/O),P.push(f)),2===A.length&&(m=Math.min.apply(Math,y(A))),2===P.length&&(f=Math.min.apply(Math,y(P)))}else(C||S)&&(f=R),(M||I)&&(m=O);if(d){var D=Math.min(_.width,_.height);(m>D||f>D)&&(m=f=D)}else g?m>_.width?(m=_.width,f=n/(r/_.width)):f>_.height&&(m=r/(n/_.height),f=_.height):m>_.width?m=_.width:f>_.height&&(f=_.height);m=Math.round(m),f=Math.round(f),e.style.width=m+"px",e.style.height=f+"px",o._currentWidth=m,o._currentHeight=f}},this._pointerUp=function(t){o._isSliding&&(t.preventDefault(),o._removeGlobalEvents(),o._cropper._primaryAreaWidth=o._cropper.config.width=o._currentWidth,o._cropper._primaryAreaHeight=o._cropper.config.height=o._currentHeight,o._cropper.config=o._cropper.config,o._cropper._updateMinScale(),o._isSliding=!1,o._startPointerEvent=null)},this._windowBlur=function(){o._lastPointerEvent&&o._pointerUp(o._lastPointerEvent)},this._document=n}return Object.defineProperty(t.prototype,"resizableArea",{get:function(){return this._resizableArea},set:function(t){var e=this;t!==this._resizableArea&&(this._resizableArea=t,Promise.resolve(null).then((function(){t?(e._removeResizableArea(),e._addResizableArea()):e._removeResizableArea()})))},enumerable:!1,configurable:!0}),t.prototype.ngOnDestroy=function(){this._removeResizableArea()},t.prototype._addResizableArea=function(){var t=this;this._ngZone.runOutsideAngular((function(){var e=t._resizer.nativeElement;e.addEventListener("mousedown",t._pointerDown,w),e.addEventListener("touchstart",t._pointerDown,w)}))},t.prototype._removeResizableArea=function(){var t,e=null===(t=this._resizer)||void 0===t?void 0:t.nativeElement;e&&(this._lastPointerEvent=null,this._removeGlobalEvents(),e.removeEventListener("mousedown",this._pointerDown,w),e.removeEventListener("touchstart",this._pointerDown,w))},t.prototype._bindGlobalEvents=function(t){var e=this._document,i=C(t),r=i?"touchmove":"mousemove",n=i?"touchend":"mouseup";e.addEventListener(r,this._pointerMove,w),e.addEventListener(n,this._pointerUp,w),i&&e.addEventListener("touchcancel",this._pointerUp,w);var o=this._getWindow();void 0!==o&&o&&o.addEventListener("blur",this._windowBlur)},t.prototype._removeGlobalEvents=function(){var t=this._document;t.removeEventListener("mousemove",this._pointerMove,w),t.removeEventListener("mouseup",this._pointerUp,w),t.removeEventListener("touchmove",this._pointerMove,w),t.removeEventListener("touchend",this._pointerUp,w),t.removeEventListener("touchcancel",this._pointerUp,w);var e=this._getWindow();void 0!==e&&e&&e.removeEventListener("blur",this._windowBlur)},t.prototype._getWindow=function(){return this._document.defaultView||window},t}();function E(t){var e=C(t)?t.touches[0]||t.changedTouches[0]:t;return{x:e.clientX,y:e.clientY}}function C(t){return"t"===t.type[0]}x.decorators=[{type:e.Component,args:[{selector:"ly-cropper-area",template:'<div #resizer\n  *ngIf="resizableArea"\n  [class]="classes.resizer"\n></div>',providers:[i.StyleRenderer],changeDetection:e.ChangeDetectionStrategy.OnPush,exportAs:"lyCropperArea"}]}],x.ctorParameters=function(){return[{type:i.StyleRenderer},{type:e.ElementRef},{type:e.NgZone},{type:g},{type:void 0,decorators:[{type:e.Inject,args:[a.DOCUMENT]}]}]},x.propDecorators={_resizer:[{type:e.ViewChild,args:["resizer"]}],resizableArea:[{type:e.Input}],keepAspectRatio:[{type:e.Input}],round:[{type:e.Input}]},function(t,e,i,r){var n,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);o>3&&a&&Object.defineProperty(e,i,a)}([i.Style((function(t,e,i){var r=i.classes;return function(t){var e=t.after;return function(t){return t+"{border-radius:50%;}"+t+" ."+r.resizer+"{"+e+":"+b+"%;bottom:"+b+"%;transform:translate(4px, 4px);}"}}}))],x.prototype,"round",void 0);var S=function(){};S.decorators=[{type:e.NgModule,args:[{imports:[a.CommonModule],exports:[g],declarations:[g,x]}]}],t.ImgCropperConfig=d,t.LyImageCropper=g,t.LyImageCropperModule=S,t.STYLES=u,t._normalizeDegrees=m,t.round=function(t){return Math.round(t)}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */,t.ɵa=x,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=alyle-ui-image-cropper.umd.min.js.map