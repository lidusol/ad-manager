import { Directive, ElementRef, Input, Renderer2, InjectionToken } from '@angular/core';
import { LyTheme2, mixinBg, mixinColor, mixinDisabled, mixinElevation, mixinOutlined, mixinRaised, mixinShadowColor, mixinStyleUpdater, st2c, StyleCollection, StyleRenderer } from '@alyle/ui';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@alyle/ui';
export const LY_BADGE_DEFAULT_OPTIONS = new InjectionToken('BADGE_DEFAULT_OPTIONS');
const STYLE_PRIORITY = -2;
const DEFAULT_H_POSITION = 'after';
const DEFAULT_V_POSITION = 'above';
const DEFAULT_BG = 'primary';
const DEFAULT_APPEARANCE = 'default';
const DEFAULT_OVERLAP = 'rectangle';
export const STYLES = (theme, ref) => {
    const badge = ref.selectorsOf(STYLES);
    return {
        $name: LyBadge.и,
        $priority: STYLE_PRIORITY,
        root: () => (className) => `${className}{position:absolute;display:flex;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:${theme.pxToRem(12)};font-family:${theme.typography.fontFamily};justify-content:center;align-items:center;box-sizing:border-box;z-index:1;}${st2c(((theme.badge
            && theme.badge.root
            && (theme.badge.root instanceof StyleCollection
                ? theme.badge.root.setTransformer(fn => fn(badge))
                : theme.badge.root(badge)))), `${className}`)}`,
        relative: (className) => `${className}{position:relative;}`
    };
};
/** @docs-private */
export class LyBadgeBase {
    constructor(_theme) {
        this._theme = _theme;
    }
}
/** @docs-private */
export const LyBadgeMixinBase = mixinStyleUpdater(mixinBg(mixinColor(mixinRaised(mixinDisabled(mixinOutlined(mixinElevation(mixinShadowColor(LyBadgeBase))))))));
export class LyBadge extends LyBadgeMixinBase {
    constructor(_el, _theme, _renderer) {
        super(_theme);
        this._el = _el;
        this._renderer = _renderer;
        /**
         * Styles
         * @docs-private
         */
        this.classes = this._theme.renderStyleSheet(STYLES);
        this.setAutoContrast();
        this._badgeElementRef = this._el.nativeElement;
    }
    /** The content for the badge */
    set content(val) {
        if (val !== this.content) {
            this._content = val;
            this._createBadge();
        }
    }
    get content() {
        return this._content;
    }
    set container(container) {
        if (container == null) {
            throw new Error(`${LyBadge.и}: [container] is undefined.`);
        }
        if (this.content != null) {
            throw new Error(`${LyBadge.и}: [container] with [content] don't work together.`);
        }
        if (!container.tagName) {
            throw new Error(`${LyBadge.и}: the value given to container is not an HTMLElement`);
        }
        this._container = container;
        this._renderer.appendChild(container, this._el.nativeElement);
    }
    get container() {
        return this._container;
    }
    get overlap() {
        return this._overlap;
    }
    set overlap(val) {
        if (val !== this.overlap) {
            this._overlap = val;
            Promise.resolve(null).then(() => {
                const overlap = val;
                const hp = this.hPosition;
                const vp = this.vPosition;
                const newClass = this._theme.renderStyle(`${LyBadge.и}-overlap-${val}&${hp}&${vp}`, (theme) => {
                    const p = overlap === 'circle'
                        ? 14 : 0;
                    return (className) => `${className}{${theme.getDirection(vp)}:${p}%;${theme.getDirection(hp)}:${p}%;}`;
                }, STYLE_PRIORITY);
                this._overlapClass = this._sRenderer.updateClass(newClass, this._overlapClass);
            });
        }
    }
    /** The color of the badge */
    get bg() {
        return this._lyBadgeBg;
    }
    set bg(val) {
        if (this.content == null) {
            this.lyBadgeBg = val;
        }
    }
    /** The color of the badge */
    get lyBadgeBg() {
        return this._lyBadgeBg;
    }
    set lyBadgeBg(val) {
        if (val !== this.lyBadgeBg) {
            this._lyBadgeBg = val;
            const newClass = this._theme.renderStyle(`${LyBadge.и}--bg-${val}`, (theme) => (className) => `${className}{background-color:${theme.colorOf(val)};color:${theme.colorOf(`${val}:contrast`)};}`, STYLE_PRIORITY);
            Promise.resolve(null).then(() => {
                this[0x1] = this._sRenderer.updateClass(newClass, this[0x1]);
            });
        }
    }
    get appearance() {
        return this._appearance;
    }
    set appearance(val) {
        if (this.content == null) {
            this.lyBadgeAppearance = val;
        }
    }
    get lyBadgeAppearance() {
        return this._appearance;
    }
    set lyBadgeAppearance(val) {
        if (val !== this.appearance) {
            this._appearance = val;
            const styleID = `${LyBadge.и}--appearance-${val}`;
            const newClass = this._theme.renderStyle(styleID, (theme) => {
                const appearance = theme.badge
                    && theme.badge.appearance
                    && theme.badge.appearance[val]
                    && theme.badge.appearance[val](this.classes);
                if (appearance) {
                    return appearance;
                }
                throw new Error(`${styleID} is not defined in the theme.`);
            }, STYLE_PRIORITY);
            Promise.resolve(null).then(() => {
                this._appearanceClass = this._sRenderer.updateClass(newClass, this._appearanceClass);
            });
        }
    }
    ngOnChanges() {
        if (this.content == null) {
            this.updateStyle(this._el);
        }
        this._updatePosition();
        if (!this._sRenderer) {
            this._sRenderer = new StyleRenderer(this._theme, this._el, this._renderer);
        }
    }
    ngOnInit() {
        /** Add root styles */
        this._renderer.addClass(this._badgeElementRef, this.classes.root);
        /** Set default bg */
        if (!this.bg) {
            this.lyBadgeBg = DEFAULT_BG;
        }
        /** Set default position */
        let requireUpdate = false;
        if (!this.hPosition) {
            requireUpdate = true;
            this.hPosition = DEFAULT_H_POSITION;
        }
        if (!this.vPosition) {
            requireUpdate = true;
            this.vPosition = DEFAULT_V_POSITION;
        }
        if (requireUpdate) {
            this._updatePosition();
        }
        /** Set default appearance */
        if (!this.appearance) {
            this.lyBadgeAppearance = DEFAULT_APPEARANCE;
        }
        /** Set default overlap */
        if (!this.overlap) {
            this.overlap = DEFAULT_OVERLAP;
        }
    }
    ngOnDestroy() {
        if (this._badgeEl) {
            this._renderer.removeChild(this._el.nativeElement, this._badgeEl);
        }
    }
    _updatePosition() {
        const hp = this.hPosition;
        const vp = this.vPosition;
        if (hp && vp) {
            let y;
            let x;
            if (hp && vp) {
                if (hp === 'after') {
                    x = 50;
                }
                else {
                    x = -50;
                }
                if (vp === 'above') {
                    y = -50;
                }
                else {
                    y = 50;
                }
            }
            const newClass = this._theme.renderStyle(`${LyBadge.и}--position-${hp}-${vp}`, (theme) => (className) => `${className}{transform:translate(${theme.after === 'right'
                ? x : -x}%, ${y}%);}`, STYLE_PRIORITY);
            Promise.resolve(null).then(() => {
                this._positionClass = this._sRenderer.updateClass(newClass, this._positionClass);
            });
        }
    }
    _createBadge() {
        if (!this._badgeEl) {
            const badge = this._badgeEl = this._renderer.createElement('div');
            this._renderer.appendChild((this.container) || this._el.nativeElement, badge);
            this._badgeElementRef = badge;
            this._sRenderer = new StyleRenderer(this._theme, new ElementRef(badge), this._renderer);
            /** Add position relative */
            this._renderer.addClass(this._el.nativeElement, this.classes.relative);
        }
        this._badgeEl.textContent = `${this.content}`;
    }
}
LyBadge.ɵfac = function LyBadge_Factory(t) { return new (t || LyBadge)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.LyTheme2), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2)); };
LyBadge.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: LyBadge, selectors: [["ly-badge"], ["", "lyBadge", ""]], inputs: { bg: "bg", color: "color", raised: "raised", disabled: "disabled", outlined: "outlined", elevation: "elevation", shadowColor: "shadowColor", content: ["lyBadge", "content"], container: "container", overlap: "overlap", lyBadgeBg: "lyBadgeBg", appearance: "appearance", lyBadgeAppearance: "lyBadgeAppearance", hPosition: "hPosition", vPosition: "vPosition" }, features: [ɵngcc0.ɵɵInheritDefinitionFeature, ɵngcc0.ɵɵNgOnChangesFeature] });
LyBadge.и = 'LyBadge';
LyBadge.ctorParameters = () => [
    { type: ElementRef },
    { type: LyTheme2 },
    { type: Renderer2 }
];
LyBadge.propDecorators = {
    content: [{ type: Input, args: ['lyBadge',] }],
    container: [{ type: Input }],
    hPosition: [{ type: Input }],
    vPosition: [{ type: Input }],
    overlap: [{ type: Input }],
    bg: [{ type: Input }],
    lyBadgeBg: [{ type: Input }],
    appearance: [{ type: Input }],
    lyBadgeAppearance: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LyBadge, [{
        type: Directive,
        args: [{
                selector: 'ly-badge, [lyBadge]',
                inputs: [
                    'bg',
                    'color',
                    'raised',
                    'disabled',
                    'outlined',
                    'elevation',
                    'shadowColor'
                ]
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc1.LyTheme2 }, { type: ɵngcc0.Renderer2 }]; }, { content: [{
            type: Input,
            args: ['lyBadge']
        }], container: [{
            type: Input
        }], overlap: [{
            type: Input
        }], bg: [{
            type: Input
        }], lyBadgeBg: [{
            type: Input
        }], appearance: [{
            type: Input
        }], lyBadgeAppearance: [{
            type: Input
        }], hPosition: [{
            type: Input
        }], vPosition: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFkZ2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2xpYi9iYWRnZS9iYWRnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixLQUFLLEVBR0wsU0FBUyxFQUVULGNBQWMsRUFDZixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQ0wsUUFBUSxFQUNSLE9BQU8sRUFDUCxVQUFVLEVBQ1YsYUFBYSxFQUNiLGNBQWMsRUFDZCxhQUFhLEVBQ2IsV0FBVyxFQUNYLGdCQUFnQixFQUNoQixpQkFBaUIsRUFFakIsSUFBSSxFQUlKLGVBQWUsRUFDZixhQUFhLEVBQUUsTUFBTSxXQUFXLENBQUM7OztBQWlCbkMsTUFBTSxDQUFDLE1BQU0sd0JBQXdCLEdBQUcsSUFBSSxjQUFjLENBQWUsdUJBQXVCLENBQUMsQ0FBQztBQUVsRyxNQUFNLGNBQWMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUMxQixNQUFNLGtCQUFrQixHQUFHLE9BQU8sQ0FBQztBQUNuQyxNQUFNLGtCQUFrQixHQUFHLE9BQU8sQ0FBQztBQUNuQyxNQUFNLFVBQVUsR0FBRyxTQUFTLENBQUM7QUFDN0IsTUFBTSxrQkFBa0IsR0FBRyxTQUFTLENBQUM7QUFDckMsTUFBTSxlQUFlLEdBQUcsV0FBVyxDQUFDO0FBRXBDLE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxDQUFDLEtBQXdDLEVBQUUsR0FBYSxFQUFFLEVBQUU7QUFDbEYsSUFBRSxNQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ3hDLElBQUUsT0FBTztBQUNULFFBQUksS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ3BCLFFBQUksU0FBUyxFQUFFLGNBQWM7QUFDN0IsUUFBSSxJQUFJLEVBQUUsR0FBSSxFQUFFLENBQUMsQ0FBQyxTQUFpQixFQUFFLEVBQUUsQ0FBQyxHQUFHLFNBQVMsdUdBQXVHLEtBQUssQ0FBQyxPQUFPLENBQUMs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QUFDbEQsSUFBRSxDQUFDO0FBQ0g7O3NpQkFDQTtBQTNQa0IsU0FBQyxHQUFHLFNBQVMsQ0FBQyxBQUQzQjtBQUFDO0VBWkwsU0FBUyxTQUFDLHBCQVk0QixZQS9GckMsVUFBVTtZQW9GVixRQUFRLEVBQUUsdEJBbkZWLFlBUUEsUUFBUTttQkEyRXVCLG5CQTFFL0IsWUFOQSxTQUFTO0FBQ1Y7VUFnRkMsTUFBTSxFQUFFLGxCQWhGTjthQWlGQSxJQUFJLHNCQUNKLE9BQU8sOUNBaEZWLHNCQXVHRSxLQUFLLFNBQUMsU0FBUztnQkF0QmQsUUFBUSx4QkF1QlAsd0JBVUYsS0FBSztZQWhDSixVQUFVLHRCQWlDWix3QkFtQkMsS0FBSztVQW5ESixVQUFVLHBCQW1ERCx3QkFDVixLQUFLO1FBbkRKLFdBQVcsbkJBbURGLHNCQUVWLEtBQUs7U0FwREosYUFBYSx0QkFxRGYsaUJBeUJDLEtBQUs7YUE3RUwsY0FDRiwzQkE2RUMsd0JBVUMsS0FBSztBQUNOLHlCQW1CQyxLQUFLO0FBQ04sZ0NBU0MsS0FBSztBQUNQOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBEaXJlY3RpdmUsXG4gIEVsZW1lbnRSZWYsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIE9uSW5pdCxcbiAgUmVuZGVyZXIyLFxuICBPbkRlc3Ryb3ksXG4gIEluamVjdGlvblRva2VuXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgTHlUaGVtZTIsXG4gIG1peGluQmcsXG4gIG1peGluQ29sb3IsXG4gIG1peGluRGlzYWJsZWQsXG4gIG1peGluRWxldmF0aW9uLFxuICBtaXhpbk91dGxpbmVkLFxuICBtaXhpblJhaXNlZCxcbiAgbWl4aW5TaGFkb3dDb2xvcixcbiAgbWl4aW5TdHlsZVVwZGF0ZXIsXG4gIFRoZW1lVmFyaWFibGVzLFxuICBzdDJjLFxuICBMeUNsYXNzZXMsXG4gIFN0eWxlVGVtcGxhdGUsXG4gIFRoZW1lUmVmLFxuICBTdHlsZUNvbGxlY3Rpb24sXG4gIFN0eWxlUmVuZGVyZXIgfSBmcm9tICdAYWx5bGUvdWknO1xuXG5cbmV4cG9ydCBpbnRlcmZhY2UgTHlCYWRnZVZhcmlhYmxlcyB7XG4gIGJhZGdlPzogTHlCYWRnZVRoZW1lO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEx5QmFkZ2VUaGVtZSB7XG4gIHJvb3Q/OiBTdHlsZUNvbGxlY3Rpb248KChjbGFzc2VzOiBMeUNsYXNzZXM8dHlwZW9mIFNUWUxFUz4pID0+IFN0eWxlVGVtcGxhdGUpPlxuICAgIHwgKChjbGFzc2VzOiBMeUNsYXNzZXM8dHlwZW9mIFNUWUxFUz4pID0+IFN0eWxlVGVtcGxhdGUpO1xuICBhcHBlYXJhbmNlPzoge1xuICAgIGRlZmF1bHQ/OiAoY2xhc3NlczogTHlDbGFzc2VzPHR5cGVvZiBTVFlMRVM+KSA9PiBTdHlsZVRlbXBsYXRlXG4gICAgZG90PzogKGNsYXNzZXM6IEx5Q2xhc3Nlczx0eXBlb2YgU1RZTEVTPikgPT4gU3R5bGVUZW1wbGF0ZVxuICAgIFtuYW1lOiBzdHJpbmddOiAoKGNsYXNzZXM6IEx5Q2xhc3Nlczx0eXBlb2YgU1RZTEVTPikgPT4gU3R5bGVUZW1wbGF0ZSkgfCB1bmRlZmluZWRcbiAgfTtcbn1cblxuZXhwb3J0IGNvbnN0IExZX0JBREdFX0RFRkFVTFRfT1BUSU9OUyA9IG5ldyBJbmplY3Rpb25Ub2tlbjxMeUJhZGdlVGhlbWU+KCdCQURHRV9ERUZBVUxUX09QVElPTlMnKTtcblxuY29uc3QgU1RZTEVfUFJJT1JJVFkgPSAtMjtcbmNvbnN0IERFRkFVTFRfSF9QT1NJVElPTiA9ICdhZnRlcic7XG5jb25zdCBERUZBVUxUX1ZfUE9TSVRJT04gPSAnYWJvdmUnO1xuY29uc3QgREVGQVVMVF9CRyA9ICdwcmltYXJ5JztcbmNvbnN0IERFRkFVTFRfQVBQRUFSQU5DRSA9ICdkZWZhdWx0JztcbmNvbnN0IERFRkFVTFRfT1ZFUkxBUCA9ICdyZWN0YW5nbGUnO1xuXG5leHBvcnQgY29uc3QgU1RZTEVTID0gKHRoZW1lOiBUaGVtZVZhcmlhYmxlcyAmIEx5QmFkZ2VWYXJpYWJsZXMsIHJlZjogVGhlbWVSZWYpID0+IHtcbiAgY29uc3QgYmFkZ2UgPSByZWYuc2VsZWN0b3JzT2YoU1RZTEVTKTtcbiAgcmV0dXJuIHtcbiAgICAkbmFtZTogTHlCYWRnZS7QuCxcbiAgICAkcHJpb3JpdHk6IFNUWUxFX1BSSU9SSVRZLFxuICAgIHJvb3Q6ICggKSA9PiAoY2xhc3NOYW1lOiBzdHJpbmcpID0+IGAke2NsYXNzTmFtZX17cG9zaXRpb246YWJzb2x1dGU7ZGlzcGxheTpmbGV4O292ZXJmbG93OmhpZGRlbjt3aGl0ZS1zcGFjZTpub3dyYXA7dGV4dC1vdmVyZmxvdzplbGxpcHNpcztmb250LXNpemU6JHt0aGVtZS5weFRvUmVtKDEyKX07Zm9udC1mYW1pbHk6JHt0aGVtZS50eXBvZ3JhcGh5LmZvbnRGYW1pbHl9O2p1c3RpZnktY29udGVudDpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO2JveC1zaXppbmc6Ym9yZGVyLWJveDt6LWluZGV4OjE7fSR7c3QyYygoXG4gICAgICAgICAgKHRoZW1lLmJhZGdlXG4gICAgICAgICAgICAmJiB0aGVtZS5iYWRnZS5yb290XG4gICAgICAgICAgICAmJiAodGhlbWUuYmFkZ2Uucm9vdCBpbnN0YW5jZW9mIFN0eWxlQ29sbGVjdGlvblxuICAgICAgICAgICAgICA/IHRoZW1lLmJhZGdlLnJvb3Quc2V0VHJhbnNmb3JtZXIoZm4gPT4gZm4oYmFkZ2UpKVxuICAgICAgICAgICAgICA6IHRoZW1lLmJhZGdlLnJvb3QoYmFkZ2UpKVxuICAgICAgICAgICkpLCBgJHtjbGFzc05hbWV9YCl9YCxcbiAgICByZWxhdGl2ZTogKGNsYXNzTmFtZTogc3RyaW5nKSA9PiBgJHtjbGFzc05hbWV9e3Bvc2l0aW9uOnJlbGF0aXZlO31gXG4gIH07XG59O1xuXG4vKiogQGRvY3MtcHJpdmF0ZSAqL1xuZXhwb3J0IGNsYXNzIEx5QmFkZ2VCYXNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIF90aGVtZTogTHlUaGVtZTJcbiAgKSB7IH1cbn1cblxuLyoqIEBkb2NzLXByaXZhdGUgKi9cbmV4cG9ydCBjb25zdCBMeUJhZGdlTWl4aW5CYXNlID0gbWl4aW5TdHlsZVVwZGF0ZXIoXG5taXhpbkJnKFxuICBtaXhpbkNvbG9yKFxuICAgIG1peGluUmFpc2VkKFxuICAgICAgbWl4aW5EaXNhYmxlZChcbiAgICAgICAgbWl4aW5PdXRsaW5lZChcbiAgICAgICAgICBtaXhpbkVsZXZhdGlvbihcbiAgICAgICAgICAgIG1peGluU2hhZG93Q29sb3IoTHlCYWRnZUJhc2UpKSkpKSkpKTtcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnbHktYmFkZ2UsIFtseUJhZGdlXScsXG4gIGlucHV0czogW1xuICAgICdiZycsXG4gICAgJ2NvbG9yJyxcbiAgICAncmFpc2VkJyxcbiAgICAnZGlzYWJsZWQnLFxuICAgICdvdXRsaW5lZCcsXG4gICAgJ2VsZXZhdGlvbicsXG4gICAgJ3NoYWRvd0NvbG9yJ1xuICBdXG59KVxuZXhwb3J0IGNsYXNzIEx5QmFkZ2UgZXh0ZW5kcyBMeUJhZGdlTWl4aW5CYXNlIGltcGxlbWVudHMgT25DaGFuZ2VzLCBPbkluaXQsIE9uRGVzdHJveSB7XG4gIHN0YXRpYyByZWFkb25seSDQuCA9ICdMeUJhZGdlJztcbiAgLyoqXG4gICAqIFN0eWxlc1xuICAgKiBAZG9jcy1wcml2YXRlXG4gICAqL1xuICByZWFkb25seSBjbGFzc2VzID0gdGhpcy5fdGhlbWUucmVuZGVyU3R5bGVTaGVldChTVFlMRVMpO1xuICBwcml2YXRlIF9jb250ZW50OiBzdHJpbmcgfCBudW1iZXI7XG4gIC8vIHByaXZhdGUgX3Bvc2l0aW9uOiBzdHJpbmc7XG4gIHByaXZhdGUgX3Bvc2l0aW9uQ2xhc3M6IHN0cmluZztcbiAgcHJpdmF0ZSBfYmFkZ2VFbDogYW55O1xuICBwcml2YXRlIF9iYWRnZUVsZW1lbnRSZWY6IGFueTtcbiAgcHJpdmF0ZSBfc1JlbmRlcmVyPzogU3R5bGVSZW5kZXJlcjtcblxuICAvKiogVGhlIGNvbnRlbnQgZm9yIHRoZSBiYWRnZSAqL1xuICBASW5wdXQoJ2x5QmFkZ2UnKVxuICBzZXQgY29udGVudCh2YWw6IHN0cmluZyB8IG51bWJlcikge1xuICAgIGlmICh2YWwgIT09IHRoaXMuY29udGVudCkge1xuICAgICAgdGhpcy5fY29udGVudCA9IHZhbDtcbiAgICAgIHRoaXMuX2NyZWF0ZUJhZGdlKCk7XG4gICAgfVxuICB9XG4gIGdldCBjb250ZW50KCk6IHN0cmluZyB8IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbnRlbnQ7XG4gIH1cblxuICBASW5wdXQoKVxuICBzZXQgY29udGFpbmVyKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBpZiAoY29udGFpbmVyID09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJHtMeUJhZGdlLtC4fTogW2NvbnRhaW5lcl0gaXMgdW5kZWZpbmVkLmApO1xuICAgIH1cbiAgICBpZiAodGhpcy5jb250ZW50ICE9IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgJHtMeUJhZGdlLtC4fTogW2NvbnRhaW5lcl0gd2l0aCBbY29udGVudF0gZG9uJ3Qgd29yayB0b2dldGhlci5gKTtcbiAgICB9XG4gICAgaWYgKCFjb250YWluZXIudGFnTmFtZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGAke0x5QmFkZ2Uu0Lh9OiB0aGUgdmFsdWUgZ2l2ZW4gdG8gY29udGFpbmVyIGlzIG5vdCBhbiBIVE1MRWxlbWVudGApO1xuICAgIH1cbiAgICB0aGlzLl9jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgdGhpcy5fcmVuZGVyZXIuYXBwZW5kQ2hpbGQoY29udGFpbmVyLCB0aGlzLl9lbC5uYXRpdmVFbGVtZW50KTtcblxuICB9XG4gIGdldCBjb250YWluZXIoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbnRhaW5lcjtcbiAgfVxuICBwcml2YXRlIF9jb250YWluZXI6IEhUTUxFbGVtZW50O1xuXG4gIEBJbnB1dCgpIGhQb3NpdGlvbjogJ2JlZm9yZScgfCAnYWZ0ZXInO1xuICBASW5wdXQoKSB2UG9zaXRpb246ICdhYm92ZScgfCAnYmVsb3cnO1xuXG4gIEBJbnB1dCgpXG4gIGdldCBvdmVybGFwKCkge1xuICAgIHJldHVybiB0aGlzLl9vdmVybGFwO1xuICB9XG4gIHNldCBvdmVybGFwKHZhbDogJ2NpcmNsZScgfCAncmVjdGFuZ2xlJykge1xuICAgIGlmICh2YWwgIT09IHRoaXMub3ZlcmxhcCkge1xuICAgICAgdGhpcy5fb3ZlcmxhcCA9IHZhbDtcblxuICAgICAgUHJvbWlzZS5yZXNvbHZlKG51bGwhKS50aGVuKCgpID0+IHtcbiAgICAgICAgY29uc3Qgb3ZlcmxhcCA9IHZhbDtcbiAgICAgICAgY29uc3QgaHAgPSB0aGlzLmhQb3NpdGlvbjtcbiAgICAgICAgY29uc3QgdnAgPSB0aGlzLnZQb3NpdGlvbjtcblxuICAgICAgICBjb25zdCBuZXdDbGFzcyA9IHRoaXMuX3RoZW1lLnJlbmRlclN0eWxlKGAke0x5QmFkZ2Uu0Lh9LW92ZXJsYXAtJHt2YWx9JiR7aHB9JiR7dnB9YCwgKHRoZW1lOiBUaGVtZVZhcmlhYmxlcykgPT4ge1xuICAgICAgICAgIGNvbnN0IHAgPSBvdmVybGFwID09PSAnY2lyY2xlJ1xuICAgICAgICAgICAgPyAxNCA6IDA7XG4gICAgICAgICAgcmV0dXJuIChjbGFzc05hbWU6IHN0cmluZykgPT4gYCR7Y2xhc3NOYW1lfXske3RoZW1lLmdldERpcmVjdGlvbih2cCl9OiR7cH0lOyR7dGhlbWUuZ2V0RGlyZWN0aW9uKGhwKX06JHtwfSU7fWA7XG4gICAgICAgIH0sIFNUWUxFX1BSSU9SSVRZKTtcbiAgICAgICAgdGhpcy5fb3ZlcmxhcENsYXNzID0gdGhpcy5fc1JlbmRlcmVyIS51cGRhdGVDbGFzcyhuZXdDbGFzcywgdGhpcy5fb3ZlcmxhcENsYXNzKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBwcml2YXRlIF9vdmVybGFwOiAnY2lyY2xlJyB8ICdyZWN0YW5nbGUnO1xuICBwcml2YXRlIF9vdmVybGFwQ2xhc3M6IHN0cmluZztcblxuICAvKiogVGhlIGNvbG9yIG9mIHRoZSBiYWRnZSAqL1xuICBASW5wdXQoKVxuICBnZXQgYmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2x5QmFkZ2VCZztcbiAgfVxuICBzZXQgYmcodmFsOiBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5jb250ZW50ID09IG51bGwpIHtcbiAgICAgIHRoaXMubHlCYWRnZUJnID0gdmFsO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBUaGUgY29sb3Igb2YgdGhlIGJhZGdlICovXG4gIEBJbnB1dCgpXG4gIGdldCBseUJhZGdlQmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2x5QmFkZ2VCZztcbiAgfVxuICBzZXQgbHlCYWRnZUJnKHZhbDogc3RyaW5nKSB7XG4gICAgaWYgKHZhbCAhPT0gdGhpcy5seUJhZGdlQmcpIHtcbiAgICAgIHRoaXMuX2x5QmFkZ2VCZyA9IHZhbDtcblxuICAgICAgY29uc3QgbmV3Q2xhc3MgPSB0aGlzLl90aGVtZS5yZW5kZXJTdHlsZShgJHtMeUJhZGdlLtC4fS0tYmctJHt2YWx9YCxcbiAgICAgICh0aGVtZTogVGhlbWVWYXJpYWJsZXMpID0+IChjbGFzc05hbWU6IHN0cmluZykgPT4gYCR7Y2xhc3NOYW1lfXtiYWNrZ3JvdW5kLWNvbG9yOiR7dGhlbWUuY29sb3JPZih2YWwpfTtjb2xvcjoke3RoZW1lLmNvbG9yT2YoYCR7dmFsfTpjb250cmFzdGApfTt9YCwgU1RZTEVfUFJJT1JJVFkpO1xuXG4gICAgICBQcm9taXNlLnJlc29sdmUobnVsbCEpLnRoZW4oKCkgPT4ge1xuICAgICAgICB0aGlzWzB4MV0gPSB0aGlzLl9zUmVuZGVyZXIhLnVwZGF0ZUNsYXNzKG5ld0NsYXNzLCB0aGlzWzB4MV0pO1xuICAgICAgfSk7XG5cblxuICAgIH1cbiAgfVxuICBwcml2YXRlIF9seUJhZGdlQmc6IHN0cmluZztcblxuICBASW5wdXQoKVxuICBnZXQgYXBwZWFyYW5jZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fYXBwZWFyYW5jZTtcbiAgfVxuICBzZXQgYXBwZWFyYW5jZSh2YWw6IHN0cmluZykge1xuICAgIGlmICh0aGlzLmNvbnRlbnQgPT0gbnVsbCkge1xuICAgICAgdGhpcy5seUJhZGdlQXBwZWFyYW5jZSA9IHZhbDtcbiAgICB9XG4gIH1cblxuICBASW5wdXQoKVxuICBnZXQgbHlCYWRnZUFwcGVhcmFuY2UoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FwcGVhcmFuY2U7XG4gIH1cbiAgc2V0IGx5QmFkZ2VBcHBlYXJhbmNlKHZhbDogc3RyaW5nKSB7XG4gICAgaWYgKHZhbCAhPT0gdGhpcy5hcHBlYXJhbmNlKSB7XG4gICAgICB0aGlzLl9hcHBlYXJhbmNlID0gdmFsO1xuICAgICAgY29uc3Qgc3R5bGVJRCA9IGAke0x5QmFkZ2Uu0Lh9LS1hcHBlYXJhbmNlLSR7dmFsfWA7XG4gICAgICBjb25zdCBuZXdDbGFzcyA9IHRoaXMuX3RoZW1lLnJlbmRlclN0eWxlKFxuICAgICAgICBzdHlsZUlELFxuICAgICAgICAodGhlbWU6IEx5QmFkZ2VWYXJpYWJsZXMpID0+IHtcbiAgICAgICAgICBjb25zdCBhcHBlYXJhbmNlID0gdGhlbWUuYmFkZ2VcbiAgICAgICAgICAgICYmIHRoZW1lLmJhZGdlLmFwcGVhcmFuY2VcbiAgICAgICAgICAgICYmIHRoZW1lLmJhZGdlLmFwcGVhcmFuY2VbdmFsXVxuICAgICAgICAgICAgJiYgdGhlbWUuYmFkZ2UuYXBwZWFyYW5jZVt2YWxdISh0aGlzLmNsYXNzZXMpO1xuICAgICAgICAgIGlmIChhcHBlYXJhbmNlKSB7XG4gICAgICAgICAgICByZXR1cm4gYXBwZWFyYW5jZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3N0eWxlSUR9IGlzIG5vdCBkZWZpbmVkIGluIHRoZSB0aGVtZS5gKTtcbiAgICAgICAgfSxcbiAgICAgICAgU1RZTEVfUFJJT1JJVFlcbiAgICAgICk7XG4gICAgICBQcm9taXNlLnJlc29sdmUobnVsbCEpLnRoZW4oKCkgPT4ge1xuICAgICAgICB0aGlzLl9hcHBlYXJhbmNlQ2xhc3MgPSB0aGlzLl9zUmVuZGVyZXIhLnVwZGF0ZUNsYXNzKG5ld0NsYXNzLCB0aGlzLl9hcHBlYXJhbmNlQ2xhc3MpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfYXBwZWFyYW5jZTogc3RyaW5nO1xuICBwcml2YXRlIF9hcHBlYXJhbmNlQ2xhc3M6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIF9lbDogRWxlbWVudFJlZjxIVE1MRWxlbWVudD4sXG4gICAgX3RoZW1lOiBMeVRoZW1lMixcbiAgICBwcml2YXRlIF9yZW5kZXJlcjogUmVuZGVyZXIyXG4gICkge1xuICAgIHN1cGVyKF90aGVtZSk7XG4gICAgdGhpcy5zZXRBdXRvQ29udHJhc3QoKTtcbiAgICB0aGlzLl9iYWRnZUVsZW1lbnRSZWYgPSB0aGlzLl9lbC5uYXRpdmVFbGVtZW50O1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoKSB7XG4gICAgaWYgKHRoaXMuY29udGVudCA9PSBudWxsKSB7XG4gICAgICB0aGlzLnVwZGF0ZVN0eWxlKHRoaXMuX2VsKTtcbiAgICB9XG4gICAgdGhpcy5fdXBkYXRlUG9zaXRpb24oKTtcbiAgICBpZiAoIXRoaXMuX3NSZW5kZXJlcikge1xuICAgICAgdGhpcy5fc1JlbmRlcmVyID0gbmV3IFN0eWxlUmVuZGVyZXIodGhpcy5fdGhlbWUsIHRoaXMuX2VsLCB0aGlzLl9yZW5kZXJlcik7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG5cbiAgICAvKiogQWRkIHJvb3Qgc3R5bGVzICovXG4gICAgdGhpcy5fcmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5fYmFkZ2VFbGVtZW50UmVmLCB0aGlzLmNsYXNzZXMucm9vdCk7XG5cbiAgICAvKiogU2V0IGRlZmF1bHQgYmcgKi9cbiAgICBpZiAoIXRoaXMuYmcpIHtcbiAgICAgIHRoaXMubHlCYWRnZUJnID0gREVGQVVMVF9CRztcbiAgICB9XG5cbiAgICAvKiogU2V0IGRlZmF1bHQgcG9zaXRpb24gKi9cbiAgICBsZXQgcmVxdWlyZVVwZGF0ZSA9IGZhbHNlO1xuICAgIGlmICghdGhpcy5oUG9zaXRpb24pIHtcbiAgICAgIHJlcXVpcmVVcGRhdGUgPSB0cnVlO1xuICAgICAgdGhpcy5oUG9zaXRpb24gPSBERUZBVUxUX0hfUE9TSVRJT047XG4gICAgfVxuICAgIGlmICghdGhpcy52UG9zaXRpb24pIHtcbiAgICAgIHJlcXVpcmVVcGRhdGUgPSB0cnVlO1xuICAgICAgdGhpcy52UG9zaXRpb24gPSBERUZBVUxUX1ZfUE9TSVRJT047XG4gICAgfVxuICAgIGlmIChyZXF1aXJlVXBkYXRlKSB7XG4gICAgICB0aGlzLl91cGRhdGVQb3NpdGlvbigpO1xuICAgIH1cblxuICAgIC8qKiBTZXQgZGVmYXVsdCBhcHBlYXJhbmNlICovXG4gICAgaWYgKCF0aGlzLmFwcGVhcmFuY2UpIHtcbiAgICAgIHRoaXMubHlCYWRnZUFwcGVhcmFuY2UgPSBERUZBVUxUX0FQUEVBUkFOQ0U7XG4gICAgfVxuXG4gICAgLyoqIFNldCBkZWZhdWx0IG92ZXJsYXAgKi9cbiAgICBpZiAoIXRoaXMub3ZlcmxhcCkge1xuICAgICAgdGhpcy5vdmVybGFwID0gREVGQVVMVF9PVkVSTEFQO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLl9iYWRnZUVsKSB7XG4gICAgICB0aGlzLl9yZW5kZXJlci5yZW1vdmVDaGlsZCh0aGlzLl9lbC5uYXRpdmVFbGVtZW50LCB0aGlzLl9iYWRnZUVsKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF91cGRhdGVQb3NpdGlvbigpIHtcbiAgICBjb25zdCBocCA9IHRoaXMuaFBvc2l0aW9uO1xuICAgIGNvbnN0IHZwID0gdGhpcy52UG9zaXRpb247XG5cbiAgICBpZiAoaHAgJiYgdnApIHtcbiAgICAgIGxldCB5OiBudW1iZXI7XG4gICAgICBsZXQgeDogbnVtYmVyO1xuICAgICAgaWYgKGhwICYmIHZwKSB7XG4gICAgICAgIGlmIChocCA9PT0gJ2FmdGVyJykge1xuICAgICAgICAgIHggPSA1MDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB4ID0gLTUwO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2cCA9PT0gJ2Fib3ZlJykge1xuICAgICAgICAgIHkgPSAtNTA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgeSA9IDUwO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG5ld0NsYXNzID0gdGhpcy5fdGhlbWUucmVuZGVyU3R5bGUoYCR7THlCYWRnZS7QuH0tLXBvc2l0aW9uLSR7aHB9LSR7dnB9YCxcbiAgICAgICh0aGVtZTogVGhlbWVWYXJpYWJsZXMpID0+IChjbGFzc05hbWU6IHN0cmluZykgPT4gYCR7Y2xhc3NOYW1lfXt0cmFuc2Zvcm06dHJhbnNsYXRlKCR7dGhlbWUuYWZ0ZXIgPT09ICdyaWdodCdcbiAgICAgICAgICA/IHggOiAteH0lLCAke3l9JSk7fWAsIFNUWUxFX1BSSU9SSVRZKTtcblxuICAgICAgUHJvbWlzZS5yZXNvbHZlKG51bGwhKS50aGVuKCgpID0+IHtcbiAgICAgICAgdGhpcy5fcG9zaXRpb25DbGFzcyA9IHRoaXMuX3NSZW5kZXJlciEudXBkYXRlQ2xhc3MobmV3Q2xhc3MsIHRoaXMuX3Bvc2l0aW9uQ2xhc3MpO1xuICAgICAgfSk7XG5cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9jcmVhdGVCYWRnZSgpIHtcbiAgICBpZiAoIXRoaXMuX2JhZGdlRWwpIHtcbiAgICAgIGNvbnN0IGJhZGdlID0gdGhpcy5fYmFkZ2VFbCA9IHRoaXMuX3JlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgdGhpcy5fcmVuZGVyZXIuYXBwZW5kQ2hpbGQoKHRoaXMuY29udGFpbmVyKSB8fCB0aGlzLl9lbC5uYXRpdmVFbGVtZW50LCBiYWRnZSk7XG4gICAgICB0aGlzLl9iYWRnZUVsZW1lbnRSZWYgPSBiYWRnZTtcbiAgICAgIHRoaXMuX3NSZW5kZXJlciA9IG5ldyBTdHlsZVJlbmRlcmVyKHRoaXMuX3RoZW1lLCBuZXcgRWxlbWVudFJlZihiYWRnZSksIHRoaXMuX3JlbmRlcmVyKTtcblxuICAgICAgLyoqIEFkZCBwb3NpdGlvbiByZWxhdGl2ZSAqL1xuICAgICAgdGhpcy5fcmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5fZWwubmF0aXZlRWxlbWVudCwgdGhpcy5jbGFzc2VzLnJlbGF0aXZlKTtcbiAgICB9XG4gICAgdGhpcy5fYmFkZ2VFbC50ZXh0Q29udGVudCA9IGAke3RoaXMuY29udGVudH1gO1xuICB9XG5cbn1cbiJdfQ==