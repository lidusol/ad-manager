const EPS = 1e-7;
const MAX_ITER = 20;
const { pow, min, max } = Math;
export class Color {
    constructor(...args) {
        if (args.length < 3 && args.length > 0) {
            this._color = bigIntToRgb(args[0], args[1]);
        }
        else if (args.length > 2) {
            this._color = args;
            // Set default alpha
            if (args.length === 3) {
                this._color[3] = 1;
            }
        }
        else {
            this._color = [];
        }
    }
    rgba() {
        return this._color.slice(0);
    }
    alpha(value) {
        if (value === void 0) {
            return this._color[3];
        }
        // Clone
        const _color = this.rgba();
        // Set alpha
        _color[3] = value;
        return new Color(..._color);
    }
    luminance(lum) {
        if (lum === void 0) {
            return rgbToLuminance(...this._color);
        }
        if (lum === 0) {
            // return pure black
            return new Color(0, 0, 0, this._color[3]);
        }
        if (lum === 1) {
            // return pure white
            return new Color(255, 255, 255, this._color[3]);
        }
        const relativeLuminance = this.luminance();
        let max_iter = MAX_ITER;
        const test = (low, high) => {
            const mid = new Color(...interpolateRgb(low.rgba(), high.rgba(), 0.5));
            const lm = mid.luminance();
            if (Math.abs(lum - lm) < EPS || !max_iter--) {
                return mid;
            }
            return lm > lum ? test(low, mid) : test(mid, high);
        };
        const rgb = (relativeLuminance > lum
            ? test(new Color(0, 0, 0), this)
            : test(this, new Color(255, 255, 255))).rgba();
        rgb.pop();
        rgb.push(this._color[3]);
        return new Color(...rgb);
    }
    /**
     * Changes the saturation of a color by manipulating the Lch chromaticity.
     * @param amount default: 1
     */
    saturate(amount = 1) {
        const lab = rgbToLab(this._color);
        const lch = labToLch(lab);
        lch[1] += 18 * amount;
        if (lch[1] < 0) {
            lch[1] = 0;
        }
        const labFromLch = lchToLab(lch);
        const xyzFromLab = labToXyz(labFromLch);
        const rgb = xyzToRgb(xyzFromLab);
        // Set alpha
        rgb.push(this._color[3]);
        return new Color(...rgb);
    }
    /**
     * Similar to saturate, but the opposite direction.
     * @param amount default: 1
     */
    desaturate(amount = 1) {
        return this.saturate(-amount);
    }
    /**
     * @param amount default: 1
     */
    darken(amount = 1) {
        const lab = rgbToLab(this._color);
        lab[0] -= 18 * amount;
        const xyzFromLab = labToXyz(lab);
        const rgb = xyzToRgb(xyzFromLab);
        // Set alpha
        rgb.push(this._color[3]);
        return new Color(...rgb);
    }
    /**
     * The opposite of darken
     * @param amount default 1
     */
    brighten(amount = 1) {
        return this.darken(-amount);
    }
    css() {
        if (!this._color.length) {
            return 'undefined - invalid color';
        }
        return rgbToCss(this.rgba());
    }
    toString() {
        return this.css();
    }
}
// /**
//  * Convert number to CSS
//  * 0x00bcd4 > #00bcd4
//  * @param int Int
//  */
// function bigIntToCss(int: number) {
//   const hex = int.toString(16);
//   return '#000000'.substring(0, 7 - hex.length) + hex;
// }
function rgbToCss(rgb) {
    const alpha = rgb.pop();
    if (alpha === 1) {
        return `rgb(${rgb.map(Math.round).join()})`;
    }
    return `rgba(${rgb.map(Math.round).join()},${alpha})`;
}
function bigIntToRgb(bigInt, alpha = 1) {
    // if (bigInt < 0x1000) {
    //   bigInt = parseInt(bigInt.toString(16).split('').map(char => {
    //     return char + char;
    //   }).join(''), 16);
    // }
    // tslint:disable-next-line: no-bitwise
    const red = (bigInt >> 16) & 0xff;
    // tslint:disable-next-line: no-bitwise
    const green = (bigInt >> 8) & 0xff;
    // tslint:disable-next-line: no-bitwise
    const blue = bigInt & 0xff;
    return [red, green, blue, alpha];
}
// function rgbToBigInt(r: number, g: number, b: number) {
//   // tslint:disable-next-line: no-bitwise
//   return (r << 16) + (g << 8) + b;
// }
function rgbToXyz(rgb) {
    let r = rgb[0] / 255;
    let g = rgb[1] / 255;
    let b = rgb[2] / 255;
    // Assume sRGB
    r = r > 0.04045 ? (Math.pow(((r + 0.055) / 1.055), 2.4)) : (r / 12.92);
    g = g > 0.04045 ? (Math.pow(((g + 0.055) / 1.055), 2.4)) : (g / 12.92);
    b = b > 0.04045 ? (Math.pow(((b + 0.055) / 1.055), 2.4)) : (b / 12.92);
    const x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
    const y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
    const z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    return [x * 100, y * 100, z * 100];
}
function rgbToLab(rgb) {
    const xyz = rgbToXyz(rgb);
    let x = xyz[0];
    let y = xyz[1];
    let z = xyz[2];
    x /= 95.047;
    y /= 100;
    z /= 108.883;
    x = x > 0.008856 ? (Math.pow(x, (1 / 3))) : (7.787 * x) + (16 / 116);
    y = y > 0.008856 ? (Math.pow(y, (1 / 3))) : (7.787 * y) + (16 / 116);
    z = z > 0.008856 ? (Math.pow(z, (1 / 3))) : (7.787 * z) + (16 / 116);
    const l = (116 * y) - 16;
    const a = 500 * (x - y);
    const b = 200 * (y - z);
    return [l, a, b];
}
function labToLch(lab) {
    const l = lab[0];
    const a = lab[1];
    const b = lab[2];
    let h;
    const hr = Math.atan2(b, a);
    h = hr * 360 / 2 / Math.PI;
    if (h < 0) {
        h += 360;
    }
    const c = Math.sqrt(a * a + b * b);
    return [l, c, h];
}
function lchToLab(lch) {
    const l = lch[0];
    const c = lch[1];
    const h = lch[2];
    const hr = h / 360 * 2 * Math.PI;
    const a = c * Math.cos(hr);
    const b = c * Math.sin(hr);
    return [l, a, b];
}
function labToXyz(lab) {
    const l = lab[0];
    const a = lab[1];
    const b = lab[2];
    let x;
    let y;
    let z;
    y = (l + 16) / 116;
    x = a / 500 + y;
    z = y - b / 200;
    const y2 = Math.pow(y, 3);
    const x2 = Math.pow(x, 3);
    const z2 = Math.pow(z, 3);
    y = y2 > 0.008856 ? y2 : (y - 16 / 116) / 7.787;
    x = x2 > 0.008856 ? x2 : (x - 16 / 116) / 7.787;
    z = z2 > 0.008856 ? z2 : (z - 16 / 116) / 7.787;
    x *= 95.047;
    y *= 100;
    z *= 108.883;
    return [x, y, z];
}
function xyzToRgb(xyz) {
    const x = xyz[0] / 100;
    const y = xyz[1] / 100;
    const z = xyz[2] / 100;
    let r;
    let g;
    let b;
    r = (x * 3.2406) + (y * -1.5372) + (z * -0.4986);
    g = (x * -0.9689) + (y * 1.8758) + (z * 0.0415);
    b = (x * 0.0557) + (y * -0.2040) + (z * 1.0570);
    // Assume sRGB
    r = r > 0.0031308
        ? ((1.055 * (Math.pow(r, (1.0 / 2.4)))) - 0.055)
        : r * 12.92;
    g = g > 0.0031308
        ? ((1.055 * (Math.pow(g, (1.0 / 2.4)))) - 0.055)
        : g * 12.92;
    b = b > 0.0031308
        ? ((1.055 * (Math.pow(b, (1.0 / 2.4)))) - 0.055)
        : b * 12.92;
    r = min(max(0, r), 1);
    g = min(max(0, g), 1);
    b = min(max(0, b), 1);
    return [r * 255, g * 255, b * 255];
}
function rgbToLuminance(r, g, b) {
    // Relative luminance
    // See http://www.w3.org/TR/2008/REC-WCAG20-20081211/#relativeluminancedef
    r = luminance_channel(r);
    g = luminance_channel(g);
    b = luminance_channel(b);
    return 0.2126 * r + 0.7152 * g + 0.0722 * b;
}
function luminance_channel(x) {
    x /= 255;
    return x <= 0.03928 ? x / 12.92 : pow((x + 0.055) / 1.055, 2.4);
}
function interpolateRgb(rgb1, rgb2, f = 0.5) {
    return [
        rgb1[0] + f * (rgb2[0] - rgb1[0]),
        rgb1[1] + f * (rgb2[1] - rgb1[1]),
        rgb1[2] + f * (rgb2[2] - rgb1[2]),
    ];
}
export function hexColorToInt(_color) {
    if (_color.startsWith('#')) {
        return parseInt(_color.slice(1), 16);
    }
    throw new Error(`Expected to start with '#' the given value is: ${_color}`);
}
export function color(...args) {
    return new Color(...args);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9saWIvY29sb3IvY29sb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDO0FBQ2pCLE1BQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQztBQUNwQixNQUFNLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUM7QUFFL0IsTUFBTSxPQUFPLEtBQUs7SUFPaEIsWUFBWSxHQUFHLElBQWM7UUFDM0IsSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUN0QyxJQUFJLENBQUMsTUFBTSxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDN0M7YUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQzFCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1lBRW5CLG9CQUFvQjtZQUNwQixJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUNyQixJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQzthQUNwQjtTQUNGO2FBQU07WUFDTCxJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztTQUNsQjtJQUNILENBQUM7SUFFRCxJQUFJO1FBQ0YsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBV0QsS0FBSyxDQUFDLEtBQWM7UUFDbEIsSUFBSSxLQUFLLEtBQUssS0FBSyxDQUFDLEVBQUU7WUFDcEIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3ZCO1FBRUQsUUFBUTtRQUNSLE1BQU0s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QUFDO0FBRUQsMERBQTBEO0FBQzFELDRDQUE0QztBQUM1QyxxQ0FBcUM7QUFDckMsSUFBSTtBQUVKLFNBQVMsUUFBUSxDQUFDLEdBQWE7SUFDN0IsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztJQUNyQixJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDO0lBQ3JCLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7SUFFckIsY0FBYztJQUNkLENBQUMsR0FBRyxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQUEsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsR0FBRyxLQUFLLENBQUMsRUFBSSxHQUFHLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztJQUMvRCxDQUFDLEdBQUcsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFBLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLEdBQUcsS0FBSyxDQUFDLEVBQUksR0FBRyxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDL0QsQ0FBQyxHQUFHLENBQUMsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBQSxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxHQUFHLEtBQUssQ0FBQyxFQUFJLEdBQUcsQ0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDO0lBRS9ELE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDO0lBQ3JELE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFH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QUUsQ0FBQyxDQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFFLENBQUMsQ0FBRSxHQUFHLElBQUksQ0FBRSxDQUFDLENBQUUsQ0FBQztRQUN2QyxJQUFJLENBQUUsQ0FBQyxDQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFFLENBQUMsQ0FBRSxHQUFHLElBQUksQ0FBRSxDQUFDLENBQUUsQ0FBQztLQUN4QyxDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxhQUFhLENBQUMsTUFBYztJQUMxQyxJQUFJLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDMUIsT0FBTyxRQUFRLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztLQUN0QztJQUNELE1BQU0sSUFBSSxLQUFLLENBQUMsa0RBQWtELE1BQU0sRUFBRSxDQUFDLENBQUM7QUFDOUUsQ0FBQztBQUtELE1BQU0sVUFBVSxLQUFLLENBQUMsR0FBRyxJQUE0QjtJQUNuRCxPQUFPLElBQUksS0FBSyxDQUFDLEdBQUcsSUFBZ0IsQ0FBQyxDQUFDO0FBQ3hDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBFUFMgPSAxZS03O1xuY29uc3QgTUFYX0lURVIgPSAyMDtcbmNvbnN0IHsgcG93LCBtaW4sIG1heCB9ID0gTWF0aDtcblxuZXhwb3J0IGNsYXNzIENvbG9yIHtcblxuICBwcml2YXRlIHJlYWRvbmx5IF9jb2xvcjogbnVtYmVyW107XG5cbiAgY29uc3RydWN0b3IoaGV4OiBudW1iZXIsIGFscGhhPzogbnVtYmVyKVxuICBjb25zdHJ1Y3RvcihyOiBudW1iZXIsIGc6IG51bWJlciwgYjogbnVtYmVyLCBhbHBoYT86IG51bWJlcilcbiAgY29uc3RydWN0b3IoLi4uYXJnczogbnVtYmVyW10pXG4gIGNvbnN0cnVjdG9yKC4uLmFyZ3M6IG51bWJlcltdKSB7XG4gICAgaWYgKGFyZ3MubGVuZ3RoIDwgMyAmJiBhcmdzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuX2NvbG9yID0gYmlnSW50VG9SZ2IoYXJnc1swXSwgYXJnc1sxXSk7XG4gICAgfSBlbHNlIGlmIChhcmdzLmxlbmd0aCA+IDIpIHtcbiAgICAgIHRoaXMuX2NvbG9yID0gYXJncztcblxuICAgICAgLy8gU2V0IGRlZmF1bHQgYWxwaGFcbiAgICAgIGlmIChhcmdzLmxlbmd0aCA9PT0gMykge1xuICAgICAgICB0aGlzLl9jb2xvclszXSA9IDE7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2NvbG9yID0gW107XG4gICAgfVxuICB9XG5cbiAgcmdiYSgpIHtcbiAgICByZXR1cm4gdGhpcy5fY29sb3Iuc2xpY2UoMCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjb2xvciBvcGFjaXR5XG4gICAqL1xuICBhbHBoYSgpOiBudW1iZXI7XG4gIC8qKlxuICAgKiBTZXQgdGhlIGNvbG9yIG9wYWNpdHlcbiAgICogQHBhcmFtIHZhbHVlIG9wYWNpdHlcbiAgICovXG4gIGFscGhhKHZhbHVlOiBudW1iZXIpOiBDb2xvcjtcbiAgYWxwaGEodmFsdWU/OiBudW1iZXIpIHtcbiAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2NvbG9yWzNdO1xuICAgIH1cblxuICAgIC8vIENsb25lXG4gICAgY29uc3QgX2NvbG9yID0gdGhpcy5yZ2JhKCk7XG5cbiAgICAvLyBTZXQgYWxwaGFcbiAgICBfY29sb3JbM10gPSB2YWx1ZTtcbiAgICByZXR1cm4gbmV3IENvbG9yKC4uLl9jb2xvcik7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgcmVsYXRpdmUgYnJpZ2h0bmVzc1xuICAgKi9cbiAgbHVtaW5hbmNlKCk6IG51bWJlcjtcbiAgLyoqXG4gICAqIE5vcm1hbGl6ZWQgdG8gMCBmb3IgZGFya2VzdCBibGFjayBhbmQgMSBmb3IgbGlnaHRlc3Qgd2hpdGUuXG4gICAqIEBwYXJhbSBsdW0gMCB0byAxXG4gICAqL1xuICBsdW1pbmFuY2UobHVtOiBudW1iZXIpOiBDb2xvcjtcbiAgbHVtaW5hbmNlKGx1bT86IG51bWJlcikge1xuICAgIGlmIChsdW0gPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIHJnYlRvTHVtaW5hbmNlKC4uLih0aGlzLl9jb2xvciBhcyBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl0pKTtcbiAgICB9XG5cbiAgICBpZiAobHVtID09PSAwKSB7XG4gICAgICAvLyByZXR1cm4gcHVyZSBibGFja1xuICAgICAgcmV0dXJuIG5ldyBDb2xvcigwLCAwLCAwLCB0aGlzLl9jb2xvclszXSk7XG4gICAgfVxuICAgIGlmIChsdW0gPT09IDEpIHtcbiAgICAgIC8vIHJldHVybiBwdXJlIHdoaXRlXG4gICAgICByZXR1cm4gbmV3IENvbG9yKDI1NSwgMjU1LCAyNTUsIHRoaXMuX2NvbG9yWzNdKTtcbiAgICB9XG5cbiAgICBjb25zdCByZWxhdGl2ZUx1bWluYW5jZSA9IHRoaXMubHVtaW5hbmNlKCk7XG4gICAgbGV0IG1heF9pdGVyID0gTUFYX0lURVI7XG5cbiAgICBjb25zdCB0ZXN0ID0gKGxvdzogQ29sb3IsIGhpZ2g6IENvbG9yKTogQ29sb3IgPT4ge1xuICAgICAgY29uc3QgbWlkID0gbmV3IENvbG9yKC4uLmludGVycG9sYXRlUmdiKGxvdy5yZ2JhKCksIGhpZ2gucmdiYSgpLCAwLjUpKTtcbiAgICAgIGNvbnN0IGxtID0gbWlkLmx1bWluYW5jZSgpIGFzIG51bWJlcjtcblxuICAgICAgaWYgKE1hdGguYWJzKGx1bSAtIGxtKSA8IEVQUyB8fCAhbWF4X2l0ZXItLSkge1xuICAgICAgICByZXR1cm4gbWlkO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbG0gPiBsdW0gPyB0ZXN0KGxvdywgbWlkKSA6IHRlc3QobWlkLCBoaWdoKTtcbiAgICB9O1xuXG4gICAgY29uc3QgcmdiID0gKHJlbGF0aXZlTHVtaW5hbmNlID4gbHVtXG4gICAgICAgID8gdGVzdChuZXcgQ29sb3IoMCwgMCwgMCksIHRoaXMpXG4gICAgICAgIDogdGVzdCh0aGlzLCBuZXcgQ29sb3IoMjU1LCAyNTUsIDI1NSkpKS5yZ2JhKCk7XG4gICAgcmdiLnBvcCgpO1xuICAgIHJnYi5wdXNoKHRoaXMuX2NvbG9yWyAzIF0pO1xuXG4gICAgcmV0dXJuIG5ldyBDb2xvciguLi5yZ2IpO1xuXG4gIH1cbiAgLyoqXG4gICAqIENoYW5nZXMgdGhlIHNhdHVyYXRpb24gb2YgYSBjb2xvciBieSBtYW5pcHVsYXRpbmcgdGhlIExjaCBjaHJvbWF0aWNpdHkuXG4gICAqIEBwYXJhbSBhbW91bnQgZGVmYXVsdDogMVxuICAgKi9cbiAgc2F0dXJhdGUoYW1vdW50ID0gMSkge1xuICAgIGNvbnN0IGxhYiA9IHJnYlRvTGFiKHRoaXMuX2NvbG9yKTtcbiAgICBjb25zdCBsY2ggPSBsYWJUb0xjaChsYWIpO1xuXG4gICAgbGNoWzFdICs9IDE4ICogYW1vdW50O1xuXG4gICAgaWYgKGxjaFsxXSA8IDApIHtcbiAgICAgIGxjaFsxXSA9IDA7XG4gICAgfVxuXG4gICAgY29uc3QgbGFiRnJvbUxjaCA9IGxjaFRvTGFiKGxjaCk7XG4gICAgY29uc3QgeHl6RnJvbUxhYiA9IGxhYlRvWHl6KGxhYkZyb21MY2gpO1xuICAgIGNvbnN0IHJnYiA9IHh5elRvUmdiKHh5ekZyb21MYWIpO1xuXG4gICAgLy8gU2V0IGFscGhhXG4gICAgcmdiLnB1c2godGhpcy5fY29sb3JbM10pO1xuXG4gICAgcmV0dXJuIG5ldyBDb2xvciguLi5yZ2IpO1xuICB9XG4gIC8qKlxuICAgKiBTaW1pbGFyIHRvIHNhdHVyYXRlLCBidXQgdGhlIG9wcG9zaXRlIGRpcmVjdGlvbi5cbiAgICogQHBhcmFtIGFtb3VudCBkZWZhdWx0OiAxXG4gICAqL1xuICBkZXNhdHVyYXRlKGFtb3VudCA9IDEpIHtcbiAgICByZXR1cm4gdGhpcy5zYXR1cmF0ZSgtYW1vdW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0gYW1vdW50IGRlZmF1bHQ6IDFcbiAgICovXG4gIGRhcmtlbihhbW91bnQgPSAxKSB7XG4gICAgY29uc3QgbGFiID0gcmdiVG9MYWIodGhpcy5fY29sb3IpO1xuICAgIGxhYlswXSAtPSAxOCAqIGFtb3VudDtcbiAgICBjb25zdCB4eXpGcm9tTGFiID0gbGFiVG9YeXoobGFiKTtcbiAgICBjb25zdCByZ2IgPSB4eXpUb1JnYih4eXpGcm9tTGFiKTtcblxuICAgIC8vIFNldCBhbHBoYVxuICAgIHJnYi5wdXNoKHRoaXMuX2NvbG9yWzNdKTtcblxuICAgIHJldHVybiBuZXcgQ29sb3IoLi4ucmdiKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgb3Bwb3NpdGUgb2YgZGFya2VuXG4gICAqIEBwYXJhbSBhbW91bnQgZGVmYXVsdCAxXG4gICAqL1xuICBicmlnaHRlbihhbW91bnQgPSAxKSB7XG4gICAgcmV0dXJuIHRoaXMuZGFya2VuKC1hbW91bnQpO1xuICB9XG5cbiAgY3NzKCkge1xuICAgIGlmICghdGhpcy5fY29sb3IubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gJ3VuZGVmaW5lZCAtIGludmFsaWQgY29sb3InO1xuICAgIH1cbiAgICByZXR1cm4gcmdiVG9Dc3ModGhpcy5yZ2JhKCkgYXMgW251bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcl0pO1xuICB9XG5cbiAgdG9TdHJpbmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3NzKCk7XG4gIH1cblxufVxuXG5cbi8vIC8qKlxuLy8gICogQ29udmVydCBudW1iZXIgdG8gQ1NTXG4vLyAgKiAweDAwYmNkNCA+ICMwMGJjZDRcbi8vICAqIEBwYXJhbSBpbnQgSW50XG4vLyAgKi9cbi8vIGZ1bmN0aW9uIGJpZ0ludFRvQ3NzKGludDogbnVtYmVyKSB7XG4vLyAgIGNvbnN0IGhleCA9IGludC50b1N0cmluZygxNik7XG4vLyAgIHJldHVybiAnIzAwMDAwMCcuc3Vic3RyaW5nKDAsIDcgLSBoZXgubGVuZ3RoKSArIGhleDtcbi8vIH1cblxuZnVuY3Rpb24gcmdiVG9Dc3MocmdiOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyXSkge1xuICBjb25zdCBhbHBoYSA9IHJnYi5wb3AoKTtcbiAgaWYgKGFscGhhID09PSAxKSB7XG4gICAgcmV0dXJuIGByZ2IoJHtyZ2IubWFwKE1hdGgucm91bmQpLmpvaW4oKX0pYDtcbiAgfVxuICByZXR1cm4gYHJnYmEoJHtyZ2IubWFwKE1hdGgucm91bmQpLmpvaW4oKX0sJHthbHBoYX0pYDtcbn1cblxuZnVuY3Rpb24gYmlnSW50VG9SZ2IoYmlnSW50OiBudW1iZXIsIGFscGhhID0gMSkge1xuICAvLyBpZiAoYmlnSW50IDwgMHgxMDAwKSB7XG4gIC8vICAgYmlnSW50ID0gcGFyc2VJbnQoYmlnSW50LnRvU3RyaW5nKDE2KS5zcGxpdCgnJykubWFwKGNoYXIgPT4ge1xuICAvLyAgICAgcmV0dXJuIGNoYXIgKyBjaGFyO1xuICAvLyAgIH0pLmpvaW4oJycpLCAxNik7XG4gIC8vIH1cbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1iaXR3aXNlXG4gIGNvbnN0IHJlZCA9IChiaWdJbnQgPj4gMTYpICYgMHhmZjtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1iaXR3aXNlXG4gIGNvbnN0IGdyZWVuID0gKGJpZ0ludCA+PiA4KSAmIDB4ZmY7XG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8tYml0d2lzZVxuICBjb25zdCBibHVlID0gYmlnSW50ICYgMHhmZjtcblxuICByZXR1cm4gW3JlZCwgZ3JlZW4sIGJsdWUsIGFscGhhXTtcbn1cblxuLy8gZnVuY3Rpb24gcmdiVG9CaWdJbnQocjogbnVtYmVyLCBnOiBudW1iZXIsIGI6IG51bWJlcikge1xuLy8gICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IG5vLWJpdHdpc2Vcbi8vICAgcmV0dXJuIChyIDw8IDE2KSArIChnIDw8IDgpICsgYjtcbi8vIH1cblxuZnVuY3Rpb24gcmdiVG9YeXoocmdiOiBudW1iZXJbXSkge1xuICBsZXQgciA9IHJnYlswXSAvIDI1NTtcbiAgbGV0IGcgPSByZ2JbMV0gLyAyNTU7XG4gIGxldCBiID0gcmdiWzJdIC8gMjU1O1xuXG4gIC8vIEFzc3VtZSBzUkdCXG4gIHIgPSByID4gMC4wNDA0NSA/ICgoKHIgKyAwLjA1NSkgLyAxLjA1NSkgKiogMi40KSA6IChyIC8gMTIuOTIpO1xuICBnID0gZyA+IDAuMDQwNDUgPyAoKChnICsgMC4wNTUpIC8gMS4wNTUpICoqIDIuNCkgOiAoZyAvIDEyLjkyKTtcbiAgYiA9IGIgPiAwLjA0MDQ1ID8gKCgoYiArIDAuMDU1KSAvIDEuMDU1KSAqKiAyLjQpIDogKGIgLyAxMi45Mik7XG5cbiAgY29uc3QgeCA9IChyICogMC40MTI0KSArIChnICogMC4zNTc2KSArIChiICogMC4xODA1KTtcbiAgY29uc3QgeSA9IChyICogMC4yMTI2KSArIChnICogMC43MTUyKSArIChiICogMC4wNzIyKTtcbiAgY29uc3QgeiA9IChyICogMC4wMTkzKSArIChnICogMC4xMTkyKSArIChiICogMC45NTA1KTtcblxuICByZXR1cm4gW3ggKiAxMDAsIHkgKiAxMDAsIHogKiAxMDBdO1xufVxuXG5mdW5jdGlvbiByZ2JUb0xhYihyZ2I6IG51bWJlcltdKSB7XG4gIGNvbnN0IHh5eiA9IHJnYlRvWHl6KHJnYik7XG4gIGxldCB4ID0geHl6WyAwIF07XG4gIGxldCB5ID0geHl6WyAxIF07XG4gIGxldCB6ID0geHl6WyAyIF07XG5cbiAgeCAvPSA5NS4wNDc7XG4gIHkgLz0gMTAwO1xuICB6IC89IDEwOC44ODM7XG5cbiAgeCA9IHggPiAwLjAwODg1NiA/ICh4ICoqICgxIC8gMykpIDogKDcuNzg3ICogeCkgKyAoMTYgLyAxMTYpO1xuICB5ID0geSA+IDAuMDA4ODU2ID8gKHkgKiogKDEgLyAzKSkgOiAoNy43ODcgKiB5KSArICgxNiAvIDExNik7XG4gIHogPSB6ID4gMC4wMDg4NTYgPyAoeiAqKiAoMSAvIDMpKSA6ICg3Ljc4NyAqIHopICsgKDE2IC8gMTE2KTtcblxuICBjb25zdCBsID0gKDExNiAqIHkpIC0gMTY7XG4gIGNvbnN0IGEgPSA1MDAgKiAoeCAtIHkpO1xuICBjb25zdCBiID0gMjAwICogKHkgLSB6KTtcblxuICByZXR1cm4gWyBsLCBhLCBiIF07XG59XG5cbmZ1bmN0aW9uIGxhYlRvTGNoKGxhYjogbnVtYmVyW10pIHtcbiAgY29uc3QgbCA9IGxhYlsgMCBdO1xuICBjb25zdCBhID0gbGFiWyAxIF07XG4gIGNvbnN0IGIgPSBsYWJbIDIgXTtcbiAgbGV0IGg6IG51bWJlcjtcblxuICBjb25zdCBociA9IE1hdGguYXRhbjIoYiwgYSk7XG4gIGggPSBociAqIDM2MCAvIDIgLyBNYXRoLlBJO1xuXG4gIGlmIChoIDwgMCkge1xuICAgIGggKz0gMzYwO1xuICB9XG5cbiAgY29uc3QgYyA9IE1hdGguc3FydChhICogYSArIGIgKiBiKTtcblxuICByZXR1cm4gWyBsLCBjLCBoIF07XG59XG5cbmZ1bmN0aW9uIGxjaFRvTGFiKGxjaDogbnVtYmVyW10pIHtcbiAgY29uc3QgbCA9IGxjaFsgMCBdO1xuICBjb25zdCBjID0gbGNoWyAxIF07XG4gIGNvbnN0IGggPSBsY2hbIDIgXTtcblxuICBjb25zdCBociA9IGggLyAzNjAgKiAyICogTWF0aC5QSTtcbiAgY29uc3QgYSA9IGMgKiBNYXRoLmNvcyhocik7XG4gIGNvbnN0IGIgPSBjICogTWF0aC5zaW4oaHIpO1xuXG4gIHJldHVybiBbIGwsIGEsIGIgXTtcbn1cblxuZnVuY3Rpb24gbGFiVG9YeXoobGFiOiBudW1iZXJbXSkge1xuICBjb25zdCBsID0gbGFiWyAwIF07XG4gIGNvbnN0IGEgPSBsYWJbIDEgXTtcbiAgY29uc3QgYiA9IGxhYlsgMiBdO1xuICBsZXQgeDtcbiAgbGV0IHk7XG4gIGxldCB6O1xuXG4gIHkgPSAobCArIDE2KSAvIDExNjtcbiAgeCA9IGEgLyA1MDAgKyB5O1xuICB6ID0geSAtIGIgLyAyMDA7XG5cbiAgY29uc3QgeTIgPSB5ICoqIDM7XG4gIGNvbnN0IHgyID0geCAqKiAzO1xuICBjb25zdCB6MiA9IHogKiogMztcbiAgeSA9IHkyID4gMC4wMDg4NTYgPyB5MiA6ICh5IC0gMTYgLyAxMTYpIC8gNy43ODc7XG4gIHggPSB4MiA+IDAuMDA4ODU2ID8geDIgOiAoeCAtIDE2IC8gMTE2KSAvIDcuNzg3O1xuICB6ID0gejIgPiAwLjAwODg1NiA/IHoyIDogKHogLSAxNiAvIDExNikgLyA3Ljc4NztcblxuICB4ICo9IDk1LjA0NztcbiAgeSAqPSAxMDA7XG4gIHogKj0gMTA4Ljg4MztcblxuICByZXR1cm4gWyB4LCB5LCB6IF07XG59XG5cbmZ1bmN0aW9uIHh5elRvUmdiKHh5ejogbnVtYmVyW10pIHtcbiAgY29uc3QgeCA9IHh5elsgMCBdIC8gMTAwO1xuICBjb25zdCB5ID0geHl6WyAxIF0gLyAxMDA7XG4gIGNvbnN0IHogPSB4eXpbIDIgXSAvIDEwMDtcbiAgbGV0IHI7XG4gIGxldCBnO1xuICBsZXQgYjtcblxuICByID0gKHggKiAzLjI0MDYpICsgKHkgKiAtMS41MzcyKSArICh6ICogLTAuNDk4Nik7XG4gIGcgPSAoeCAqIC0wLjk2ODkpICsgKHkgKiAxLjg3NTgpICsgKHogKiAwLjA0MTUpO1xuICBiID0gKHggKiAwLjA1NTcpICsgKHkgKiAtMC4yMDQwKSArICh6ICogMS4wNTcwKTtcblxuICAvLyBBc3N1bWUgc1JHQlxuICByID0gciA+IDAuMDAzMTMwOFxuICAgID8gKCgxLjA1NSAqIChyICoqICgxLjAgLyAyLjQpKSkgLSAwLjA1NSlcbiAgICA6IHIgKiAxMi45MjtcblxuICBnID0gZyA+IDAuMDAzMTMwOFxuICAgID8gKCgxLjA1NSAqIChnICoqICgxLjAgLyAyLjQpKSkgLSAwLjA1NSlcbiAgICA6IGcgKiAxMi45MjtcblxuICBiID0gYiA+IDAuMDAzMTMwOFxuICAgID8gKCgxLjA1NSAqIChiICoqICgxLjAgLyAyLjQpKSkgLSAwLjA1NSlcbiAgICA6IGIgKiAxMi45MjtcblxuICByID0gbWluKG1heCgwLCByKSwgMSk7XG4gIGcgPSBtaW4obWF4KDAsIGcpLCAxKTtcbiAgYiA9IG1pbihtYXgoMCwgYiksIDEpO1xuXG4gIHJldHVybiBbIHIgKiAyNTUsIGcgKiAyNTUsIGIgKiAyNTUgXTtcbn1cblxuZnVuY3Rpb24gcmdiVG9MdW1pbmFuY2UocjogbnVtYmVyLCBnOiBudW1iZXIsIGI6IG51bWJlcikge1xuICAvLyBSZWxhdGl2ZSBsdW1pbmFuY2VcbiAgLy8gU2VlIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMDgvUkVDLVdDQUcyMC0yMDA4MTIxMS8jcmVsYXRpdmVsdW1pbmFuY2VkZWZcbiAgciA9IGx1bWluYW5jZV9jaGFubmVsKHIpO1xuICBnID0gbHVtaW5hbmNlX2NoYW5uZWwoZyk7XG4gIGIgPSBsdW1pbmFuY2VfY2hhbm5lbChiKTtcbiAgcmV0dXJuIDAuMjEyNiAqIHIgKyAwLjcxNTIgKiBnICsgMC4wNzIyICogYjtcbn1cblxuZnVuY3Rpb24gbHVtaW5hbmNlX2NoYW5uZWwoeDogbnVtYmVyKSB7XG4gIHggLz0gMjU1O1xuICByZXR1cm4geCA8PSAwLjAzOTI4ID8geCAvIDEyLjkyIDogcG93KCh4ICsgMC4wNTUpIC8gMS4wNTUsIDIuNCk7XG59XG5cbmZ1bmN0aW9uIGludGVycG9sYXRlUmdiKHJnYjE6IG51bWJlcltdLCByZ2IyOiBudW1iZXJbXSwgZiA9IDAuNSkge1xuXG4gIHJldHVybiBbXG4gICAgcmdiMVsgMCBdICsgZiAqIChyZ2IyWyAwIF0gLSByZ2IxWyAwIF0pLFxuICAgIHJnYjFbIDEgXSArIGYgKiAocmdiMlsgMSBdIC0gcmdiMVsgMSBdKSxcbiAgICByZ2IxWyAyIF0gKyBmICogKHJnYjJbIDIgXSAtIHJnYjFbIDIgXSksXG4gIF07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoZXhDb2xvclRvSW50KF9jb2xvcjogc3RyaW5nKSB7XG4gIGlmIChfY29sb3Iuc3RhcnRzV2l0aCgnIycpKSB7XG4gICAgcmV0dXJuIHBhcnNlSW50KF9jb2xvci5zbGljZSgxKSwgMTYpO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgdG8gc3RhcnQgd2l0aCAnIycgdGhlIGdpdmVuIHZhbHVlIGlzOiAke19jb2xvcn1gKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbG9yKGhleDogbnVtYmVyLCBhbHBoYT86IG51bWJlcik6IENvbG9yO1xuZXhwb3J0IGZ1bmN0aW9uIGNvbG9yKHI6IG51bWJlciwgZzogbnVtYmVyLCBiOiBudW1iZXIsIGFscGhhPzogbnVtYmVyKTogQ29sb3I7XG5leHBvcnQgZnVuY3Rpb24gY29sb3IoLi4uYXJnczogbnVtYmVyW10pOiBDb2xvcjtcbmV4cG9ydCBmdW5jdGlvbiBjb2xvciguLi5hcmdzOiAobnVtYmVyIHwgdW5kZWZpbmVkKVtdKTogQ29sb3Ige1xuICByZXR1cm4gbmV3IENvbG9yKC4uLmFyZ3MgYXMgbnVtYmVyW10pO1xufVxuIl19