import { Directive, Input, ElementRef, Renderer2 } from '@angular/core';
import { toBoolean, LyTheme2, getLyThemeVariableUndefinedError } from '@alyle/ui';
import { Subject } from 'rxjs';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@alyle/ui';
const STYLE_PRIORITY = -0.9;
export const STYLES = (theme, ref) => {
    const classes = ref.selectorsOf(STYLES);
    const { after } = theme;
    return {
        $priority: STYLE_PRIORITY,
        $name: LyAccordion.и,
        $global: () => (className) => `${className} ${classes.panelTitle},${className} ${classes.panelDescription}{display:flex;margin-${after}:16px;}${className} ${classes.panel}:not(${classes.disabled}) ${classes.panelTitle}{color:${theme.text.default};}${className} ${classes.panel}:not(${classes.disabled}) ${classes.panelDescription}{color:${theme.text.secondary};}`,
        root: (theme.expansion && theme.expansion.root) ? () => theme.expansion.root(classes) : null,
        panel: () => (className) => `${className}{display:block;overflow:hidden;position:relative;}${className}:not(${classes.disabled}) ${classes.panelHeader}{cursor:pointer;}`,
        panelHeader: () => (className) => `${className}{display:flex;position:relative;flex-direction:row;align-items:center;padding:0 24px;transition:height ${theme.animations.durations.entering}ms ${theme.animations.curves.standard};font-family:${theme.typography.fontFamily};font-size:${theme.pxToRem(15)};font-weight:400;}${classes.panel}:not(${classes.expanded}):not(${classes.disabled}) ${className}:hover{background:${theme.hover};}@media (hover: none){${classes.panel}:not(${classes.expanded}):not(${classes.disabled}) ${className}:hover{background:none;}}`,
        panelHeaderContent: (className) => `${className}{display:flex;flex:1;flex-direction:row;align-items:center;overflow:hidden;}`,
        panelContent: (className) => `${className}{display:flex;flex-direction:column;overflow:visible;}`,
        panelBody: (className) => `${className}{visibility:hidden;padding:0 24px 16px;transition:visibility ${theme.animations.durations.entering}ms ${theme.animations.curves.standard};font-family:${theme.typography.fontFamily};font-size:${theme.pxToRem(14)};font-weight:400;line-height:${theme.pxToRem(20)};}`,
        panelTitle: (className) => `${className}{flex-grow:1;}`,
        panelDescription: (className) => `${className}{flex-grow:2;}`,
        panelActionRow: (className) => `${className}{border-top:1px solid ${theme.divider};display:flex;flex-direction:row;justify-content:flex-end;padding:16px 8px 16px 24px;}`,
        expanded: () => (className) => `${className} ${classes.panelBody}{visibility:visible;}`,
        disabled: (className) => `${className}{color:${theme.disabled.contrast};}`
    };
};
export class LyAccordion {
    constructor(_theme, _renderer, _el) {
        this._theme = _theme;
        this._renderer = _renderer;
        this._el = _el;
        /** @docs-private */
        this.classes = this._theme.addStyleSheet(STYLES);
        this._hasToggle = true;
        /** Stream that emits true/false when openAll/closeAll is triggered. */
        this._openCloseAllActions = new Subject();
    }
    set appearance(val) {
        this._appearance = val;
        this._appearanceClass = this._theme.addStyle(`lyAccordion.appearance:${val}`, (theme, ref) => {
            if (!(theme.expansion.appearance && theme.expansion.appearance[val])) {
                throw new Error(`Value expansion.appearance['${val}'] not found in ThemeVariables`);
            }
            const classes = ref.selectorsOf(STYLES);
            return theme.expansion.appearance[val](classes);
        }, this._el.nativeElement, this._appearanceClass, STYLE_PRIORITY);
    }
    get appearance() {
        return this._appearance;
    }
    set multiple(val) {
        this._multiple = toBoolean(val);
    }
    get multiple() {
        return this._multiple;
    }
    set hasToggle(val) {
        this._hasToggle = toBoolean(val);
    }
    get hasToggle() {
        return this._hasToggle;
    }
    ngOnInit() {
        const { expansion } = this._theme.variables;
        if (expansion) {
            this._renderer.addClass(this._el.nativeElement, this.classes.root);
            // Apply default config
            if (expansion.defaultConfig && expansion.defaultConfig.appearance) {
                if (this.appearance == null) {
                    this.appearance = expansion.defaultConfig.appearance;
                }
            }
        }
        else {
            throw getLyThemeVariableUndefinedError('expansion');
        }
    }
    closeAll() {
        this._openCloseAll(true);
    }
    openAll() {
        this._openCloseAll(false);
    }
    _openCloseAll(expanded) {
        if (this.multiple) {
            this._openCloseAllActions.next(expanded);
        }
    }
}
LyAccordion.ɵfac = function LyAccordion_Factory(t) { return new (t || LyAccordion)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.LyTheme2), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
LyAccordion.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: LyAccordion, selectors: [["ly-accordion"]], inputs: { appearance: "appearance", multiple: "multiple", hasToggle: "hasToggle" }, exportAs: ["lyAccordion"] });
/** @docs-private */
LyAccordion.и = 'LyAccordion';
LyAccordion.ctorParameters = () => [
    { type: LyTheme2 },
    { type: Renderer2 },
    { type: ElementRef }
];
LyAccordion.propDecorators = {
    appearance: [{ type: Input }],
    multiple: [{ type: Input }],
    hasToggle: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LyAccordion, [{
        type: Directive,
        args: [{
                selector: 'ly-accordion',
                exportAs: 'lyAccordion'
            }]
    }], function () { return [{ type: ɵngcc1.LyTheme2 }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc0.ElementRef }]; }, { appearance: [{
            type: Input
        }], multiple: [{
            type: Input
        }], hasToggle: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjb3JkaW9uLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9saWIvZXhwYW5zaW9uL2FjY29yZGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQVUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hGLE9BQU8sRUFDTCxTQUFTLEVBRVQsUUFBUSxFQUNSLGdDQUFnQyxFQUdqQixNQUFNLFdBQVcsQ0FBQztBQUNuQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDOzs7QUFlL0IsTUFBTSxjQUFjLEdBQUcsQ0FBQyxHQUFHLENBQUM7QUFFNUIsTUFBTSxDQUFDLE1BQU0sTUFBTSxHQUFHLENBQUMsS0FBMEMsRUFBRSxHQUFhLEVBQUUsRUFBRTtBQUNwRixJQUNFLE1BQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDMUMsSUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsS0FBSyxDQUFDO0FBQzFCLElBQ0UsT0FBTztBQUNULFFBQUksU0FBUyxFQUFFLGNBQWM7QUFDN0IsUUFBSSxLQUFLLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFDeEIsUUFBSSxPQUFPLEVBQUUsR0FBSSxFQUFFLENBQUMsQ0FBQyxTQUFpQixFQUFFLEVBQUUsQ0FBQyxHQUFHLFNBQVMsSUFBSSxPQUFPLENBQUMsVUFBVSxJQUFJLFNBQVMsSUFBSSxPQUFPLENBQUMsZ0JBQWdCLHdCQUF3QixLQUFLLFVBQVUsU0FBUyxJQUFJLE9BQU8sQ0FBQyxLQUFLLFFBQVEsT0FBTyxDQUFDLFFBQVEsS0FBSyxPQUFPLENBQUMsVUFBVSxVQUFVLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxLQUFLLFNBQVMsSUFBSSxPQUFPLENBQUMsS0FBSyxRQUFRLE9BQU8sQ0FBQyxRQUFRLEtBQUssT0FBTyxDQUFDLGdCQUFnQixVQUFVLEtBQUssQ0FBQyxJQUFJLENB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QUFJLFFBQ3pDLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtBQUN2QixZQUFNLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDL0MsU0FBSztBQUNMLElBQUUsQ0FBQztBQUNIOztpTkFDQTtBQXRGRSxvQkFBb0I7QUFDSixhQUFDLEdBQUcsYUFBYSxDQUFDLEFBSC9CO0FBQUM7RUFKTCxTQUFTLFNBQUMscEJBSWdDLFlBbkR6QyxRQUFRO2NBZ0RSLFFBQVEsRUFBRSx4QkEvQ1YsWUFMNkMsU0FBUzthQW9EOUIsYkFwRGtDLFlBQWpDLFVBQVU7QUFBRztHQXFEdEMsUUFBUSxFQUFFLGFBQWEsMUJBckRrQjtTQXNEMUMsVEF0RHlFLHlCQXVFdkUsS0FBSztBQUNOLHVCQW9CQyxLQUFLO0FBQ04sd0JBT0MsS0FBSztBQUNQOzs7Ozs7Ozs7Ozs7O29CQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIElucHV0LCBFbGVtZW50UmVmLCBPbkluaXQsIFJlbmRlcmVyMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgdG9Cb29sZWFuLFxuICBUaGVtZVZhcmlhYmxlcyxcbiAgTHlUaGVtZTIsXG4gIGdldEx5VGhlbWVWYXJpYWJsZVVuZGVmaW5lZEVycm9yLFxuICBUaGVtZVJlZixcbiAgTHlDbGFzc2VzLFxuICBTdHlsZVRlbXBsYXRlIH0gZnJvbSAnQGFseWxlL3VpJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcblxuZXhwb3J0IGludGVyZmFjZSBFeHBhbnNpb25Db25maWcge1xuICByb290PzogKGNsYXNzZXM6IEx5Q2xhc3Nlczx0eXBlb2YgU1RZTEVTPikgPT4gU3R5bGVUZW1wbGF0ZTtcbiAgZGVmYXVsdENvbmZpZz86IHtcbiAgICBhcHBlYXJhbmNlPzoga2V5b2YgRXhwYW5zaW9uQ29uZmlnWydhcHBlYXJhbmNlJ11cbiAgfTtcbiAgYXBwZWFyYW5jZToge1xuICAgIHBvcE91dDogKGNsYXNzZXM6IEx5Q2xhc3Nlczx0eXBlb2YgU1RZTEVTPikgPT4gU3R5bGVUZW1wbGF0ZVxuICB9O1xufVxuZXhwb3J0IGludGVyZmFjZSBFeHBhbnNpb25WYXJpYWJsZXMge1xuICBleHBhbnNpb24/OiBFeHBhbnNpb25Db25maWc7XG59XG5cbmNvbnN0IFNUWUxFX1BSSU9SSVRZID0gLTAuOTtcblxuZXhwb3J0IGNvbnN0IFNUWUxFUyA9ICh0aGVtZTogVGhlbWVWYXJpYWJsZXMgJiBFeHBhbnNpb25WYXJpYWJsZXMsIHJlZjogVGhlbWVSZWYpID0+IHtcblxuICBjb25zdCBjbGFzc2VzID0gcmVmLnNlbGVjdG9yc09mKFNUWUxFUyk7XG4gIGNvbnN0IHsgYWZ0ZXIgfSA9IHRoZW1lO1xuXG4gIHJldHVybiB7XG4gICAgJHByaW9yaXR5OiBTVFlMRV9QUklPUklUWSxcbiAgICAkbmFtZTogTHlBY2NvcmRpb24u0LgsXG4gICAgJGdsb2JhbDogKCApID0+IChjbGFzc05hbWU6IHN0cmluZykgPT4gYCR7Y2xhc3NOYW1lfSAke2NsYXNzZXMucGFuZWxUaXRsZX0sJHtjbGFzc05hbWV9ICR7Y2xhc3Nlcy5wYW5lbERlc2NyaXB0aW9ufXtkaXNwbGF5OmZsZXg7bWFyZ2luLSR7YWZ0ZXJ9OjE2cHg7fSR7Y2xhc3NOYW1lfSAke2NsYXNzZXMucGFuZWx9Om5vdCgke2NsYXNzZXMuZGlzYWJsZWR9KSAke2NsYXNzZXMucGFuZWxUaXRsZX17Y29sb3I6JHt0aGVtZS50ZXh0LmRlZmF1bHR9O30ke2NsYXNzTmFtZX0gJHtjbGFzc2VzLnBhbmVsfTpub3QoJHtjbGFzc2VzLmRpc2FibGVkfSkgJHtjbGFzc2VzLnBhbmVsRGVzY3JpcHRpb259e2NvbG9yOiR7dGhlbWUudGV4dC5zZWNvbmRhcnl9O31gLFxuICAgIHJvb3Q6ICh0aGVtZS5leHBhbnNpb24gJiYgdGhlbWUuZXhwYW5zaW9uLnJvb3QpID8gKCkgPT4gdGhlbWUuZXhwYW5zaW9uIS5yb290IShjbGFzc2VzKSA6IG51bGwsXG4gICAgcGFuZWw6ICggKSA9PiAoY2xhc3NOYW1lOiBzdHJpbmcpID0+IGAke2NsYXNzTmFtZX17ZGlzcGxheTpibG9jaztvdmVyZmxvdzpoaWRkZW47cG9zaXRpb246cmVsYXRpdmU7fSR7Y2xhc3NOYW1lfTpub3QoJHtjbGFzc2VzLmRpc2FibGVkfSkgJHtjbGFzc2VzLnBhbmVsSGVhZGVyfXtjdXJzb3I6cG9pbnRlcjt9YCxcbiAgICBwYW5lbEhlYWRlcjogKCApID0+IChjbGFzc05hbWU6IHN0cmluZykgPT4gYCR7Y2xhc3NOYW1lfXtkaXNwbGF5OmZsZXg7cG9zaXRpb246cmVsYXRpdmU7ZmxleC1kaXJlY3Rpb246cm93O2FsaWduLWl0ZW1zOmNlbnRlcjtwYWRkaW5nOjAgMjRweDt0cmFuc2l0aW9uOmhlaWdodCAke3RoZW1lLmFuaW1hdGlvbnMuZHVyYXRpb25zLmVudGVyaW5nfW1zICR7dGhlbWUuYW5pbWF0aW9ucy5jdXJ2ZXMuc3RhbmRhcmR9O2ZvbnQtZmFtaWx5OiR7dGhlbWUudHlwb2dyYXBoeS5mb250RmFtaWx5fTtmb250LXNpemU6JHt0aGVtZS5weFRvUmVtKDE1KX07Zm9udC13ZWlnaHQ6NDAwO30ke2NsYXNzZXMucGFuZWx9Om5vdCgke2NsYXNzZXMuZXhwYW5kZWR9KTpub3QoJHtjbGFzc2VzLmRpc2FibGVkfSkgJHtjbGFzc05hbWV9OmhvdmVye2JhY2tncm91bmQ6JHt0aGVtZS5ob3Zlcn07fUBtZWRpYSAoaG92ZXI6IG5vbmUpeyR7Y2xhc3Nlcy5wYW5lbH06bm90KCR7Y2xhc3Nlcy5leHBhbmRlZH0pOm5vdCgke2NsYXNzZXMuZGlzYWJsZWR9KSAke2NsYXNzTmFtZX06aG92ZXJ7YmFja2dyb3VuZDpub25lO319YCxcbiAgICBwYW5lbEhlYWRlckNvbnRlbnQ6IChjbGFzc05hbWU6IHN0cmluZykgPT4gYCR7Y2xhc3NOYW1lfXtkaXNwbGF5OmZsZXg7ZmxleDoxO2ZsZXgtZGlyZWN0aW9uOnJvdzthbGlnbi1pdGVtczpjZW50ZXI7b3ZlcmZsb3c6aGlkZGVuO31gLFxuICAgIHBhbmVsQ29udGVudDogKGNsYXNzTmFtZTogc3RyaW5nKSA9PiBgJHtjbGFzc05hbWV9e2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47b3ZlcmZsb3c6dmlzaWJsZTt9YCxcbiAgICBwYW5lbEJvZHk6IChjbGFzc05hbWU6IHN0cmluZykgPT4gYCR7Y2xhc3NOYW1lfXt2aXNpYmlsaXR5OmhpZGRlbjtwYWRkaW5nOjAgMjRweCAxNnB4O3RyYW5zaXRpb246dmlzaWJpbGl0eSAke1xuICAgICAgICB0aGVtZS5hbmltYXRpb25zLmR1cmF0aW9ucy5lbnRlcmluZ31tcyAke1xuICAgICAgICB0aGVtZS5hbmltYXRpb25zLmN1cnZlcy5zdGFuZGFyZH07Zm9udC1mYW1pbHk6JHt0aGVtZS50eXBvZ3JhcGh5LmZvbnRGYW1pbHl9O2ZvbnQtc2l6ZToke3RoZW1lLnB4VG9SZW0oMTQpfTtmb250LXdlaWdodDo0MDA7bGluZS1oZWlnaHQ6JHt0aGVtZS5weFRvUmVtKDIwKX07fWAsXG4gICAgcGFuZWxUaXRsZTogKGNsYXNzTmFtZTogc3RyaW5nKSA9PiBgJHtjbGFzc05hbWV9e2ZsZXgtZ3JvdzoxO31gLFxuICAgIHBhbmVsRGVzY3JpcHRpb246IChjbGFzc05hbWU6IHN0cmluZykgPT4gYCR7Y2xhc3NOYW1lfXtmbGV4LWdyb3c6Mjt9YCxcbiAgICBwYW5lbEFjdGlvblJvdzogKGNsYXNzTmFtZTogc3RyaW5nKSA9PiBgJHtjbGFzc05hbWV9e2JvcmRlci10b3A6MXB4IHNvbGlkICR7dGhlbWUuZGl2aWRlcn07ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOnJvdztqdXN0aWZ5LWNvbnRlbnQ6ZmxleC1lbmQ7cGFkZGluZzoxNnB4IDhweCAxNnB4IDI0cHg7fWAsXG4gICAgZXhwYW5kZWQ6ICggKSA9PiAoY2xhc3NOYW1lOiBzdHJpbmcpID0+IGAke2NsYXNzTmFtZX0gJHtjbGFzc2VzLnBhbmVsQm9keX17dmlzaWJpbGl0eTp2aXNpYmxlO31gLFxuICAgIGRpc2FibGVkOiAoY2xhc3NOYW1lOiBzdHJpbmcpID0+IGAke2NsYXNzTmFtZX17Y29sb3I6JHt0aGVtZS5kaXNhYmxlZC5jb250cmFzdH07fWBcbiAgfTtcbn07XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ2x5LWFjY29yZGlvbicsXG4gIGV4cG9ydEFzOiAnbHlBY2NvcmRpb24nXG59KVxuZXhwb3J0IGNsYXNzIEx5QWNjb3JkaW9uIGltcGxlbWVudHMgT25Jbml0IHtcblxuICAvKiogQGRvY3MtcHJpdmF0ZSAqL1xuICBzdGF0aWMgcmVhZG9ubHkg0LggPSAnTHlBY2NvcmRpb24nO1xuXG4gIC8qKiBAZG9jcy1wcml2YXRlICovXG4gIHJlYWRvbmx5IGNsYXNzZXMgPSB0aGlzLl90aGVtZS5hZGRTdHlsZVNoZWV0KFNUWUxFUyk7XG5cbiAgcHJpdmF0ZSBfYXBwZWFyYW5jZTogc3RyaW5nO1xuICBwcml2YXRlIF9tdWx0aXBsZTogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfaGFzVG9nZ2xlID0gdHJ1ZTtcbiAgcHJpdmF0ZSBfYXBwZWFyYW5jZUNsYXNzOiBzdHJpbmc7XG5cbiAgLyoqIFN0cmVhbSB0aGF0IGVtaXRzIHRydWUvZmFsc2Ugd2hlbiBvcGVuQWxsL2Nsb3NlQWxsIGlzIHRyaWdnZXJlZC4gKi9cbiAgcmVhZG9ubHkgX29wZW5DbG9zZUFsbEFjdGlvbnM6IFN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuXG4gIEBJbnB1dCgpXG4gIHNldCBhcHBlYXJhbmNlKHZhbDogc3RyaW5nKSB7XG4gICAgdGhpcy5fYXBwZWFyYW5jZSA9IHZhbDtcbiAgICB0aGlzLl9hcHBlYXJhbmNlQ2xhc3MgPSB0aGlzLl90aGVtZS5hZGRTdHlsZShcbiAgICAgIGBseUFjY29yZGlvbi5hcHBlYXJhbmNlOiR7dmFsfWAsXG4gICAgICAodGhlbWU6IFRoZW1lVmFyaWFibGVzICYgRXhwYW5zaW9uVmFyaWFibGVzLCByZWY6IFRoZW1lUmVmKSA9PiB7XG4gICAgICAgIGlmICghKHRoZW1lLmV4cGFuc2lvbiEuYXBwZWFyYW5jZSAmJiB0aGVtZS5leHBhbnNpb24hLmFwcGVhcmFuY2VbdmFsXSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZhbHVlIGV4cGFuc2lvbi5hcHBlYXJhbmNlWycke3ZhbH0nXSBub3QgZm91bmQgaW4gVGhlbWVWYXJpYWJsZXNgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjbGFzc2VzID0gcmVmLnNlbGVjdG9yc09mKFNUWUxFUyk7XG4gICAgICAgIHJldHVybiB0aGVtZS5leHBhbnNpb24hLmFwcGVhcmFuY2VbdmFsXSEoY2xhc3Nlcyk7XG4gICAgICB9LFxuICAgICAgdGhpcy5fZWwubmF0aXZlRWxlbWVudCxcbiAgICAgIHRoaXMuX2FwcGVhcmFuY2VDbGFzcyxcbiAgICAgIFNUWUxFX1BSSU9SSVRZXG4gICAgKTtcbiAgfVxuICBnZXQgYXBwZWFyYW5jZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fYXBwZWFyYW5jZTtcbiAgfVxuXG4gIEBJbnB1dCgpXG4gIHNldCBtdWx0aXBsZSh2YWw6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9tdWx0aXBsZSA9IHRvQm9vbGVhbih2YWwpO1xuICB9XG4gIGdldCBtdWx0aXBsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fbXVsdGlwbGU7XG4gIH1cblxuICBASW5wdXQoKVxuICBzZXQgaGFzVG9nZ2xlKHZhbDogYm9vbGVhbikge1xuICAgIHRoaXMuX2hhc1RvZ2dsZSA9IHRvQm9vbGVhbih2YWwpO1xuICB9XG4gIGdldCBoYXNUb2dnbGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2hhc1RvZ2dsZTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgX3RoZW1lOiBMeVRoZW1lMixcbiAgICBwcml2YXRlIF9yZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgX2VsOiBFbGVtZW50UmVmKSB7IH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBjb25zdCB7IGV4cGFuc2lvbiB9ID0gdGhpcy5fdGhlbWUudmFyaWFibGVzIGFzIEV4cGFuc2lvblZhcmlhYmxlcztcbiAgICBpZiAoZXhwYW5zaW9uKSB7XG4gICAgICB0aGlzLl9yZW5kZXJlci5hZGRDbGFzcyh0aGlzLl9lbC5uYXRpdmVFbGVtZW50LCB0aGlzLmNsYXNzZXMucm9vdCk7XG5cbiAgICAgIC8vIEFwcGx5IGRlZmF1bHQgY29uZmlnXG4gICAgICBpZiAoZXhwYW5zaW9uLmRlZmF1bHRDb25maWcgJiYgZXhwYW5zaW9uLmRlZmF1bHRDb25maWcuYXBwZWFyYW5jZSkge1xuICAgICAgICBpZiAodGhpcy5hcHBlYXJhbmNlID09IG51bGwpIHtcbiAgICAgICAgICB0aGlzLmFwcGVhcmFuY2UgPSBleHBhbnNpb24uZGVmYXVsdENvbmZpZy5hcHBlYXJhbmNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IGdldEx5VGhlbWVWYXJpYWJsZVVuZGVmaW5lZEVycm9yKCdleHBhbnNpb24nKTtcbiAgICB9XG4gIH1cblxuICBjbG9zZUFsbCgpIHtcbiAgICB0aGlzLl9vcGVuQ2xvc2VBbGwodHJ1ZSk7XG4gIH1cblxuICBvcGVuQWxsKCkge1xuICAgIHRoaXMuX29wZW5DbG9zZUFsbChmYWxzZSk7XG4gIH1cblxuICBwcml2YXRlIF9vcGVuQ2xvc2VBbGwoZXhwYW5kZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBpZiAodGhpcy5tdWx0aXBsZSkge1xuICAgICAgdGhpcy5fb3BlbkNsb3NlQWxsQWN0aW9ucy5uZXh0KGV4cGFuZGVkKTtcbiAgICB9XG4gIH1cblxufVxuIl19