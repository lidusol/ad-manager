import { Directive, Input, TemplateRef, Output, EventEmitter } from '@angular/core';
import { LyTheme2, LyOverlay, XPosition, YPosition, st2c } from '@alyle/ui';
import { LySnackBarService } from './snack-bar.service';
import { LySnackBarRef } from './snack-bar-ref';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@alyle/ui';
const STYLE_PRIORITY = -2;
const DEFAULT_HORIZONTAL_POSITION = XPosition.after;
const DEFAULT_VERTICAL_POSITION = YPosition.below;
export const STYLES = (theme) => ({
    $priority: STYLE_PRIORITY,
    root: (className) => `${className}{border-radius:4px;display:flex;justify-content:space-between;align-items:center;margin:8px;padding:0 16px;min-height:48px;min-width:320px;max-width:320px;opacity:0;transition:opacity ${theme.animations.curves.standard} 350ms, transform ${theme.animations.curves.deceleration} 350ms;font-size:${theme.pxToRem(theme.typography.fontSize)};box-sizing:border-box;}${st2c(((theme.snackBar
        && theme.snackBar.root) || null), `${className}`)}@media ${theme.breakpoints['XSmall']}{${className}{width:calc(100% - 16px);min-width:calc(100% - 16px);}}`
});
export class LySnackBar {
    constructor(_templateRef, _theme, _overlay, _snackBarService) {
        this._templateRef = _templateRef;
        this._theme = _theme;
        this._overlay = _overlay;
        this._snackBarService = _snackBarService;
        this.classes = this._theme.renderStyleSheet(STYLES);
        this.afterDismissed = new EventEmitter();
    }
    ngOnDestroy() {
        this.dismiss();
    }
    /**
     * Open a LySnackBar template
     * @param snackBarData Data to be passed to the snack-bark.
     */
    open(snackBarData) {
        // close previous snackBar if exist
        const sbrPrev = this._snackBarService._currentSnackBar;
        if (sbrPrev) {
            sbrPrev.dismiss();
        }
        const duration = this.duration;
        const horizontalPosition = this.horizontalPosition || DEFAULT_HORIZONTAL_POSITION;
        const verticalPosition = this.verticalPosition || DEFAULT_VERTICAL_POSITION;
        const snackBar = this._overlay.create(this._templateRef, snackBarData, {
            styles: {
                // this remove previous style
                justifyContent: null
            },
            hasBackdrop: false,
            classes: [
                this.classes.root,
                this._theme.renderStyle(`SnackBar.hp:${horizontalPosition}.vp:${verticalPosition}`, (theme) => {
                    let marginLeft;
                    let left;
                    let marginRight;
                    let right;
                    let transform;
                    let top;
                    let bottom;
                    let hp;
                    if (verticalPosition === YPosition.above) {
                        transform = 'translateY(-180%)';
                        top = 0;
                    }
                    if (verticalPosition === YPosition.below) {
                        transform = 'translateY(180%)';
                        bottom = 0;
                    }
                    if (horizontalPosition === 'center') {
                        marginRight = marginLeft = 'auto';
                        left = right = 0;
                    }
                    else {
                        hp = theme.getDirection(horizontalPosition);
                    }
                    return (className) => `${className}{margin-left:${marginLeft};left:${left};margin-right:${marginRight};right:${right};transform:${transform};top:${top};bottom:${bottom};${hp}:0;}`;
                }, STYLE_PRIORITY)
            ]
        });
        this._theme.requestAnimationFrame(() => {
            const newClass = this._theme.renderStyle('SnackBar:open', () => ((className) => `${className}{opacity:1;transform:translateY(0);}`), STYLE_PRIORITY);
            snackBar.containerElement.classList.add(newClass);
        });
        window.getComputedStyle(snackBar.containerElement).getPropertyValue('opacity');
        const sbr = new LySnackBarRef(this._snackBarService, snackBar, this.afterDismissed, duration, this._theme);
        this._snackBarService._currentSnackBar = sbr;
        return sbr;
    }
    /** Dismiss snackBar */
    dismiss() {
        const sbr = this._snackBarService._currentSnackBar;
        if (sbr) {
            sbr.dismissWithAction();
        }
    }
}
LySnackBar.ɵfac = function LySnackBar_Factory(t) { return new (t || LySnackBar)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.TemplateRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.LyTheme2), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.LyOverlay), ɵngcc0.ɵɵdirectiveInject(LySnackBarService)); };
LySnackBar.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: LySnackBar, selectors: [["ng-template", "ly-snack-bar", ""]], inputs: { duration: "duration", horizontalPosition: "horizontalPosition", verticalPosition: "verticalPosition" }, outputs: { afterDismissed: "afterDismissed" }, exportAs: ["lySnackBar"] });
LySnackBar.ctorParameters = () => [
    { type: TemplateRef },
    { type: LyTheme2 },
    { type: LyOverlay },
    { type: LySnackBarService }
];
LySnackBar.propDecorators = {
    duration: [{ type: Input }],
    horizontalPosition: [{ type: Input }],
    verticalPosition: [{ type: Input }],
    afterDismissed: [{ type: Output }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LySnackBar, [{
        type: Directive,
        args: [{
                selector: 'ng-template[ly-snack-bar]',
                exportAs: 'lySnackBar'
            }]
    }], function () { return [{ type: ɵngcc0.TemplateRef }, { type: ɵngcc1.LyTheme2 }, { type: ɵngcc1.LyOverlay }, { type: LySnackBarService }]; }, { afterDismissed: [{
            type: Output
        }], duration: [{
            type: Input
        }], horizontalPosition: [{
            type: Input
        }], verticalPosition: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic25hY2stYmFyLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9saWIvc25hY2stYmFyL3NuYWNrLWJhci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUMvRixPQUFPLEVBQ0wsUUFBUSxFQUNSLFNBQVMsRUFFVCxTQUFTLEVBQ1QsU0FBUyxFQUNULElBQUksRUFFYSxNQUFNLFdBQVcsQ0FBQztBQUNyQyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7OztBQVloRCxNQUFNLGNBQWMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUMxQixNQUFNLDJCQUEyQixHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUM7QUFDcEQsTUFBTSx5QkFBeUIsR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDO0FBQ2xELE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxDQUFDLEtBQTJDLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDeEUsSUFBRSxTQUFTLEVBQUUsY0FBYztBQUMzQixJQUFFLElBQUksRUFBRSxDQUFDLFNBQWlCLEVBQUUsRUFBRSxDQUFDLEdBQUcsU0FBUywyTEFBMkwsS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsUUFBUSxxQkFBcUIsS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsWUFBWSxvQkFBb0IsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQywyQkFBMkIsSUFBSSxDQUFDLENBQ25aLENBQUMsS0FBSyxDQUFDLFFBQVE7QUFDdkIsV0FBYSxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxFQUFFLEdBQUcsU0FBUyxFQUFFLENBQUMsVUFBVSxL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QUM7QUFDSCxJQUNFLHVCQUF1QjtBQUN6QixJQUFFLE9BQU87QUFDVCxRQUFJLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQztBQUN2RCxRQUFJLElBQUksR0FBRyxFQUFFO0FBQ2IsWUFBTSxHQUFHLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztBQUM5QixTQUFLO0FBQ0wsSUFBRSxDQUFDO0FBQ0g7c0NBL0ZDLFNBQVMsU0FBQyxrQkFDVCxRQUFRLEVBQUUsMkJBQTJCLGtCQUNyQyxRQUFRLEVBQUUsWUFBWSxjQUN2Qjs4U0FDSTtBQUFDO0FBQW9DLFlBM0NmLFdBQVc7QUFBSSxZQUV4QyxRQUFRO0FBQ1IsWUFBQSxTQUFTO0FBQ1QsWUFNTyxpQkFBaUI7QUFBRztBQUFHO0FBQzNCLHVCQW1DRixLQUFLO0FBQUssaUNBQ1YsS0FBSztBQUFLLCtCQUNWLEtBQUs7QUFBSyw2QkFDVixNQUFNO0FBQUk7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBJbnB1dCwgVGVtcGxhdGVSZWYsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEx5VGhlbWUyLFxuICBMeU92ZXJsYXksXG4gIFRoZW1lVmFyaWFibGVzLFxuICBYUG9zaXRpb24sXG4gIFlQb3NpdGlvbixcbiAgc3QyYyxcbiAgU3R5bGVUZW1wbGF0ZSxcbiAgU3R5bGVDb2xsZWN0aW9uIH0gZnJvbSAnQGFseWxlL3VpJztcbmltcG9ydCB7IEx5U25hY2tCYXJTZXJ2aWNlIH0gZnJvbSAnLi9zbmFjay1iYXIuc2VydmljZSc7XG5pbXBvcnQgeyBMeVNuYWNrQmFyUmVmIH0gZnJvbSAnLi9zbmFjay1iYXItcmVmJztcblxuZXhwb3J0IGludGVyZmFjZSBMeVNuYWNrQmFyVGhlbWUge1xuICAvKiogU3R5bGVzIGZvciBTbmFja0JhciBDb21wb25lbnQgKi9cbiAgcm9vdD86IFN0eWxlVGVtcGxhdGUgfCBTdHlsZUNvbGxlY3Rpb247XG59XG5cblxuZXhwb3J0IGludGVyZmFjZSBMeVNuYWNrQmFyVmFyaWFibGVzIHtcbiAgc25hY2tCYXI/OiBMeVNuYWNrQmFyVGhlbWU7XG59XG5cbmNvbnN0IFNUWUxFX1BSSU9SSVRZID0gLTI7XG5jb25zdCBERUZBVUxUX0hPUklaT05UQUxfUE9TSVRJT04gPSBYUG9zaXRpb24uYWZ0ZXI7XG5jb25zdCBERUZBVUxUX1ZFUlRJQ0FMX1BPU0lUSU9OID0gWVBvc2l0aW9uLmJlbG93O1xuZXhwb3J0IGNvbnN0IFNUWUxFUyA9ICh0aGVtZTogVGhlbWVWYXJpYWJsZXMgJiBMeVNuYWNrQmFyVmFyaWFibGVzKSA9PiAoe1xuICAkcHJpb3JpdHk6IFNUWUxFX1BSSU9SSVRZLFxuICByb290OiAoY2xhc3NOYW1lOiBzdHJpbmcpID0+IGAke2NsYXNzTmFtZX17Ym9yZGVyLXJhZGl1czo0cHg7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuO2FsaWduLWl0ZW1zOmNlbnRlcjttYXJnaW46OHB4O3BhZGRpbmc6MCAxNnB4O21pbi1oZWlnaHQ6NDhweDttaW4td2lkdGg6MzIwcHg7bWF4LXdpZHRoOjMyMHB4O29wYWNpdHk6MDt0cmFuc2l0aW9uOm9wYWNpdHkgJHt0aGVtZS5hbmltYXRpb25zLmN1cnZlcy5zdGFuZGFyZH0gMzUwbXMsIHRyYW5zZm9ybSAke3RoZW1lLmFuaW1hdGlvbnMuY3VydmVzLmRlY2VsZXJhdGlvbn0gMzUwbXM7Zm9udC1zaXplOiR7dGhlbWUucHhUb1JlbSh0aGVtZS50eXBvZ3JhcGh5LmZvbnRTaXplKX07Ym94LXNpemluZzpib3JkZXItYm94O30ke3N0MmMoKFxuICAgICAgICAodGhlbWUuc25hY2tCYXJcbiAgICAgICAgICAmJiB0aGVtZS5zbmFja0Jhci5yb290KSB8fCBudWxsKSwgYCR7Y2xhc3NOYW1lfWApfUBtZWRpYSAke3RoZW1lLmJyZWFrcG9pbnRzWydYU21hbGwnXX17JHtjbGFzc05hbWV9e3dpZHRoOmNhbGMoMTAwJSAtIDE2cHgpO21pbi13aWR0aDpjYWxjKDEwMCUgLSAxNnB4KTt9fWBcbn0pO1xuXG4vKiogRXZlbnQgdGhhdCBpcyBlbWl0dGVkIHdoZW4gYSBzbmFjayBiYXIgaXMgZGlzbWlzc2VkLiAqL1xuZXhwb3J0IGludGVyZmFjZSBMeVNuYWNrQmFyRGlzbWlzcyB7XG4gIC8qKiBXaGV0aGVyIHRoZSBzbmFjayBiYXIgd2FzIGRpc21pc3NlZCB1c2luZyB0aGUgYWN0aW9uIGZuLiAqL1xuICBkaXNtaXNzZWRCeUFjdGlvbjogYm9vbGVhbjtcbn1cblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnbmctdGVtcGxhdGVbbHktc25hY2stYmFyXScsXG4gIGV4cG9ydEFzOiAnbHlTbmFja0Jhcidcbn0pXG5leHBvcnQgY2xhc3MgTHlTbmFja0JhciBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG5cbiAgcmVhZG9ubHkgY2xhc3NlcyA9IHRoaXMuX3RoZW1lLnJlbmRlclN0eWxlU2hlZXQoU1RZTEVTKTtcbiAgQElucHV0KCkgZHVyYXRpb246IG51bWJlciB8ICdJbmZpbml0eSc7XG4gIEBJbnB1dCgpIGhvcml6b250YWxQb3NpdGlvbjogJ2NlbnRlcicgfCBYUG9zaXRpb247XG4gIEBJbnB1dCgpIHZlcnRpY2FsUG9zaXRpb246IFlQb3NpdGlvbjtcbiAgQE91dHB1dCgpIGFmdGVyRGlzbWlzc2VkID0gbmV3IEV2ZW50RW1pdHRlcjxMeVNuYWNrQmFyRGlzbWlzcz4oKTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIF90ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55PixcbiAgICBwcml2YXRlIF90aGVtZTogTHlUaGVtZTIsXG4gICAgcHJpdmF0ZSBfb3ZlcmxheTogTHlPdmVybGF5LFxuICAgIHByaXZhdGUgX3NuYWNrQmFyU2VydmljZTogTHlTbmFja0JhclNlcnZpY2VcbiAgKSB7IH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmRpc21pc3MoKTtcbiAgfVxuICAvKipcbiAgICogT3BlbiBhIEx5U25hY2tCYXIgdGVtcGxhdGVcbiAgICogQHBhcmFtIHNuYWNrQmFyRGF0YSBEYXRhIHRvIGJlIHBhc3NlZCB0byB0aGUgc25hY2stYmFyay5cbiAgICovXG4gIG9wZW4oc25hY2tCYXJEYXRhPzogYW55KSB7XG4gICAgLy8gY2xvc2UgcHJldmlvdXMgc25hY2tCYXIgaWYgZXhpc3RcbiAgICBjb25zdCBzYnJQcmV2ID0gdGhpcy5fc25hY2tCYXJTZXJ2aWNlLl9jdXJyZW50U25hY2tCYXI7XG4gICAgaWYgKHNiclByZXYpIHtcbiAgICAgIHNiclByZXYuZGlzbWlzcygpO1xuICAgIH1cblxuICAgIGNvbnN0IGR1cmF0aW9uID0gdGhpcy5kdXJhdGlvbjtcbiAgICBjb25zdCBob3Jpem9udGFsUG9zaXRpb24gPSB0aGlzLmhvcml6b250YWxQb3NpdGlvbiB8fCBERUZBVUxUX0hPUklaT05UQUxfUE9TSVRJT047XG4gICAgY29uc3QgdmVydGljYWxQb3NpdGlvbiA9IHRoaXMudmVydGljYWxQb3NpdGlvbiB8fCBERUZBVUxUX1ZFUlRJQ0FMX1BPU0lUSU9OO1xuXG4gICAgY29uc3Qgc25hY2tCYXIgPSB0aGlzLl9vdmVybGF5LmNyZWF0ZSh0aGlzLl90ZW1wbGF0ZVJlZiwgc25hY2tCYXJEYXRhLCB7XG4gICAgICBzdHlsZXM6IHtcbiAgICAgICAgLy8gdGhpcyByZW1vdmUgcHJldmlvdXMgc3R5bGVcbiAgICAgICAganVzdGlmeUNvbnRlbnQ6IG51bGxcbiAgICAgIH0sXG4gICAgICBoYXNCYWNrZHJvcDogZmFsc2UsXG4gICAgICBjbGFzc2VzOiBbXG4gICAgICAgIHRoaXMuY2xhc3Nlcy5yb290LFxuICAgICAgICB0aGlzLl90aGVtZS5yZW5kZXJTdHlsZShgU25hY2tCYXIuaHA6JHtob3Jpem9udGFsUG9zaXRpb259LnZwOiR7dmVydGljYWxQb3NpdGlvbn1gLCAodGhlbWU6IFRoZW1lVmFyaWFibGVzKSA9PiB7XG4gICAgICAgICAgbGV0IG1hcmdpbkxlZnQ6ICdhdXRvJyB8IHVuZGVmaW5lZDtcbiAgICAgICAgICBsZXQgbGVmdDogMCB8IHVuZGVmaW5lZDtcbiAgICAgICAgICBsZXQgbWFyZ2luUmlnaHQ6ICdhdXRvJyB8IHVuZGVmaW5lZDtcbiAgICAgICAgICBsZXQgcmlnaHQ6IDAgfCB1bmRlZmluZWQ7XG4gICAgICAgICAgbGV0IHRyYW5zZm9ybTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgICAgICAgIGxldCB0b3A6IG51bWJlciB8IHVuZGVmaW5lZDtcbiAgICAgICAgICBsZXQgYm90dG9tOiBudW1iZXIgfCB1bmRlZmluZWQ7XG4gICAgICAgICAgbGV0IGhwOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgICAgICAgICBpZiAodmVydGljYWxQb3NpdGlvbiA9PT0gWVBvc2l0aW9uLmFib3ZlKSB7XG4gICAgICAgICAgICB0cmFuc2Zvcm0gPSAndHJhbnNsYXRlWSgtMTgwJSknO1xuICAgICAgICAgICAgdG9wID0gMDtcbiAgICAgICAgICB9IGlmICh2ZXJ0aWNhbFBvc2l0aW9uID09PSBZUG9zaXRpb24uYmVsb3cpIHtcbiAgICAgICAgICAgIHRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKDE4MCUpJztcbiAgICAgICAgICAgIGJvdHRvbSA9IDA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChob3Jpem9udGFsUG9zaXRpb24gPT09ICdjZW50ZXInKSB7XG4gICAgICAgICAgICBtYXJnaW5SaWdodCA9IG1hcmdpbkxlZnQgPSAnYXV0byc7XG4gICAgICAgICAgICBsZWZ0ID0gcmlnaHQgPSAwO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBocCA9IHRoZW1lLmdldERpcmVjdGlvbihob3Jpem9udGFsUG9zaXRpb24gYXMgYW55KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gKGNsYXNzTmFtZTogc3RyaW5nKSA9PiBgJHtjbGFzc05hbWV9e21hcmdpbi1sZWZ0OiR7bWFyZ2luTGVmdH07bGVmdDoke2xlZnR9O21hcmdpbi1yaWdodDoke21hcmdpblJpZ2h0fTtyaWdodDoke3JpZ2h0fTt0cmFuc2Zvcm06JHt0cmFuc2Zvcm19O3RvcDoke3RvcH07Ym90dG9tOiR7Ym90dG9tfTske2hwfTowO31gO1xuICAgICAgICB9LCBTVFlMRV9QUklPUklUWSlcbiAgICAgIF1cbiAgICB9KTtcblxuICAgIHRoaXMuX3RoZW1lLnJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICBjb25zdCBuZXdDbGFzcyA9IHRoaXMuX3RoZW1lLnJlbmRlclN0eWxlKCdTbmFja0JhcjpvcGVuJywgKCkgPT4gKFxuICAgICAgICAoY2xhc3NOYW1lOiBzdHJpbmcpID0+IGAke2NsYXNzTmFtZX17b3BhY2l0eToxO3RyYW5zZm9ybTp0cmFuc2xhdGVZKDApO31gXG4gICAgICApLCBTVFlMRV9QUklPUklUWSk7XG4gICAgICBzbmFja0Jhci5jb250YWluZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQobmV3Q2xhc3MpO1xuICAgIH0pO1xuXG4gICAgd2luZG93LmdldENvbXB1dGVkU3R5bGUoc25hY2tCYXIuY29udGFpbmVyRWxlbWVudCkuZ2V0UHJvcGVydHlWYWx1ZSgnb3BhY2l0eScpO1xuXG4gICAgY29uc3Qgc2JyID0gbmV3IEx5U25hY2tCYXJSZWYodGhpcy5fc25hY2tCYXJTZXJ2aWNlLCBzbmFja0JhciwgdGhpcy5hZnRlckRpc21pc3NlZCwgZHVyYXRpb24sIHRoaXMuX3RoZW1lKTtcbiAgICB0aGlzLl9zbmFja0JhclNlcnZpY2UuX2N1cnJlbnRTbmFja0JhciA9IHNicjtcbiAgICByZXR1cm4gc2JyO1xuICB9XG5cbiAgLyoqIERpc21pc3Mgc25hY2tCYXIgKi9cbiAgZGlzbWlzcygpIHtcbiAgICBjb25zdCBzYnIgPSB0aGlzLl9zbmFja0JhclNlcnZpY2UuX2N1cnJlbnRTbmFja0JhcjtcbiAgICBpZiAoc2JyKSB7XG4gICAgICBzYnIuZGlzbWlzc1dpdGhBY3Rpb24oKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==