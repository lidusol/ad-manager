import { XPosition, YPosition } from './position';
export class LyOverlayPosition {
    constructor(_theme, _viewportRuler, _trigger, _overlay) {
        this._theme = _theme;
        this._viewportRuler = _viewportRuler;
        this._trigger = _trigger;
        this._overlay = _overlay;
        this._xAxis = XPosition.after;
        this._yAxis = YPosition.below;
        this._flip = false;
        this._viewportOffset = 16;
        this._viewportHeight = 0;
        this._viewportWidth = 0;
    }
    get x() {
        return this._x;
    }
    get y() {
        return this._y;
    }
    get xo() {
        return this._xo;
    }
    get yo() {
        return this._yo;
    }
    get width() {
        return this._width;
    }
    get height() {
        return this._height;
    }
    build() {
        this._updateRects();
        this._setDefaultAnchor();
        this._updateDir();
        this._callTransformIfExists();
        this._calculateResponsive();
        this._calculateOrigin();
        this._round();
        return this;
    }
    _updateRects() {
        this._triggerRect = getMutableClientRect(this._trigger);
        this._overlayRect = getMutableClientRect(this._overlay);
        const { width, height } = this._viewportRuler.getViewportSize();
        this._viewportWidth = width;
        this._viewportHeight = height;
    }
    _setDefaultAnchor() {
        if (!this._xAnchor) {
            this._xAnchor = this._xAxis === XPosition.after ? XPosition.before : XPosition.after;
        }
        if (!this._yAnchor) {
            this._yAnchor = this._yAxis;
        }
    }
    _callTransformIfExists() {
        if (this._transform) {
            this._transform(this._triggerRect, this._overlayRect);
        }
    }
    _updateDir() {
        // If it is not number
        if (typeof this._xAnchor !== 'number') {
            this._anchorDir = this._theme.variables.getDirection(this._xAnchor);
        }
        this._axisDir = this._theme.variables.getDirection(this._xAxis);
    }
    _calculateResponsive() {
        this._calculate();
        if (this._flip && typeof this._xAnchor === 'string' && typeof this._yAnchor === 'string') {
            if (this._isOverflowX() && (this._overlayRect.width < (this._xa - this._viewportOffset))) {
                this.setXAxis(flipPosition(this._xAxis))
                    .setXAnchor(flipPosition(this._xAnchor));
                this._updateDir();
                this._calculate();
            }
            if (this._isOverflowY() && (this._overlayRect.height < (this._ya - this._viewportOffset))) {
                this.setYAxis(flipPosition(this._yAxis))
                    .setYAnchor(flipPosition(this._yAnchor));
                this._calculate();
            }
        }
        if (this._isOverflowX()) {
            if (this._overlayRect.width > this._viewportWidth - (this._viewportOffset * 2)) {
                this._x = this._viewportOffset;
                this._width = this._viewportWidth - (this._viewportOffset * 2);
            }
            else if (this._isOverflowLeft()) {
                this._x = this._viewportOffset;
            }
            else if (this._isOverflowRight()) {
                this._x = this._viewportWidth - this._overlayRect.width - this._viewportOffset;
            }
        }
        if (this._isOverflowY()) {
            if (this._overlayRect.height > this._viewportHeight - (this._viewportOffset * 2)) {
                this._y = this._viewportOffset;
                this._height = this._viewportHeight - (this._viewportOffset * 2);
            }
            else if (this._isOverflowTop()) {
                this._y = this._viewportOffset;
            }
            else if (this._isOverflowBottom()) {
                this._y = this._viewportHeight - this._overlayRect.height - this._viewportOffset;
            }
        }
    }
    /**
     * Return true if the menu overflows vertically
     */
    _isOverflowX() {
        return this._isOverflowLeft() // Left
            || this._isOverflowRight(); // Right
    }
    _isOverflowLeft() {
        return this.x < this._viewportOffset;
    }
    _isOverflowRight() {
        return (this.x + this._overlayRect.width) > (this._viewportWidth - this._viewportOffset);
    }
    /** Return true the menu overflows horizontally */
    _isOverflowY() {
        return this._isOverflowTop() // Top
            || this._isOverflowBottom(); // Bottom
    }
    _isOverflowTop() {
        return this.y < this._viewportOffset;
    }
    _isOverflowBottom() {
        return (this.y + this._overlayRect.height) > (this._viewportHeight - this._viewportOffset);
    }
    _calculate() {
        this._calculateAnchorPosition();
        this._calculateAxis();
    }
    _calculateAnchorPosition() {
        if (this._anchorDir === 'left' || this._anchorDir === 'right') {
            this._xa = this._triggerRect[this._anchorDir];
        }
        if (this._yAnchor === YPosition.above) {
            this._ya = this._triggerRect.top;
        }
        else {
            this._ya = this._triggerRect.bottom;
        }
    }
    _calculateAxis() {
        if (this._axisDir === 'left') {
            this._x = this._xa - this._overlayRect.width;
        }
        else {
            this._x = this._xa;
        }
        if (this._yAxis === YPosition.above) {
            this._y = this._ya - this._overlayRect.height;
        }
        else {
            this._y = this._ya;
        }
    }
    /** Calculate origin for overlay */
    _calculateOrigin() {
        const xAnchorCenter = this._xa;
        const yAnchorCenter = this._ya;
        const xOverlayCenter = this.x + (this._overlayRect.width / 2);
        const yOverlayCenter = this.y + (this._overlayRect.height / 2);
        const xo = (xAnchorCenter - xOverlayCenter) + this._overlayRect.width / 2;
        const yo = (yAnchorCenter - yOverlayCenter) + this._overlayRect.height / 2;
        this._xo = xo;
        this._yo = yo;
    }
    _round() {
        this._x = Math.round(this.x);
        this._y = Math.round(this.y);
    }
    // setTrigger(val: Element) {
    //   this._trigger = val;
    //   return this;
    // }
    // setOverlay(val: Element) {
    //   this._overlay = val;
    //   return this;
    // }
    setXAnchor(val) {
        this._xAnchor = val;
        return this;
    }
    setYAnchor(val) {
        this._yAnchor = val;
        return this;
    }
    setXAxis(val) {
        this._xAxis = val !== null && val !== void 0 ? val : XPosition.after;
        return this;
    }
    setYAxis(val) {
        this._yAxis = val !== null && val !== void 0 ? val : YPosition.below;
        return this;
    }
    setFlip(flip = true) {
        this._flip = flip;
        return this;
    }
    /**
     * Offset from the edge of the viewport to the center.
     * It is the minimum space that must be between the window and the overlay.
     */
    setViewportOffset(val) {
        this._viewportOffset = val;
        return this;
    }
    setTransform(transform) {
        this._transform = transform;
    }
}
/** Gets a mutable version of an element's bounding `ClientRect`. */
function getMutableClientRect(element) {
    const clientRect = element.getBoundingClientRect();
    // We need to clone the `clientRect` here, because all the values on it are readonly
    // and we need to be able to update them. Also we can't use a spread here, because
    // the values on a `ClientRect` aren't own properties. See:
    // https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect#Notes
    return {
        top: clientRect.top,
        right: clientRect.right,
        bottom: clientRect.bottom,
        left: clientRect.left,
        width: clientRect.width,
        height: clientRect.height
    };
}
function flipPosition(position) {
    switch (position) {
        case XPosition.after:
            return XPosition.before;
        case XPosition.before:
            return XPosition.after;
        case XPosition.left:
            return XPosition.right;
        case XPosition.right:
            return XPosition.left;
        case YPosition.above:
            return YPosition.below;
        case YPosition.below:
            return YPosition.above;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3ZlcmxheS1wb3NpdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2xpYi9zcmMvcG9zaXRpb24vb3ZlcmxheS1wb3NpdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLFlBQVksQ0FBQztBQU1sRCxNQUFNLE9BQU8saUJBQWlCO0lBb0Q1QixZQUNVLE1BQWdCLEVBQ2hCLGNBQTZCLEVBQzdCLFFBQWlCLEVBQ2pCLFFBQWlCO1FBSGpCLFdBQU0sR0FBTixNQUFNLENBQVU7UUFDaEIsbUJBQWMsR0FBZCxjQUFjLENBQWU7UUFDN0IsYUFBUSxHQUFSLFFBQVEsQ0FBUztRQUNqQixhQUFRLEdBQVIsUUFBUSxDQUFTO1FBbkRuQixXQUFNLEdBQWMsU0FBUyxDQUFDLEtBQUssQ0FBQztRQUNwQyxXQUFNLEdBQWMsU0FBUyxDQUFDLEtBQUssQ0FBQztRQUNwQyxVQUFLLEdBQVksS0FBSyxDQUFDO1FBQ3ZCLG9CQUFlLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLG9CQUFlLEdBQVcsQ0FBQyxDQUFDO1FBQzVCLG1CQUFjLEdBQVcsQ0FBQyxDQUFDO0lBK0MvQixDQUFDO0lBbkNMLElBQUksQ0FBQztRQUNILE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQztJQUNqQixDQUFDO0lBR0QsSUFBSSxDQUFDO1FBQ0gsT0FBTyxJQUFJLENBQUMsRUFBRSxDQUFDO0lBQ2pCLENBQUM7SUFHRCxJQUFJLEVBQUU7UUFDSixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUM7SUFDbEIsQ0FBQztJQUdELElBQUksRUFBRTtRQUNKLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUNsQixDQUFDO0lBR0QsSUFBSSxLQUFLO1FBQ1AsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3JCLENBQUM7SUFHRCxJQUFJLE1BQU07UUFDUixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7SUFD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S0FBSyxFQUFFLFVBQVUsQ0FBQyxLQUFLO1FBQ3ZCLE1BQU0sRUFBRSxVQUFVLENBQUMsTUFBTTtLQUMxQixDQUFDO0FBQ0osQ0FBQztBQUlELFNBQVMsWUFBWSxDQUFDLFFBQStCO0lBQ25ELFFBQVEsUUFBUSxFQUFFO1FBQ2hCLEtBQUssU0FBUyxDQUFDLEtBQUs7WUFDbEIsT0FBTyxTQUFTLENBQUMsTUFBTSxDQUFDO1FBQzFCLEtBQUssU0FBUyxDQUFDLE1BQU07WUFDbkIsT0FBTyxTQUFTLENBQUMsS0FBSyxDQUFDO1FBQ3pCLEtBQUssU0FBUyxDQUFDLElBQUk7WUFDakIsT0FBTyxTQUFTLENBQUMsS0FBSyxDQUFDO1FBQ3pCLEtBQUssU0FBUyxDQUFDLEtBQUs7WUFDbEIsT0FBTyxTQUFTLENBQUMsSUFBSSxDQUFDO1FBQ3hCLEtBQUssU0FBUyxDQUFDLEtBQUs7WUFDbEIsT0FBTyxTQUFTLENBQUMsS0FBSyxDQUFDO1FBQ3pCLEtBQUssU0FBUyxDQUFDLEtBQUs7WUFDbEIsT0FBTyxTQUFTLENBQUMsS0FBSyxDQUFDO0tBQzFCO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFhQb3NpdGlvbiwgWVBvc2l0aW9uIH0gZnJvbSAnLi9wb3NpdGlvbic7XG5pbXBvcnQgeyBMeVRoZW1lMiB9IGZyb20gJy4uL3RoZW1lL3RoZW1lMi5zZXJ2aWNlJztcbmltcG9ydCB7IFZpZXdwb3J0UnVsZXIgfSBmcm9tICdAYW5ndWxhci9jZGsvc2Nyb2xsaW5nJztcblxuXG5cbmV4cG9ydCBjbGFzcyBMeU92ZXJsYXlQb3NpdGlvbiB7XG4gIHByaXZhdGUgX3RyaWdnZXJSZWN0OiBDbGllbnRSZWN0O1xuICBwcml2YXRlIF9vdmVybGF5UmVjdDogQ2xpZW50UmVjdDtcbiAgcHJpdmF0ZSBfeEFuY2hvcj86IFhQb3NpdGlvbiB8IG51bWJlcjtcbiAgcHJpdmF0ZSBfeUFuY2hvcj86IFlQb3NpdGlvbiB8IG51bWJlcjtcbiAgcHJpdmF0ZSBfeEF4aXM6IFhQb3NpdGlvbiA9IFhQb3NpdGlvbi5hZnRlcjtcbiAgcHJpdmF0ZSBfeUF4aXM6IFlQb3NpdGlvbiA9IFlQb3NpdGlvbi5iZWxvdztcbiAgcHJpdmF0ZSBfZmxpcDogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF92aWV3cG9ydE9mZnNldCA9IDE2O1xuICBwcml2YXRlIF92aWV3cG9ydEhlaWdodDogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBfdmlld3BvcnRXaWR0aDogbnVtYmVyID0gMDtcbiAgLyoqIFRyYW5zZm9ybSBlbGVtZW50J3MgYm91bmRpbmcgYENsaWVudFJlY3RgIGJlZm9yZSByZW5kZXIuICovXG4gIHByaXZhdGUgX3RyYW5zZm9ybT86ICh0cmlnZ2VyUmVjdDogQ2xpZW50UmVjdCwgb3ZlcmxheVJlY3Q6IENsaWVudFJlY3QpID0+IHZvaWQ7XG5cbiAgcHJpdmF0ZSBfYW5jaG9yRGlyOiAnbGVmdCcgfCAncmlnaHQnO1xuICBwcml2YXRlIF9heGlzRGlyOiAnbGVmdCcgfCAncmlnaHQnO1xuXG4gIC8qKiB4QW5jaG9yIHBvc2l0aW9uICovXG4gIHByaXZhdGUgX3hhOiBudW1iZXI7XG4gIC8qKiBYQW5jaG9yIHBvc2l0aW9uICovXG4gIHByaXZhdGUgX3lhOiBudW1iZXI7XG5cbiAgZ2V0IHgoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3g7XG4gIH1cbiAgcHJpdmF0ZSBfeDogbnVtYmVyO1xuXG4gIGdldCB5KCkge1xuICAgIHJldHVybiB0aGlzLl95O1xuICB9XG4gIHByaXZhdGUgX3k6IG51bWJlcjtcblxuICBnZXQgeG8oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3hvO1xuICB9XG4gIHByaXZhdGUgX3hvOiBudW1iZXI7XG5cbiAgZ2V0IHlvKCkge1xuICAgIHJldHVybiB0aGlzLl95bztcbiAgfVxuICBwcml2YXRlIF95bzogbnVtYmVyO1xuXG4gIGdldCB3aWR0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5fd2lkdGg7XG4gIH1cbiAgcHJpdmF0ZSBfd2lkdGg6IG51bWJlcjtcblxuICBnZXQgaGVpZ2h0KCkge1xuICAgIHJldHVybiB0aGlzLl9oZWlnaHQ7XG4gIH1cbiAgcHJpdmF0ZSBfaGVpZ2h0OiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBfdGhlbWU6IEx5VGhlbWUyLFxuICAgIHByaXZhdGUgX3ZpZXdwb3J0UnVsZXI6IFZpZXdwb3J0UnVsZXIsXG4gICAgcHJpdmF0ZSBfdHJpZ2dlcjogRWxlbWVudCxcbiAgICBwcml2YXRlIF9vdmVybGF5OiBFbGVtZW50XG4gICkgeyB9XG5cbiAgYnVpbGQoKSB7XG4gICAgdGhpcy5fdXBkYXRlUmVjdHMoKTtcbiAgICB0aGlzLl9zZXREZWZhdWx0QW5jaG9yKCk7XG4gICAgdGhpcy5fdXBkYXRlRGlyKCk7XG4gICAgdGhpcy5fY2FsbFRyYW5zZm9ybUlmRXhpc3RzKCk7XG4gICAgdGhpcy5fY2FsY3VsYXRlUmVzcG9uc2l2ZSgpO1xuICAgIHRoaXMuX2NhbGN1bGF0ZU9yaWdpbigpO1xuICAgIHRoaXMuX3JvdW5kKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBwcml2YXRlIF91cGRhdGVSZWN0cygpIHtcbiAgICB0aGlzLl90cmlnZ2VyUmVjdCA9IGdldE11dGFibGVDbGllbnRSZWN0KHRoaXMuX3RyaWdnZXIpO1xuICAgIHRoaXMuX292ZXJsYXlSZWN0ID0gZ2V0TXV0YWJsZUNsaWVudFJlY3QodGhpcy5fb3ZlcmxheSk7XG4gICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSB0aGlzLl92aWV3cG9ydFJ1bGVyLmdldFZpZXdwb3J0U2l6ZSgpO1xuICAgIHRoaXMuX3ZpZXdwb3J0V2lkdGggPSB3aWR0aDtcbiAgICB0aGlzLl92aWV3cG9ydEhlaWdodCA9IGhlaWdodDtcbiAgfVxuXG4gIHByaXZhdGUgX3NldERlZmF1bHRBbmNob3IoKSB7XG4gICAgaWYgKCF0aGlzLl94QW5jaG9yKSB7XG4gICAgICB0aGlzLl94QW5jaG9yID0gdGhpcy5feEF4aXMgPT09IFhQb3NpdGlvbi5hZnRlciA/IFhQb3NpdGlvbi5iZWZvcmUgOiBYUG9zaXRpb24uYWZ0ZXI7XG4gICAgfVxuICAgIGlmICghdGhpcy5feUFuY2hvcikge1xuICAgICAgdGhpcy5feUFuY2hvciA9IHRoaXMuX3lBeGlzO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX2NhbGxUcmFuc2Zvcm1JZkV4aXN0cygpIHtcbiAgICBpZiAodGhpcy5fdHJhbnNmb3JtKSB7XG4gICAgICB0aGlzLl90cmFuc2Zvcm0odGhpcy5fdHJpZ2dlclJlY3QsIHRoaXMuX292ZXJsYXlSZWN0KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF91cGRhdGVEaXIoKSB7XG4gICAgLy8gSWYgaXQgaXMgbm90IG51bWJlclxuICAgIGlmICh0eXBlb2YgdGhpcy5feEFuY2hvciAhPT0gJ251bWJlcicpIHtcbiAgICAgIHRoaXMuX2FuY2hvckRpciA9IHRoaXMuX3RoZW1lLnZhcmlhYmxlcy5nZXREaXJlY3Rpb24odGhpcy5feEFuY2hvciBhcyBhbnkpIGFzICdsZWZ0JyB8ICdyaWdodCc7XG4gICAgfVxuICAgIHRoaXMuX2F4aXNEaXIgPSB0aGlzLl90aGVtZS52YXJpYWJsZXMuZ2V0RGlyZWN0aW9uKHRoaXMuX3hBeGlzIGFzIGFueSkgYXMgJ2xlZnQnIHwgJ3JpZ2h0JztcbiAgfVxuXG4gIHByaXZhdGUgX2NhbGN1bGF0ZVJlc3BvbnNpdmUoKSB7XG4gICAgdGhpcy5fY2FsY3VsYXRlKCk7XG4gICAgaWYgKHRoaXMuX2ZsaXAgJiYgdHlwZW9mIHRoaXMuX3hBbmNob3IgPT09ICdzdHJpbmcnICYmIHR5cGVvZiB0aGlzLl95QW5jaG9yID09PSAnc3RyaW5nJykge1xuICAgICAgaWYgKHRoaXMuX2lzT3ZlcmZsb3dYKCkgJiYgKHRoaXMuX292ZXJsYXlSZWN0LndpZHRoIDwgKHRoaXMuX3hhIC0gdGhpcy5fdmlld3BvcnRPZmZzZXQpKSkge1xuICAgICAgICB0aGlzLnNldFhBeGlzKGZsaXBQb3NpdGlvbih0aGlzLl94QXhpcykpXG4gICAgICAgICAgICAuc2V0WEFuY2hvcihmbGlwUG9zaXRpb24odGhpcy5feEFuY2hvcikpO1xuICAgICAgICB0aGlzLl91cGRhdGVEaXIoKTtcbiAgICAgICAgdGhpcy5fY2FsY3VsYXRlKCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5faXNPdmVyZmxvd1koKSAmJiAodGhpcy5fb3ZlcmxheVJlY3QuaGVpZ2h0IDwgKHRoaXMuX3lhIC0gdGhpcy5fdmlld3BvcnRPZmZzZXQpKSkge1xuICAgICAgICB0aGlzLnNldFlBeGlzKGZsaXBQb3NpdGlvbih0aGlzLl95QXhpcykpXG4gICAgICAgICAgICAuc2V0WUFuY2hvcihmbGlwUG9zaXRpb24odGhpcy5feUFuY2hvcikpO1xuICAgICAgICB0aGlzLl9jYWxjdWxhdGUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5faXNPdmVyZmxvd1goKSkge1xuICAgICAgaWYgKHRoaXMuX292ZXJsYXlSZWN0LndpZHRoID4gdGhpcy5fdmlld3BvcnRXaWR0aCAtICh0aGlzLl92aWV3cG9ydE9mZnNldCAqIDIpKSB7XG4gICAgICAgIHRoaXMuX3ggPSB0aGlzLl92aWV3cG9ydE9mZnNldDtcbiAgICAgICAgdGhpcy5fd2lkdGggPSB0aGlzLl92aWV3cG9ydFdpZHRoIC0gKHRoaXMuX3ZpZXdwb3J0T2Zmc2V0ICogMik7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuX2lzT3ZlcmZsb3dMZWZ0KCkpIHtcbiAgICAgICAgdGhpcy5feCA9IHRoaXMuX3ZpZXdwb3J0T2Zmc2V0O1xuICAgICAgfSBlbHNlIGlmICh0aGlzLl9pc092ZXJmbG93UmlnaHQoKSkge1xuICAgICAgICB0aGlzLl94ID0gdGhpcy5fdmlld3BvcnRXaWR0aCAtIHRoaXMuX292ZXJsYXlSZWN0LndpZHRoIC0gdGhpcy5fdmlld3BvcnRPZmZzZXQ7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0aGlzLl9pc092ZXJmbG93WSgpKSB7XG4gICAgICBpZiAodGhpcy5fb3ZlcmxheVJlY3QuaGVpZ2h0ID4gdGhpcy5fdmlld3BvcnRIZWlnaHQgLSAodGhpcy5fdmlld3BvcnRPZmZzZXQgKiAyKSkge1xuICAgICAgICB0aGlzLl95ID0gdGhpcy5fdmlld3BvcnRPZmZzZXQ7XG4gICAgICAgIHRoaXMuX2hlaWdodCA9IHRoaXMuX3ZpZXdwb3J0SGVpZ2h0IC0gKHRoaXMuX3ZpZXdwb3J0T2Zmc2V0ICogMik7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuX2lzT3ZlcmZsb3dUb3AoKSkge1xuICAgICAgICB0aGlzLl95ID0gdGhpcy5fdmlld3BvcnRPZmZzZXQ7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuX2lzT3ZlcmZsb3dCb3R0b20oKSkge1xuICAgICAgICB0aGlzLl95ID0gdGhpcy5fdmlld3BvcnRIZWlnaHQgLSB0aGlzLl9vdmVybGF5UmVjdC5oZWlnaHQgLSB0aGlzLl92aWV3cG9ydE9mZnNldDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIHRydWUgaWYgdGhlIG1lbnUgb3ZlcmZsb3dzIHZlcnRpY2FsbHlcbiAgICovXG4gIHByaXZhdGUgX2lzT3ZlcmZsb3dYKCkge1xuICAgIHJldHVybiB0aGlzLl9pc092ZXJmbG93TGVmdCgpIC8vIExlZnRcbiAgICB8fCB0aGlzLl9pc092ZXJmbG93UmlnaHQoKTsgLy8gUmlnaHRcbiAgfVxuICBwcml2YXRlIF9pc092ZXJmbG93TGVmdCgpIHtcbiAgICByZXR1cm4gdGhpcy54IDwgdGhpcy5fdmlld3BvcnRPZmZzZXQ7XG4gIH1cbiAgcHJpdmF0ZSBfaXNPdmVyZmxvd1JpZ2h0KCkge1xuICAgIHJldHVybiAodGhpcy54ICsgdGhpcy5fb3ZlcmxheVJlY3Qud2lkdGgpID4gKHRoaXMuX3ZpZXdwb3J0V2lkdGggLSB0aGlzLl92aWV3cG9ydE9mZnNldCk7XG4gIH1cblxuICAvKiogUmV0dXJuIHRydWUgdGhlIG1lbnUgb3ZlcmZsb3dzIGhvcml6b250YWxseSAqL1xuICBwcml2YXRlIF9pc092ZXJmbG93WSgpIHtcbiAgICByZXR1cm4gdGhpcy5faXNPdmVyZmxvd1RvcCgpIC8vIFRvcFxuICAgIHx8IHRoaXMuX2lzT3ZlcmZsb3dCb3R0b20oKTsgLy8gQm90dG9tXG4gIH1cbiAgcHJpdmF0ZSBfaXNPdmVyZmxvd1RvcCgpIHtcbiAgICByZXR1cm4gdGhpcy55IDwgdGhpcy5fdmlld3BvcnRPZmZzZXQ7XG4gIH1cbiAgcHJpdmF0ZSBfaXNPdmVyZmxvd0JvdHRvbSgpIHtcbiAgICByZXR1cm4gKHRoaXMueSArIHRoaXMuX292ZXJsYXlSZWN0LmhlaWdodCkgPiAodGhpcy5fdmlld3BvcnRIZWlnaHQgLSB0aGlzLl92aWV3cG9ydE9mZnNldCk7XG4gIH1cblxuICBwcml2YXRlIF9jYWxjdWxhdGUoKSB7XG4gICAgdGhpcy5fY2FsY3VsYXRlQW5jaG9yUG9zaXRpb24oKTtcbiAgICB0aGlzLl9jYWxjdWxhdGVBeGlzKCk7XG4gIH1cblxuICBwcml2YXRlIF9jYWxjdWxhdGVBbmNob3JQb3NpdGlvbigpIHtcbiAgICBpZiAodGhpcy5fYW5jaG9yRGlyID09PSAnbGVmdCcgfHwgdGhpcy5fYW5jaG9yRGlyID09PSAncmlnaHQnKSB7XG4gICAgICB0aGlzLl94YSA9IHRoaXMuX3RyaWdnZXJSZWN0W3RoaXMuX2FuY2hvckRpcl07XG4gICAgfVxuICAgIGlmICh0aGlzLl95QW5jaG9yID09PSBZUG9zaXRpb24uYWJvdmUpIHtcbiAgICAgIHRoaXMuX3lhID0gdGhpcy5fdHJpZ2dlclJlY3QudG9wO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl95YSA9IHRoaXMuX3RyaWdnZXJSZWN0LmJvdHRvbTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9jYWxjdWxhdGVBeGlzKCkge1xuICAgIGlmICh0aGlzLl9heGlzRGlyID09PSAnbGVmdCcpIHtcbiAgICAgIHRoaXMuX3ggPSB0aGlzLl94YSAtIHRoaXMuX292ZXJsYXlSZWN0LndpZHRoO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl94ID0gdGhpcy5feGE7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX3lBeGlzID09PSBZUG9zaXRpb24uYWJvdmUpIHtcbiAgICAgIHRoaXMuX3kgPSB0aGlzLl95YSAtIHRoaXMuX292ZXJsYXlSZWN0LmhlaWdodDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5feSA9IHRoaXMuX3lhO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBDYWxjdWxhdGUgb3JpZ2luIGZvciBvdmVybGF5ICovXG4gIHByaXZhdGUgX2NhbGN1bGF0ZU9yaWdpbigpIHtcbiAgICBjb25zdCB4QW5jaG9yQ2VudGVyID0gdGhpcy5feGE7XG4gICAgY29uc3QgeUFuY2hvckNlbnRlciA9IHRoaXMuX3lhO1xuICAgIGNvbnN0IHhPdmVybGF5Q2VudGVyID0gdGhpcy54ICsgKHRoaXMuX292ZXJsYXlSZWN0LndpZHRoIC8gMik7XG4gICAgY29uc3QgeU92ZXJsYXlDZW50ZXIgPSB0aGlzLnkgKyAodGhpcy5fb3ZlcmxheVJlY3QuaGVpZ2h0IC8gMik7XG4gICAgY29uc3QgeG8gPSAoeEFuY2hvckNlbnRlciAtIHhPdmVybGF5Q2VudGVyKSArIHRoaXMuX292ZXJsYXlSZWN0LndpZHRoIC8gMjtcbiAgICBjb25zdCB5byA9ICh5QW5jaG9yQ2VudGVyIC0geU92ZXJsYXlDZW50ZXIpICsgdGhpcy5fb3ZlcmxheVJlY3QuaGVpZ2h0IC8gMjtcbiAgICB0aGlzLl94byA9IHhvO1xuICAgIHRoaXMuX3lvID0geW87XG4gIH1cblxuICBwcml2YXRlIF9yb3VuZCgpIHtcbiAgICB0aGlzLl94ID0gTWF0aC5yb3VuZCh0aGlzLngpO1xuICAgIHRoaXMuX3kgPSBNYXRoLnJvdW5kKHRoaXMueSk7XG4gIH1cblxuICAvLyBzZXRUcmlnZ2VyKHZhbDogRWxlbWVudCkge1xuICAvLyAgIHRoaXMuX3RyaWdnZXIgPSB2YWw7XG4gIC8vICAgcmV0dXJuIHRoaXM7XG4gIC8vIH1cbiAgLy8gc2V0T3ZlcmxheSh2YWw6IEVsZW1lbnQpIHtcbiAgLy8gICB0aGlzLl9vdmVybGF5ID0gdmFsO1xuICAvLyAgIHJldHVybiB0aGlzO1xuICAvLyB9XG4gIHNldFhBbmNob3IodmFsOiBYUG9zaXRpb24gfCBudW1iZXIpIHtcbiAgICB0aGlzLl94QW5jaG9yID0gdmFsO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHNldFlBbmNob3IodmFsOiBZUG9zaXRpb24gfCBudW1iZXIpIHtcbiAgICB0aGlzLl95QW5jaG9yID0gdmFsO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHNldFhBeGlzKHZhbD86IFhQb3NpdGlvbiB8IG51bGwpIHtcbiAgICB0aGlzLl94QXhpcyA9IHZhbCA/PyBYUG9zaXRpb24uYWZ0ZXI7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgc2V0WUF4aXModmFsPzogWVBvc2l0aW9uIHwgbnVsbCkge1xuICAgIHRoaXMuX3lBeGlzID0gdmFsID8/IFlQb3NpdGlvbi5iZWxvdztcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHNldEZsaXAoZmxpcDogYm9vbGVhbiA9IHRydWUpIHtcbiAgICB0aGlzLl9mbGlwID0gZmxpcDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIC8qKlxuICAgKiBPZmZzZXQgZnJvbSB0aGUgZWRnZSBvZiB0aGUgdmlld3BvcnQgdG8gdGhlIGNlbnRlci5cbiAgICogSXQgaXMgdGhlIG1pbmltdW0gc3BhY2UgdGhhdCBtdXN0IGJlIGJldHdlZW4gdGhlIHdpbmRvdyBhbmQgdGhlIG92ZXJsYXkuXG4gICAqL1xuICBzZXRWaWV3cG9ydE9mZnNldCh2YWw6IG51bWJlcikge1xuICAgIHRoaXMuX3ZpZXdwb3J0T2Zmc2V0ID0gdmFsO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHNldFRyYW5zZm9ybSh0cmFuc2Zvcm06ICh0cmlnZ2VyUmVjdDogQ2xpZW50UmVjdCwgb3ZlcmxheVJlY3Q6IENsaWVudFJlY3QpID0+IHZvaWQpIHtcbiAgICB0aGlzLl90cmFuc2Zvcm0gPSB0cmFuc2Zvcm07XG4gIH1cbn1cblxuXG4vKiogR2V0cyBhIG11dGFibGUgdmVyc2lvbiBvZiBhbiBlbGVtZW50J3MgYm91bmRpbmcgYENsaWVudFJlY3RgLiAqL1xuZnVuY3Rpb24gZ2V0TXV0YWJsZUNsaWVudFJlY3QoZWxlbWVudDogRWxlbWVudCk6IENsaWVudFJlY3Qge1xuICBjb25zdCBjbGllbnRSZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAvLyBXZSBuZWVkIHRvIGNsb25lIHRoZSBgY2xpZW50UmVjdGAgaGVyZSwgYmVjYXVzZSBhbGwgdGhlIHZhbHVlcyBvbiBpdCBhcmUgcmVhZG9ubHlcbiAgLy8gYW5kIHdlIG5lZWQgdG8gYmUgYWJsZSB0byB1cGRhdGUgdGhlbS4gQWxzbyB3ZSBjYW4ndCB1c2UgYSBzcHJlYWQgaGVyZSwgYmVjYXVzZVxuICAvLyB0aGUgdmFsdWVzIG9uIGEgYENsaWVudFJlY3RgIGFyZW4ndCBvd24gcHJvcGVydGllcy4gU2VlOlxuICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRWxlbWVudC9nZXRCb3VuZGluZ0NsaWVudFJlY3QjTm90ZXNcbiAgcmV0dXJuIHtcbiAgICB0b3A6IGNsaWVudFJlY3QudG9wLFxuICAgIHJpZ2h0OiBjbGllbnRSZWN0LnJpZ2h0LFxuICAgIGJvdHRvbTogY2xpZW50UmVjdC5ib3R0b20sXG4gICAgbGVmdDogY2xpZW50UmVjdC5sZWZ0LFxuICAgIHdpZHRoOiBjbGllbnRSZWN0LndpZHRoLFxuICAgIGhlaWdodDogY2xpZW50UmVjdC5oZWlnaHRcbiAgfTtcbn1cblxuZnVuY3Rpb24gZmxpcFBvc2l0aW9uKHBvc2l0aW9uOiBYUG9zaXRpb24pOiBYUG9zaXRpb247XG5mdW5jdGlvbiBmbGlwUG9zaXRpb24ocG9zaXRpb246IFlQb3NpdGlvbik6IFlQb3NpdGlvbjtcbmZ1bmN0aW9uIGZsaXBQb3NpdGlvbihwb3NpdGlvbjogWFBvc2l0aW9uIHwgWVBvc2l0aW9uKTogWFBvc2l0aW9uIHwgWVBvc2l0aW9uIHtcbiAgc3dpdGNoIChwb3NpdGlvbikge1xuICAgIGNhc2UgWFBvc2l0aW9uLmFmdGVyOlxuICAgICAgcmV0dXJuIFhQb3NpdGlvbi5iZWZvcmU7XG4gICAgY2FzZSBYUG9zaXRpb24uYmVmb3JlOlxuICAgICAgcmV0dXJuIFhQb3NpdGlvbi5hZnRlcjtcbiAgICBjYXNlIFhQb3NpdGlvbi5sZWZ0OlxuICAgICAgcmV0dXJuIFhQb3NpdGlvbi5yaWdodDtcbiAgICBjYXNlIFhQb3NpdGlvbi5yaWdodDpcbiAgICAgIHJldHVybiBYUG9zaXRpb24ubGVmdDtcbiAgICBjYXNlIFlQb3NpdGlvbi5hYm92ZTpcbiAgICAgIHJldHVybiBZUG9zaXRpb24uYmVsb3c7XG4gICAgY2FzZSBZUG9zaXRpb24uYmVsb3c6XG4gICAgICByZXR1cm4gWVBvc2l0aW9uLmFib3ZlO1xuICB9XG59XG4iXX0=