{"version":3,"file":"alyle-ui-image-cropper.js","sources":["../../../lib/image-cropper/resize-canvas.ts","../../../lib/image-cropper/image-cropper.ts","../../../lib/image-cropper/image-cropper-area.ts","../../../lib/image-cropper/image-cropper.module.ts","../../../lib/image-cropper/alyle-ui-image-cropper.ts"],"sourcesContent":["/*\n * Hermite resize - fast image resize/resample using Hermite filter.\n * https://github.com/viliusle/Hermite-resize\n */\nexport function resizeCanvas(canvas: HTMLCanvasElement, width: number, height: number) {\n  const width_source = canvas.width;\n  const height_source = canvas.height;\n  width = Math.round(width);\n  height = Math.round(height);\n\n  const ratio_w = width_source / width;\n  const ratio_h = height_source / height;\n  const ratio_w_half = Math.ceil(ratio_w / 2);\n  const ratio_h_half = Math.ceil(ratio_h / 2);\n\n  const ctx = canvas.getContext('2d');\n  const img = ctx!.getImageData(0, 0, width_source, height_source);\n  const img2 = ctx!.createImageData(width, height);\n  const data = img.data;\n  const data2 = img2.data;\n\n  for (let j = 0; j < height; j++) {\n    for (let i = 0; i < width; i++) {\n      const x2 = (i + j * width) * 4;\n      let weight = 0;\n      let weights = 0;\n      let weights_alpha = 0;\n      let gx_r = 0;\n      let gx_g = 0;\n      let gx_b = 0;\n      let gx_a = 0;\n      const center_y = j * ratio_h;\n\n      const xx_start = Math.floor(i * ratio_w);\n      let xx_stop = Math.ceil((i + 1) * ratio_w);\n      const yy_start = Math.floor(j * ratio_h);\n      let yy_stop = Math.ceil((j + 1) * ratio_h);\n      xx_stop = Math.min(xx_stop, width_source);\n      yy_stop = Math.min(yy_stop, height_source);\n\n      for (let yy = yy_start; yy < yy_stop; yy++) {\n        const dy = Math.abs(center_y - yy) / ratio_h_half;\n        const center_x = i * ratio_w;\n        const w0 = dy * dy; // pre-calc part of w\n        for (let xx = xx_start; xx < xx_stop; xx++) {\n          const dx = Math.abs(center_x - xx) / ratio_w_half;\n          const w = Math.sqrt(w0 + dx * dx);\n          if (w >= 1) {\n            // pixel too far\n            continue;\n          }\n          // hermite filter\n          weight = 2 * w * w * w - 3 * w * w + 1;\n          const pos_x = 4 * (xx + yy * width_source);\n          // alpha\n          gx_a += weight * data[pos_x + 3];\n          weights_alpha += weight;\n          // colors\n          if (data[pos_x + 3] < 255) {\n            weight = weight * data[pos_x + 3] / 250;\n          }\n          gx_r += weight * data[pos_x];\n          gx_g += weight * data[pos_x + 1];\n          gx_b += weight * data[pos_x + 2];\n          weights += weight;\n        }\n      }\n      data2[x2] = gx_r / weights;\n      data2[x2 + 1] = gx_g / weights;\n      data2[x2 + 2] = gx_b / weights;\n      data2[x2 + 3] = gx_a / weights_alpha;\n    }\n  }\n\n  // clear and resize canvas\n  canvas.width = width;\n  canvas.height = height;\n\n  // draw\n  ctx!.putImageData(img2, 0, 0);\n  return ctx;\n}\n","import {\n  Component,\n  ElementRef,\n  Input,\n  Output,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  ViewChild,\n  EventEmitter,\n  Renderer2,\n  OnDestroy,\n  NgZone,\n  Inject,\n  OnInit\n} from '@angular/core';\nimport {\n  mergeDeep,\n  LY_COMMON_STYLES,\n  ThemeVariables,\n  st2c,\n  ThemeRef,\n  StyleCollection,\n  LyClasses,\n  StyleTemplate,\n  StyleRenderer } from '@alyle/ui';\nimport { Subject, Observable } from 'rxjs';\nimport { take, takeUntil } from 'rxjs/operators';\nimport { normalizePassiveListenerOptions } from '@angular/cdk/platform';\nimport { DOCUMENT } from '@angular/common';\nimport { resizeCanvas } from './resize-canvas';\nimport { ViewportRuler } from '@angular/cdk/scrolling';\n\nexport interface LyImageCropperTheme {\n  /** Styles for Image Cropper Component */\n  root?: StyleCollection<((classes: LyClasses<typeof STYLES>) => StyleTemplate)>\n    | ((classes: LyClasses<typeof STYLES>) => StyleTemplate);\n}\n\nexport interface LyImageCropperVariables {\n  cropper?: LyImageCropperTheme;\n}\n\nconst activeEventOptions = normalizePassiveListenerOptions({passive: false});\nconst STYLE_PRIORITY = -2;\n\nexport const STYLES = (theme: ThemeVariables & LyImageCropperVariables, ref: ThemeRef) => {\n  const cropper = ref.selectorsOf(STYLES);\n  const { after } = theme;\n  return {\n    $name: LyImageCropper.и,\n    $priority: STYLE_PRIORITY,\n    root: ( ) => (className: string) => `${className}{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:flex;overflow:hidden;position:relative;justify-content:center;align-items:center;}${st2c((\n          (theme.cropper\n            && theme.cropper.root\n            && (theme.cropper.root instanceof StyleCollection\n              ? theme.cropper.root.setTransformer(fn => fn(cropper))\n              : theme.cropper.root(cropper))\n          )), `${className}`)}`,\n    imgContainer: (className: string) => `${className}{cursor:move;position:absolute;top:0;left:0;display:flex;touch-action:none;}${className} > canvas{display:block;}`,\n    overlay: (className: string) => `${st2c((LY_COMMON_STYLES.fill), `${className}`)}`,\n    area: (className: string) => `${className}{pointer-events:none;box-shadow:0 0 0 20000px rgba(0, 0, 0, 0.4);margin:auto;}${st2c((LY_COMMON_STYLES.fill), `${className}`)}${st2c((LY_COMMON_STYLES.fill), `${className}:before,${className}:after`)}${className}:before,${className}:after{content:'';}${className}:before{width:0;height:0;margin:auto;border-radius:50%;background:#fff;border:solid 2px rgb(255, 255, 255);}${className}:after{border:solid 2px rgb(255, 255, 255);border-radius:inherit;}`,\n    resizer: (className: string) => `${className}{width:10px;height:10px;background:#fff;border-radius:3px;position:absolute;touch-action:none;bottom:0;${after}:0;pointer-events:all;cursor:${\n        after === 'right'\n          ? 'nwse-resize'\n          : 'nesw-resize'};}${st2c((LY_COMMON_STYLES.fill), `${className}:before`)}${className}:before{content:'';width:20px;height:20px;transform:translate(-25%, -25%);}`,\n    defaultContent: (className: string) => `${className}{display:flex;align-items:center;justify-content:center;}${st2c((LY_COMMON_STYLES.fill), `${className},${className} > input`)}${className} *:not(input){pointer-events:none;}${className} > input{background:transparent;opacity:0;width:100%;height:100%;}`\n  };\n};\n/** Image Cropper Config */\nexport class ImgCropperConfig {\n  /** Cropper area width */\n  width: number = 250;\n  /** Cropper area height */\n  height: number = 200;\n  minWidth?: number = 40;\n  minHeight?: number = 40;\n  /** If this is not defined, the new image will be automatically defined. */\n  type?: string;\n  /** Background color( default: null), if is null in png is transparent but not in jpg. */\n  fill?: string | null;\n  /**\n   * Set anti-aliased (default: true)\n   * @deprecated this is not necessary as the cropper will automatically resize the image\n   * to the best quality\n   */\n  antiAliased?: boolean = true;\n  autoCrop?: boolean;\n  output?: ImgOutput | ImgResolution = ImgResolution.Default;\n  /**\n   * Zoom out until the entire image fits into the cropping area.\n   * default: false\n   */\n  extraZoomOut?: boolean;\n  /**\n   * Emit event `error` if the file size in bytes for the limit.\n   * Note: It only works when the image is received from the `<input>` event.\n   */\n  maxFileSize?: number | null;\n  /**\n   * Whether the cropper area will be round.\n   * This implies that the cropper area will maintain its aspect ratio.\n   * default: false\n   */\n  round?: boolean;\n  /**\n   * Whether the cropper area is resizable.\n   * default: false\n   */\n  resizableArea?: boolean;\n  /**\n   * Keep the width and height of the growing area the same according\n   * to `ImgCropperConfig.width` and `ImgCropperConfig.height`\n   * default: false\n   */\n  keepAspectRatio?: boolean;\n  /**\n   * Whether the cropper area is responsive.\n   * By default, the width and height of the cropper area is fixed,\n   * so can use when the cropper area is larger than its container,\n   * otherwise this will bring problems when cropping.\n   */\n  responsiveArea?: boolean;\n}\n\n/**\n * The output image\n * With this option you can resize the output image.\n * If `width` or `height` are 0, this will be set automatically.\n * Both cannot be 0.\n */\nexport interface ImgOutput {\n  /**\n   * The cropped image will be resized to this `width`.\n   */\n  width: number;\n  /**\n   * Cropped image will be resized to this `height`.\n   */\n  height: number;\n}\n\n/** Image output */\nexport enum ImgResolution {\n  /**\n   * The output image will be equal to the initial size of the cropper area.\n   */\n  Default,\n  /** Just crop the image without resizing */\n  OriginalImage\n}\n\n/** Image output */\nexport enum ImgCropperError {\n  /** The loaded image exceeds the size limit set. */\n  Size,\n  /** The file loaded is not image. */\n  Type,\n  /** When the image has not been loaded. */\n  Other\n}\n\nexport interface ImgCropperEvent {\n  /** Cropped image data URL */\n  dataURL?: string;\n  name: string | null;\n  /** Filetype */\n  type?: string;\n  /** Cropped area width */\n  areaWidth: number;\n  /** Cropped area height */\n  areaHeight: number;\n  /** Cropped image width */\n  width: number;\n  /** Cropped image height */\n  height: number;\n  /** Original Image data URL */\n  originalDataURL?: string;\n  scale: number;\n  /** Current rotation in degrees */\n  rotation: number;\n  /** Size of the image in bytes */\n  size: number;\n  /** Scaled offset from the left edge of the image */\n  left: number;\n  /** Scaled offset from the top edge of the image */\n  top: number;\n  /**\n   * Scaled offset from the left edge of the image to center of area\n   * Can be used to set image position\n   */\n  xOrigin: number;\n  /**\n   * Scaled offset from the top edge of the image to center of area\n   * Can be used to set image position\n   */\n  yOrigin: number;\n  /** @deprecated Use `xOrigin & yOrigin` instead. */\n  position?: {\n    x: number\n    y: number\n  };\n}\n\nexport interface ImgCropperErrorEvent {\n  name?: string;\n  /** Size of the image in bytes */\n  size: number;\n  /** Filetype */\n  type: string;\n  /** Type of error */\n  error: ImgCropperError;\n  errorMsg?: string;\n}\n\ninterface ImgRect {\n  x: number;\n  y: number;\n  xc: number;\n  yc: number;\n  /** transform with */\n  wt: number;\n  ht: number;\n}\n\nexport interface ImgCropperLoaderConfig {\n  name?: string | null;\n  /** Filetype */\n  type?: string;\n  /** Cropped area width */\n  areaWidth?: number;\n  /** Cropped area height */\n  areaHeight?: number;\n  /** Cropped image width */\n  width?: number;\n  /** Cropped image height */\n  height?: number;\n  /** Original Image data URL */\n  originalDataURL: string;\n  scale?: number;\n  /** Current rotation in degrees */\n  rotation?: number;\n  /** Size of the image in bytes */\n  size?: number;\n  /** Offset from the left edge of the image to center of area */\n  xOrigin?: number;\n  /** Offset from the top edge of the image to center of area */\n  yOrigin?: number;\n}\n\n@Component({\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  preserveWhitespaces: false,\n  selector: 'ly-img-cropper, ly-image-cropper',\n  templateUrl: 'image-cropper.html',\n  providers: [\n    StyleRenderer\n  ]\n})\nexport class LyImageCropper implements OnInit, OnDestroy {\n  static readonly и = 'LyImageCropper';\n  /**\n   * styles\n   * @docs-private\n   */\n  readonly classes = this.sRenderer.renderSheet(STYLES, true);\n  private _currentLoadConfig?: ImgCropperLoaderConfig;\n  // _originalImgBase64?: string;\n  // private _fileName: string | null;\n\n  /** Original image */\n  private _img: HTMLImageElement;\n  private offset?: {\n    x: number\n    y: number\n    left: number\n    top: number\n  };\n  private _scale?: number;\n  private _scal3Fix?: number;\n  private _minScale?: number;\n  private _maxScale?: number;\n  /** Initial config */\n  private _configPrimary: ImgCropperConfig;\n  private _config: ImgCropperConfig;\n  private _imgRect: ImgRect = {} as any;\n  private _rotation: number = 0;\n  // private _sizeInBytes: number | null;\n  private _isSliding: boolean;\n  /** Keeps track of the last pointer event that was captured by the crop area. */\n  private _lastPointerEvent: MouseEvent | TouchEvent | null;\n  private _startPointerEvent: {\n    x: number\n    y: number\n  } | null;\n  _primaryAreaWidth: number;\n  _primaryAreaHeight: number;\n\n  _absoluteScale: number;\n\n  /**\n   * When is loaded image\n   * @internal\n   */\n  _isLoadedImg: boolean;\n\n  /** When is loaded image & ready for crop */\n  isLoaded: boolean;\n  /** When the cropper is ready to be interacted  */\n  isReady: boolean;\n  isCropped: boolean;\n\n  @ViewChild('_imgContainer', { static: true }) _imgContainer: ElementRef;\n  @ViewChild('_area', {\n    read: ElementRef\n  }) _areaRef: ElementRef;\n  @ViewChild('_imgCanvas', { static: true }) _imgCanvas: ElementRef<HTMLCanvasElement>;\n  @Input()\n  get config(): ImgCropperConfig {\n    return this._config;\n  }\n  set config(val: ImgCropperConfig) {\n    this._config = mergeDeep({}, new ImgCropperConfig(), val);\n    this._configPrimary = mergeDeep({}, this._config);\n    this._primaryAreaWidth = this.config.width;\n    this._primaryAreaHeight = this.config.height;\n    if (\n      this._config.round\n      && this.config.width !== this.config.height\n    ) {\n      throw new Error(`${LyImageCropper.и}: Both width and height must be equal when using \\`ImgCropperConfig.round = true\\``);\n    }\n    const maxFileSize = this._config.maxFileSize;\n    if (maxFileSize) {\n      this.maxFileSize = maxFileSize;\n    }\n  }\n  /** Set scale */\n  @Input()\n  get scale(): number | undefined {\n    return this._scale;\n  }\n  set scale(val: number | undefined) {\n    this.setScale(val);\n  }\n\n  /**\n   * Emit event `error` if the file size for the limit.\n   * Note: It only works when the image is received from the `<input>` event.\n   */\n  @Input() maxFileSize: number;\n\n  /** Get min scale */\n  get minScale(): number | undefined {\n    return this._minScale;\n  }\n\n  @Output() readonly scaleChange = new EventEmitter<number>();\n\n  /** Emits minimum supported image scale */\n  @Output('minScale') readonly minScaleChange = new EventEmitter<number>();\n\n  /** Emits maximum supported image scale */\n  @Output('maxScale') readonly maxScaleChange = new EventEmitter<number>();\n\n  /** @deprecated Emits when the image is loaded, instead use `ready` */\n  @Output() readonly loaded = new EventEmitter<ImgCropperEvent>();\n\n  /** Emits when the image is loaded */\n  @Output() readonly imageLoaded = new EventEmitter<ImgCropperEvent>();\n\n  /** Emits when the cropper is ready to be interacted */\n  @Output() readonly ready = new EventEmitter<ImgCropperEvent>();\n\n  /** On crop new image */\n  @Output() readonly cropped = new EventEmitter<ImgCropperEvent>();\n\n  /** Emits when the cropper is cleaned */\n  @Output() readonly cleaned = new EventEmitter<void>();\n\n  /** Emit an error when the loaded image is not valid */\n  // tslint:disable-next-line: no-output-native\n  @Output() readonly error = new EventEmitter<ImgCropperErrorEvent>();\n\n  private _currentInputElement?: HTMLInputElement;\n\n  /** Emits whenever the component is destroyed. */\n  private readonly _destroy = new Subject<void>();\n\n  /** Used to subscribe to global move and end events */\n  protected _document: Document;\n\n  constructor(\n    readonly sRenderer: StyleRenderer,\n    private _renderer: Renderer2,\n    readonly _elementRef: ElementRef<HTMLElement>,\n    private cd: ChangeDetectorRef,\n    private _ngZone: NgZone,\n    @Inject(DOCUMENT) _document: any,\n    viewPortRuler: ViewportRuler\n  ) {\n    this._document = _document;\n    viewPortRuler.change()\n    .pipe(takeUntil(this._destroy))\n    .subscribe(() =>\n      this._ngZone.run(() => this.updateCropperPosition())\n    );\n  }\n\n  ngOnInit() {\n    this._ngZone.runOutsideAngular(() => {\n      const element = this._imgContainer.nativeElement;\n      element.addEventListener('mousedown', this._pointerDown, activeEventOptions);\n      element.addEventListener('touchstart', this._pointerDown, activeEventOptions);\n    });\n  }\n\n  ngOnDestroy() {\n    this._destroy.next();\n    this._destroy.complete();\n    const element = this._imgContainer.nativeElement;\n    this._lastPointerEvent = null;\n    this._removeGlobalEvents();\n    element.removeEventListener('mousedown', this._pointerDown, activeEventOptions);\n    element.removeEventListener('touchstart', this._pointerDown, activeEventOptions);\n  }\n\n  /** Load image with canvas */\n  private _imgLoaded(imgElement: HTMLImageElement) {\n    if (imgElement) {\n      this._img = imgElement;\n      const canvas = this._imgCanvas.nativeElement;\n      canvas.width = imgElement.width;\n      canvas.height = imgElement.height;\n      const ctx = canvas.getContext('2d')!;\n      ctx.clearRect(0, 0, imgElement.width, imgElement.height);\n      ctx.drawImage(imgElement, 0, 0);\n\n      /** set min scale */\n      this._updateMinScale(canvas);\n      this._updateMaxScale();\n    }\n  }\n\n  private _setStylesForContImg(values: {\n    x?: number\n    y?: number\n  }) {\n    const newStyles = { } as any;\n    if (values.x != null && values.y != null) {\n      const rootRect = this._rootRect();\n      const x = rootRect.width / 2 - (values.x);\n      const y = rootRect.height / 2 - (values.y);\n\n      this._imgRect.x = (values.x);\n      this._imgRect.y = (values.y);\n      this._imgRect.xc = (x);\n      this._imgRect.yc = (y);\n\n    }\n    newStyles.transform = `translate3d(${(this._imgRect.x)}px,${(this._imgRect.y)}px, 0)`;\n    newStyles.transform += `scale(${this._scal3Fix})`;\n    newStyles.transformOrigin = `${this._imgRect.xc}px ${this._imgRect.yc}px 0`;\n    newStyles['-webkit-transform'] = newStyles.transform;\n    newStyles['-webkit-transform-origin'] = newStyles.transformOrigin;\n    for (const key in newStyles) {\n      if (newStyles.hasOwnProperty(key)) {\n        this._renderer.setStyle(this._imgContainer.nativeElement, key, newStyles[key]);\n      }\n    }\n  }\n  /**\n   * Update area and image position only if needed,\n   * this is used when window resize\n   */\n  updateCropperPosition() {\n    if (this.isLoaded) {\n      this.updatePosition();\n      this._updateAreaIfNeeded();\n    }\n  }\n\n  /** Load Image from input event */\n  selectInputEvent(img: Event) {\n    this._currentInputElement = img.target as HTMLInputElement;\n    const _img = img.target as HTMLInputElement;\n    if (_img.files && _img.files.length !== 1) {\n      return;\n    }\n    const fileSize = _img.files![0].size;\n    const fileName = _img.value.replace(/.*(\\/|\\\\)/, '');\n\n    if (this.maxFileSize && fileSize > this.maxFileSize) {\n      const cropEvent: ImgCropperErrorEvent = {\n        name: fileName,\n        type: _img.files![0].type,\n        size: fileSize,\n        error: ImgCropperError.Size\n      };\n      this.clean();\n      this.error.emit(cropEvent as ImgCropperErrorEvent);\n      return;\n    }\n\n    new Observable<ProgressEvent>(observer => {\n\n      const reader = new FileReader();\n\n      reader.onerror = err => observer.error(err);\n      reader.onabort = err => observer.error(err);\n      reader.onload = (ev) => setTimeout(() => {\n        observer.next(ev);\n        observer.complete();\n      });\n\n      reader.readAsDataURL(_img.files![0]);\n    })\n      .pipe(take(1), takeUntil(this._destroy))\n      .subscribe(\n        (loadEvent) => {\n          const originalDataURL = (loadEvent.target as FileReader).result as string;\n\n          this.loadImage({\n            name: fileName,\n            size: _img.files![0].size, // size in bytes\n            type: this.config.type || _img.files![0].type,\n            originalDataURL\n          });\n\n          this.cd.markForCheck();\n        },\n        () => {\n          const cropEvent: ImgCropperErrorEvent = {\n            name: fileName,\n            size: fileSize,\n            error: ImgCropperError.Other,\n            errorMsg: 'The File could not be loaded.',\n            type: _img.files![0].type\n          };\n          this.clean();\n          this.error.emit(cropEvent as ImgCropperErrorEvent);\n        }\n      );\n\n  }\n\n  /** Set the size of the image, the values can be 0 between 1, where 1 is the original size */\n  setScale(size?: number, noAutoCrop?: boolean) {\n    // fix min scale\n    const newSize = size! >= this.minScale! && size! <= 1 ? size : this.minScale;\n\n    // check\n    const changed = size != null && size !== this.scale && newSize !== this.scale;\n    this._scale = size;\n    if (!changed) {\n      return;\n    }\n    this._scal3Fix = newSize;\n    this._updateAbsoluteScale();\n    if (this.isLoaded) {\n      if (changed) {\n        const originPosition = {...this._imgRect};\n        this.offset = {\n          x: originPosition.x,\n          y: originPosition.y,\n          left: originPosition.xc,\n          top: originPosition.yc\n        };\n        this._setStylesForContImg({});\n        this._simulatePointerMove();\n      } else {\n        return;\n      }\n    } else if (this.minScale) {\n      this._setStylesForContImg({\n        ...this._getCenterPoints()\n      });\n    } else {\n      return;\n    }\n\n    this.scaleChange.emit(size);\n    if (!noAutoCrop) {\n      this._cropIfAutoCrop();\n    }\n\n  }\n\n  private _getCenterPoints() {\n    const root = this._elementRef.nativeElement as HTMLElement;\n    const img = this._imgCanvas.nativeElement;\n    const x = (root.offsetWidth - (img.width)) / 2;\n    const y = (root.offsetHeight - (img.height)) / 2;\n    return {\n      x,\n      y\n    };\n  }\n\n  /**\n   * Fit to screen\n   */\n  fitToScreen() {\n    const container = this._elementRef.nativeElement as HTMLElement;\n    const min = {\n      width: container.offsetWidth,\n      height: container.offsetHeight\n    };\n    const { width, height } = this._img;\n    const minScale = {\n      width: min.width / width,\n      height: min.height / height\n    };\n    const result = Math.max(minScale.width, minScale.height);\n    this.setScale(result);\n  }\n\n  fit() {\n    this.setScale(this.minScale);\n  }\n\n  private _pointerDown = (event: TouchEvent | MouseEvent) => {\n    // Don't do anything if the\n    // user is using anything other than the main mouse button.\n    if (this._isSliding || (!isTouchEvent(event) && event.button !== 0)) {\n      return;\n    }\n\n    this._ngZone.run(() => {\n      this._isSliding = true;\n      this.offset = {\n        x: this._imgRect.x,\n        y: this._imgRect.y,\n        left: this._imgRect.xc,\n        top: this._imgRect.yc\n      };\n      this._lastPointerEvent = event;\n      this._startPointerEvent = getGesturePointFromEvent(event);\n      event.preventDefault();\n      this._bindGlobalEvents(event);\n    });\n\n  }\n\n  /**\n   * Simulate pointerMove with clientX = 0 and clientY = 0,\n   * this is used by `setScale` and `rotate`\n   */\n  private _simulatePointerMove() {\n    this._isSliding = true;\n    this._startPointerEvent = {\n      x: 0,\n      y: 0\n    };\n    this._pointerMove({\n      clientX: 0,\n      clientY: 0,\n      type: 'n',\n      preventDefault: () => {}\n    } as MouseEvent);\n    this._isSliding = false;\n    this._startPointerEvent = null;\n  }\n\n  _markForCheck() {\n    this.cd.markForCheck();\n  }\n\n  /**\n   * Called when the user has moved their pointer after\n   * starting to drag.\n   */\n  private _pointerMove = (event: TouchEvent | MouseEvent) => {\n    if (this._isSliding) {\n      event.preventDefault();\n      this._lastPointerEvent = event;\n      let x: number | undefined, y: number | undefined;\n      const canvas = this._imgCanvas.nativeElement;\n      const scaleFix = this._scal3Fix;\n      const config = this.config;\n      const startP = this.offset;\n      const point = getGesturePointFromEvent(event);\n      const deltaX = point.x - this._startPointerEvent!.x;\n      const deltaY = point.y - this._startPointerEvent!.y;\n      if (!scaleFix || !startP) {\n        return;\n      }\n\n      const isMinScaleY = canvas.height * scaleFix < config.height && config.extraZoomOut;\n      const isMinScaleX = canvas.width * scaleFix < config.width && config.extraZoomOut;\n\n      const limitLeft = (config.width / 2 / scaleFix) >= startP.left - (deltaX / scaleFix);\n      const limitRight = (config.width / 2 / scaleFix) + (canvas.width) - (startP.left - (deltaX / scaleFix)) <= config.width / scaleFix;\n      const limitTop = ((config.height / 2 / scaleFix) >= (startP.top - (deltaY / scaleFix)));\n      const limitBottom = (\n        ((config.height / 2 / scaleFix) + (canvas.height) - (startP.top - (deltaY / scaleFix))) <= (config.height / scaleFix)\n      );\n\n      // Limit for left\n      if ((limitLeft && !isMinScaleX) || (!limitLeft && isMinScaleX)) {\n        x = startP.x + (startP.left) - (config.width / 2 / scaleFix);\n      }\n\n      // Limit for right\n      if ((limitRight && !isMinScaleX) || (!limitRight && isMinScaleX)) {\n        x = startP.x + (startP.left) + (config.width / 2 / scaleFix) - canvas.width;\n      }\n\n      // Limit for top\n      if ((limitTop && !isMinScaleY) || (!limitTop && isMinScaleY)) {\n        y = startP.y + (startP.top) - (config.height / 2 / scaleFix);\n      }\n\n      // Limit for bottom\n      if ((limitBottom && !isMinScaleY) || (!limitBottom && isMinScaleY)) {\n        y = startP.y + (startP.top) + (config.height / 2 / scaleFix) - canvas.height;\n      }\n\n      // When press shiftKey, deprecated\n      // if (event.srcEvent && event.srcEvent.shiftKey) {\n      //   if (Math.abs(event.deltaX) === Math.max(Math.abs(event.deltaX), Math.abs(event.deltaY))) {\n      //     y = this.offset.top;\n      //   } else {\n      //     x = this.offset.left;\n      //   }\n      // }\n\n      if (x === void 0) { x = (deltaX / scaleFix) + (startP.x); }\n      if (y === void 0) { y = (deltaY / scaleFix) + (startP.y); }\n      this._setStylesForContImg({\n        x, y\n      });\n    }\n  }\n\n  updatePosition(): void;\n  updatePosition(xOrigin: number, yOrigin: number): void;\n  updatePosition(xOrigin?: number, yOrigin?: number) {\n    const hostRect = this._rootRect();\n    const areaRect = this._areaCropperRect();\n    const areaWidth = areaRect.width > hostRect.width\n      ? hostRect.width\n      : areaRect.width;\n    const areaHeight = areaRect.height > hostRect.height\n      ? hostRect.height\n      : areaRect.height;\n    let x: number, y: number;\n    if (xOrigin == null && yOrigin == null) {\n      xOrigin = this._imgRect.xc;\n      yOrigin = this._imgRect.yc;\n    }\n    x = (areaRect.left - hostRect.left);\n    y = (areaRect.top - hostRect.top);\n    x -= (xOrigin! - (areaWidth / 2));\n    y -= (yOrigin! - (areaHeight / 2));\n\n    this._setStylesForContImg({\n      x, y\n    });\n  }\n\n  _slideEnd() {\n    this._cropIfAutoCrop();\n  }\n\n  private _cropIfAutoCrop() {\n    if (this.config.autoCrop) {\n      this.crop();\n    }\n  }\n\n  /** + */\n  zoomIn() {\n    const scale = this._scal3Fix! + .05;\n    if (scale > this.minScale! && scale <= this._maxScale!) {\n      this.setScale(scale);\n    } else {\n      this.setScale(this._maxScale!);\n    }\n  }\n\n  /** Clean the img cropper */\n  clean() {\n    // fix choosing the same image does not load\n    if (this._currentInputElement) {\n      this._currentInputElement.value = '';\n      this._currentInputElement = null!;\n    }\n    if (this.isLoaded) {\n      this._imgRect = { } as any;\n      this.offset = undefined;\n      this.scale = undefined as any;\n      this._scal3Fix = undefined;\n      this._rotation = 0;\n      this._minScale = undefined;\n      this._isLoadedImg = false;\n      this.isLoaded = false;\n      this.isCropped = false;\n      this._currentLoadConfig = undefined;\n      this.config = this._configPrimary;\n      const canvas = this._imgCanvas.nativeElement;\n      canvas.width = 0;\n      canvas.height = 0;\n      this.cleaned.emit(null!);\n      this.cd.markForCheck();\n    }\n  }\n\n  /** - */\n  zoomOut() {\n    const scale = this._scal3Fix! - .05;\n    if (scale > this.minScale! && scale <= this._maxScale!) {\n      this.setScale(scale);\n    } else {\n      this.fit();\n    }\n  }\n  center() {\n    const newStyles = {\n      ...this._getCenterPoints()\n    };\n    this._setStylesForContImg(newStyles);\n    this._cropIfAutoCrop();\n  }\n  /**\n   * load an image from a given configuration,\n   * or from the result of a cropped image\n   */\n  loadImage(config: ImgCropperLoaderConfig | string, fn?: () => void) {\n    this.clean();\n    const _config = this._currentLoadConfig = typeof config === 'string'\n      ? { originalDataURL: config }\n      : { ...config };\n    let src = _config.originalDataURL;\n    this._primaryAreaWidth = this._configPrimary.width;\n    this._primaryAreaHeight = this._configPrimary.height;\n    if (_config.areaWidth && _config.areaHeight) {\n      this.config.width = _config.areaWidth;\n      this.config.height = _config.areaHeight;\n    }\n    src = normalizeSVG(src);\n\n    const img = createHtmlImg(src);\n\n    const cropEvent = { ..._config } as ImgCropperEvent;\n\n    new Observable<void>(observer => {\n\n      img.onerror = err => observer.error(err);\n      img.onabort = err => observer.error(err);\n      img.onload = () => observer.next(null!);\n    })\n    .pipe(take(1), takeUntil(this._destroy))\n    .subscribe(\n      () => {\n        this._imgLoaded(img);\n        this._isLoadedImg = true;\n        this.imageLoaded.emit(cropEvent);\n        this.cd.markForCheck();\n        this._ngZone.runOutsideAngular(() => {\n          this._ngZone\n            .onStable\n            .asObservable()\n            .pipe(take(1), takeUntil(this._destroy))\n            .subscribe(\n              () => setTimeout(() => this._ngZone.run(() => this._positionImg(cropEvent, fn)))\n            );\n        });\n      },\n      () => {\n        const error: ImgCropperErrorEvent = {\n          name: _config.name!,\n          error: ImgCropperError.Type,\n          type: _config.type!,\n          size: _config.size!\n        };\n        this.error.emit(error);\n      }\n    );\n  }\n\n  private _updateAreaIfNeeded() {\n    if (!this._config.responsiveArea) {\n      return;\n    }\n\n    const rootRect = this._rootRect();\n    const areaRect = this._areaCropperRect();\n    const minWidth = this.config.minWidth || 1;\n    const minHeight = this.config.minHeight || 1;\n    if (!(\n      areaRect.width > rootRect.width\n      || areaRect.height > rootRect.height\n      || areaRect.width < this._primaryAreaWidth\n      || areaRect.height < this._primaryAreaHeight\n    )) {\n      return;\n    }\n    const areaWidthConf = Math.max(this.config.width, minWidth);\n    const areaWidthMax = Math.max(rootRect.width, minWidth);\n    const minHost = Math.min(\n      Math.max(rootRect.width, minWidth), Math.max(rootRect.height, minHeight)\n    );\n    const currentScale = this._scal3Fix!;\n    let newScale = 0;\n    const roundConf = this.config.round;\n\n    if (roundConf) {\n      this.config.width = this.config.height = minHost;\n    } else {\n      if (areaWidthConf === areaRect.width) {\n        if (areaWidthMax > this._primaryAreaWidth) {\n          this.config.width = this._primaryAreaWidth;\n          this.config.height = (this._primaryAreaWidth * areaRect.height) / areaRect.width;\n          newScale = (currentScale * this._primaryAreaWidth) / areaRect.width;\n        } else {\n          this.config.width = areaWidthMax;\n          this.config.height = (areaWidthMax * areaRect.height) / areaRect.width;\n          newScale = (currentScale * areaWidthMax) / areaRect.width;\n        }\n        this._updateMinScale();\n        this._updateMaxScale();\n        this.setScale(newScale, true);\n        this._markForCheck();\n      }\n    }\n  }\n\n  private _updateAbsoluteScale() {\n    const scale = this._scal3Fix! / (this.config.width / this._primaryAreaWidth);\n    this._absoluteScale = scale;\n  }\n\n  /**\n   * Load Image from URL\n   * @deprecated Use `loadImage` instead of `setImageUrl`\n   * @param src URL\n   * @param fn function that will be called before emit the event loaded\n   */\n  setImageUrl(src: string, fn?: () => void) {\n    this.loadImage(src, fn);\n  }\n\n  private _positionImg(cropEvent: ImgCropperEvent, fn?: () => void) {\n    const loadConfig = this._currentLoadConfig!;\n    this._updateMinScale(this._imgCanvas.nativeElement);\n    this._updateMaxScale();\n    this.isLoaded = false;\n    if (fn) {\n      fn();\n    } else {\n      if (loadConfig.scale) {\n        this.setScale(loadConfig.scale, true);\n      } else {\n        this.setScale(this.minScale, true);\n      }\n      this.rotate(loadConfig.rotation || 0);\n      this._updateAreaIfNeeded();\n      this._markForCheck();\n      this._ngZone.runOutsideAngular(() => {\n        this._ngZone\n          .onStable\n          .asObservable()\n          .pipe(take(1), takeUntil(this._destroy))\n          .subscribe(() => {\n            if (loadConfig.xOrigin != null && loadConfig.yOrigin != null) {\n              this.updatePosition(loadConfig.xOrigin, loadConfig.yOrigin);\n            }\n            this._updateAreaIfNeeded();\n            this.isLoaded = true;\n            this._cropIfAutoCrop();\n            this._ngZone.run(() => {\n              this._markForCheck();\n              this.ready.emit(cropEvent);\n              // tslint:disable-next-line: deprecation\n              this.loaded.emit(cropEvent);\n            });\n          });\n      });\n    }\n  }\n\n  rotate(degrees: number) {\n    let validDegrees = _normalizeDegrees(degrees);\n    // If negative convert to positive\n    if (validDegrees < 0) {\n      validDegrees += 360;\n    }\n    const newRotation = _normalizeDegrees((this._rotation || 0) + validDegrees);\n    if (newRotation === this._rotation) {\n      return;\n    }\n    const degreesRad = validDegrees * Math.PI / 180;\n    const canvas = this._imgCanvas.nativeElement;\n    const canvasClon = createCanvasImg(canvas);\n    const ctx = canvas.getContext('2d')!;\n    this._rotation = newRotation;\n\n    // clear\n    ctx.clearRect(0, 0, canvasClon.width, canvasClon.height);\n\n    // rotate canvas image\n    const transform = `rotate(${validDegrees}deg) scale(${1 / this._scal3Fix!})`;\n    const transformOrigin = `${this._imgRect.xc}px ${this._imgRect.yc}px 0`;\n    canvas.style.transform = transform;\n    // tslint:disable-next-line: deprecation\n    canvas.style.webkitTransform = transform;\n    canvas.style.transformOrigin = transformOrigin;\n    // tslint:disable-next-line: deprecation\n    canvas.style.webkitTransformOrigin = transformOrigin;\n\n    const { left, top } = canvas.getBoundingClientRect() as DOMRect;\n\n    // save rect\n    const canvasRect = canvas.getBoundingClientRect();\n\n    // remove rotate styles\n    canvas.removeAttribute('style');\n\n    // set w & h\n    const w = canvasRect.width;\n    const h = canvasRect.height;\n    ctx.canvas.width = w;\n    ctx.canvas.height = h;\n\n    // clear\n    ctx.clearRect(0, 0, w, h);\n\n    // translate and rotate\n    ctx.translate(w / 2, h / 2);\n    ctx.rotate(degreesRad);\n    ctx.drawImage(canvasClon, -canvasClon.width / 2, -canvasClon.height / 2);\n\n    // Update min scale\n    this._updateMinScale(canvas);\n    this._updateMaxScale();\n\n    // set the minimum scale, only if necessary\n    if (this.scale! < this.minScale!) {\n      this.setScale(0, true);\n    } //                ↑ no AutoCrop\n\n    const rootRect = this._rootRect();\n\n    this._setStylesForContImg({\n      x: (left - rootRect.left),\n      y: (top - rootRect.top)\n    });\n\n    // keep image inside the frame\n    const originPosition = {...this._imgRect};\n    this.offset = {\n      x: originPosition.x,\n      y: originPosition.y,\n      left: originPosition.xc,\n      top: originPosition.yc\n    };\n    this._setStylesForContImg({});\n    this._simulatePointerMove();\n\n    this._cropIfAutoCrop();\n  }\n\n  _updateMinScale(canvas?: HTMLCanvasElement) {\n    if (!canvas) {\n      canvas = this._imgCanvas.nativeElement;\n    }\n    const config = this.config;\n    const minScale = (config.extraZoomOut ? Math.min : Math.max)(\n      config.width / canvas.width,\n      config.height / canvas.height);\n    this._minScale = minScale;\n    this.minScaleChange.emit(minScale!);\n  }\n\n  private _updateMaxScale() {\n    const maxScale = (this.config.width / this._primaryAreaWidth);\n    this._maxScale = maxScale;\n    this.maxScaleChange.emit(maxScale);\n  }\n\n  /**\n   * Resize & crop image\n   */\n  crop(config?: ImgCropperConfig): ImgCropperEvent {\n    const newConfig = config\n    ? mergeDeep({ }, this.config || new ImgCropperConfig(), config) : this.config;\n    const cropEvent = this._imgCrop(newConfig);\n    this.cd.markForCheck();\n    return cropEvent;\n  }\n\n  /**\n   * @docs-private\n   */\n  private _imgCrop(myConfig: ImgCropperConfig) {\n    const canvasElement: HTMLCanvasElement = document.createElement('canvas');\n    const areaRect = this._areaCropperRect();\n    const canvasRect = this._canvasRect();\n    const scaleFix = this._scal3Fix!;\n    const left = (areaRect.left - canvasRect.left) / scaleFix;\n    const top = (areaRect.top - canvasRect.top) / scaleFix;\n    const { output } = myConfig;\n    const currentImageLoadConfig = this._currentLoadConfig!;\n    const area = {\n      width: myConfig.width,\n      height: myConfig.height\n    };\n    canvasElement.width = area.width / scaleFix;\n    canvasElement.height = area.height / scaleFix;\n    const ctx = canvasElement.getContext('2d')!;\n    if (myConfig.fill) {\n      ctx.fillStyle = myConfig.fill;\n      ctx.fillRect(0, 0, canvasElement.width, canvasElement.height);\n    }\n    ctx.drawImage(this._imgCanvas.nativeElement,\n      -(left), -(top),\n    );\n    const result = canvasElement;\n    if (myConfig.output === ImgResolution.Default) {\n      resizeCanvas(\n        result,\n        this._configPrimary.width,\n        this._configPrimary.height);\n    } else if (typeof output === 'object') {\n      if (output.width && output.height) {\n        resizeCanvas(result, output.width, output.height);\n      } else if (output.width) {\n        const newHeight = area.height * output.width / area.width;\n        resizeCanvas(result, output.width, newHeight);\n      } else if (output.height) {\n        const newWidth = area.width * output.height / area.height;\n        resizeCanvas(result, newWidth, output.height);\n      }\n    }\n    const type = currentImageLoadConfig.originalDataURL.startsWith('http')\n      ? currentImageLoadConfig.type || myConfig.type\n      : myConfig.type || currentImageLoadConfig.type!;\n    const dataURL = result.toDataURL(type);\n    const cropEvent: ImgCropperEvent = {\n      dataURL,\n      type,\n      name: currentImageLoadConfig.name!,\n      areaWidth: this._primaryAreaWidth,\n      areaHeight: this._primaryAreaHeight,\n      width: result.width,\n      height: result.height,\n      originalDataURL: currentImageLoadConfig.originalDataURL,\n      scale: this._absoluteScale!,\n      rotation: this._rotation,\n      left: (areaRect.left - canvasRect.left) / this._scal3Fix!,\n      top: (areaRect.top - canvasRect.top) / this._scal3Fix!,\n      size: currentImageLoadConfig.size!,\n      xOrigin: this._imgRect.xc,\n      yOrigin: this._imgRect.yc,\n      position: {\n        x: this._imgRect.xc,\n        y: this._imgRect.yc\n      }\n    };\n\n    this.isCropped = true;\n    this.cropped.emit(cropEvent);\n    return cropEvent;\n  }\n\n  _rootRect(): DOMRect {\n    return this._elementRef.nativeElement.getBoundingClientRect() as DOMRect;\n  }\n\n  _areaCropperRect(): DOMRect {\n    return this._areaRef.nativeElement.getBoundingClientRect() as DOMRect;\n  }\n\n  _canvasRect(): DOMRect {\n    return this._imgCanvas.nativeElement.getBoundingClientRect();\n  }\n\n\n  /** Called when the user has lifted their pointer. */\n  private _pointerUp = (event: TouchEvent | MouseEvent) => {\n    if (this._isSliding) {\n      event.preventDefault();\n      this._removeGlobalEvents();\n      this._isSliding = false;\n      this._startPointerEvent = null;\n      this._cropIfAutoCrop();\n    }\n  }\n\n  /** Called when the window has lost focus. */\n  private _windowBlur = () => {\n    // If the window is blurred while dragging we need to stop dragging because the\n    // browser won't dispatch the `mouseup` and `touchend` events anymore.\n    if (this._lastPointerEvent) {\n      this._pointerUp(this._lastPointerEvent);\n    }\n  }\n\n  private _bindGlobalEvents(triggerEvent: TouchEvent | MouseEvent) {\n    const element = this._document;\n    const isTouch = isTouchEvent(triggerEvent);\n    const moveEventName = isTouch ? 'touchmove' : 'mousemove';\n    const endEventName = isTouch ? 'touchend' : 'mouseup';\n    element.addEventListener(moveEventName, this._pointerMove, activeEventOptions);\n    element.addEventListener(endEventName, this._pointerUp, activeEventOptions);\n\n    if (isTouch) {\n      element.addEventListener('touchcancel', this._pointerUp, activeEventOptions);\n    }\n\n    const window = this._getWindow();\n\n    if (typeof window !== 'undefined' && window) {\n      window.addEventListener('blur', this._windowBlur);\n    }\n  }\n\n  /** Removes any global event listeners that we may have added. */\n  private _removeGlobalEvents() {\n    const element = this._document;\n    element.removeEventListener('mousemove', this._pointerMove, activeEventOptions);\n    element.removeEventListener('mouseup', this._pointerUp, activeEventOptions);\n    element.removeEventListener('touchmove', this._pointerMove, activeEventOptions);\n    element.removeEventListener('touchend', this._pointerUp, activeEventOptions);\n    element.removeEventListener('touchcancel', this._pointerUp, activeEventOptions);\n\n    const window = this._getWindow();\n\n    if (typeof window !== 'undefined' && window) {\n      window.removeEventListener('blur', this._windowBlur);\n    }\n  }\n\n  /** Use defaultView of injected document if available or fallback to global window reference */\n  private _getWindow(): Window {\n    return this._document.defaultView || window;\n  }\n\n}\n\n/**\n * Normalize degrees for cropper rotation\n * @docs-private\n */\nexport function _normalizeDegrees(n: number) {\n  const de = n % 360;\n  if (de % 90) {\n    throw new Error(`LyCropper: Invalid \\`${n}\\` degree, only accepted values: 0, 90, 180, 270 & 360.`);\n  }\n  return de;\n}\n\n/**\n * @docs-private\n */\nfunction createCanvasImg(img: HTMLCanvasElement | HTMLImageElement) {\n\n  // create a new canvas\n  const newCanvas = document.createElement('canvas');\n  const context = newCanvas.getContext('2d')!;\n\n  // set dimensions\n  newCanvas.width = img.width;\n  newCanvas.height = img.height;\n\n  // apply the old canvas to the new one\n  context.drawImage(img, 0, 0);\n\n  // return the new canvas\n  return newCanvas;\n}\n\n\nconst DATA_IMAGE_SVG_PREFIX = 'data:image/svg+xml;base64,';\n\nfunction normalizeSVG(dataURL: string) {\n  if (window.atob && isSvgImage(dataURL)) {\n    const len = dataURL.length / 5;\n    const text = window.atob(dataURL.replace(DATA_IMAGE_SVG_PREFIX, ''));\n    const span = document.createElement('span');\n    span.innerHTML = text;\n    const svg = span.querySelector('svg')!;\n    span.setAttribute('style', 'display:none');\n    document.body.appendChild(span);\n    const width = parseFloat(getComputedStyle(svg).width!) || 1;\n    const height = parseFloat(getComputedStyle(svg).height!) || 1;\n    const max = Math.max(width, height);\n\n    svg.setAttribute('width', `${len / (width / max)}px`);\n    svg.setAttribute('height', `${len / (height / max)}px`);\n    const result = DATA_IMAGE_SVG_PREFIX + window.btoa(span.innerHTML);\n    document.body.removeChild(span);\n    return result;\n  }\n  return dataURL;\n}\n\nfunction isSvgImage(dataUrl: string) {\n  return dataUrl.startsWith(DATA_IMAGE_SVG_PREFIX);\n}\n\nfunction createHtmlImg(src: string) {\n  const img = new Image();\n  img.crossOrigin = 'anonymous';\n  img.src = src;\n  return img;\n}\n\n\nfunction getGesturePointFromEvent(event: TouchEvent | MouseEvent) {\n\n  // `touches` will be empty for start/end events so we have to fall back to `changedTouches`.\n  const point = isTouchEvent(event)\n    ? (event.touches[0] || event.changedTouches[0])\n    : event;\n\n  return {\n    x: point.clientX,\n    y: point.clientY\n  };\n}\n\n/** Returns whether an event is a touch event. */\nfunction isTouchEvent(event: MouseEvent | TouchEvent): event is TouchEvent {\n  return event.type[0] === 't';\n}\n\nexport function round(n: number) {\n  return Math.round(n);\n}\n","import { Component, ElementRef, NgZone, Input, OnDestroy, ChangeDetectionStrategy, Inject, ViewChild } from '@angular/core';\nimport { normalizePassiveListenerOptions } from '@angular/cdk/platform';\nimport {\n  Style,\n  WithStyles,\n  StyleRenderer } from '@alyle/ui';\nimport { STYLES, LyImageCropper } from './image-cropper';\nimport { DOCUMENT } from '@angular/common';\n\nconst activeEventOptions = normalizePassiveListenerOptions({passive: false});\n\nconst pos = (100 * Math.sqrt(2) - 100) / 2 / Math.sqrt(2);\n\n/**\n * @dynamic\n */\n@Component({\n  selector: 'ly-cropper-area',\n  templateUrl: './image-cropper-area.html',\n  providers: [\n    StyleRenderer\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  exportAs: 'lyCropperArea'\n})\nexport class LyCropperArea implements WithStyles, OnDestroy {\n  readonly classes = this.sRenderer.renderSheet(STYLES, 'area');\n\n  private _isSliding: boolean;\n  /** Keeps track of the last pointer event that was captured by the crop area. */\n  private _lastPointerEvent: MouseEvent | TouchEvent | null;\n  private _startPointerEvent: {\n    x: number\n    y: number\n  } | null;\n  private _currentWidth: number;\n  private _currentHeight: number;\n  private _startAreaRect: DOMRect;\n  private _startImgRect: DOMRect;\n\n  /** Used to subscribe to global move and end events */\n  protected _document: Document;\n\n  @ViewChild('resizer') readonly _resizer?: ElementRef;\n\n  @Input()\n  set resizableArea(val: boolean) {\n    if (val !== this._resizableArea) {\n      this._resizableArea = val;\n      Promise.resolve(null).then(() => {\n        if (val) {\n          this._removeResizableArea();\n          this._addResizableArea();\n        } else {\n          this._removeResizableArea();\n        }\n      });\n    }\n  }\n  get resizableArea() {\n    return this._resizableArea;\n  }\n  private _resizableArea: boolean;\n  @Input() keepAspectRatio: boolean;\n  @Input()\n  @Style<boolean, LyCropperArea>(\n    (_value, _, { classes: __ }) => ({ after }) => (className: string) => `${className}{border-radius:50%;}${className} .${__.resizer}{${after}:${pos}%;bottom:${pos}%;transform:translate(4px, 4px);}`\n  ) round: boolean;\n\n  constructor(\n    readonly sRenderer: StyleRenderer,\n    readonly _elementRef: ElementRef,\n    private _ngZone: NgZone,\n    readonly _cropper: LyImageCropper,\n    @Inject(DOCUMENT) _document: any,\n  ) {\n    this._document = _document;\n  }\n\n  ngOnDestroy() {\n    this._removeResizableArea();\n  }\n\n  private _addResizableArea() {\n    this._ngZone.runOutsideAngular(() => {\n      const element = this._resizer!.nativeElement;\n      element.addEventListener('mousedown', this._pointerDown, activeEventOptions);\n      element.addEventListener('touchstart', this._pointerDown, activeEventOptions);\n    });\n  }\n\n  private _removeResizableArea() {\n    const element = this._resizer?.nativeElement;\n    if (element) {\n      this._lastPointerEvent = null;\n      this._removeGlobalEvents();\n      element.removeEventListener('mousedown', this._pointerDown, activeEventOptions);\n      element.removeEventListener('touchstart', this._pointerDown, activeEventOptions);\n    }\n  }\n\n  private _pointerDown = (event: MouseEvent | TouchEvent) => {\n    // Don't do anything if the\n    // user is using anything other than the main mouse button.\n    if (this._isSliding || (!isTouchEvent(event) && event.button !== 0)) {\n      return;\n    }\n\n    event.preventDefault();\n\n    this._ngZone.run(() => {\n      this._isSliding = true;\n      this._lastPointerEvent = event;\n      this._startPointerEvent = getGesturePointFromEvent(event);\n      this._startAreaRect = this._cropper._areaCropperRect();\n      this._startImgRect = this._cropper._canvasRect();\n      event.preventDefault();\n      this._bindGlobalEvents(event);\n    });\n\n  }\n\n  private _pointerMove = (event: MouseEvent | TouchEvent) => {\n    if (this._isSliding) {\n      event.preventDefault();\n      this._lastPointerEvent = event;\n      const element: HTMLDivElement = this._elementRef.nativeElement;\n      const { width, height, minWidth, minHeight } = this._cropper.config;\n      const point = getGesturePointFromEvent(event);\n      const deltaX = point.x - this._startPointerEvent!.x;\n      const deltaY = point.y - this._startPointerEvent!.y;\n      const startAreaRect = this._startAreaRect;\n      const startImgRect = this._startImgRect;\n      const round = this.round;\n      const keepAspectRatio = this._cropper.config.keepAspectRatio || event.shiftKey;\n      let newWidth = 0;\n      let newHeight = 0;\n      const rootRect = this._cropper._rootRect();\n\n      if (round) {\n        // The distance from the center of the cropper area to the pointer\n        const originX = ((width / 2 / Math.sqrt(2)) + deltaX);\n        const originY = ((height / 2 / Math.sqrt(2)) + deltaY);\n\n        // Leg\n        const side = Math.sqrt(originX ** 2 + originY ** 2);\n        newWidth = newHeight = side * 2;\n\n      } else if (keepAspectRatio) {\n        newWidth = width + deltaX * 2;\n        newHeight = height + deltaY * 2;\n        if (width !== height) {\n          if (width > height) {\n            newHeight = height / (width / newWidth);\n          } else if (height > width) {\n            newWidth = width / (height / newHeight);\n          }\n        } else {\n          newWidth = newHeight = Math.max(newWidth, newHeight);\n        }\n      } else {\n        newWidth = width + deltaX * 2;\n        newHeight = height + deltaY * 2;\n      }\n\n      // To min width\n      if (newWidth < minWidth!) {\n        newWidth = minWidth!;\n      }\n      // To min height\n      if (newHeight < minHeight!) {\n        newHeight = minHeight!;\n      }\n\n      // Do not overflow the cropper area\n      const centerX = startAreaRect.x + startAreaRect.width / 2;\n      const centerY = startAreaRect.y + startAreaRect.height / 2;\n      const topOverflow = startImgRect.y > centerY - (newHeight / 2);\n      const bottomOverflow = centerY + (newHeight / 2) > startImgRect.bottom;\n      const minHeightOnOverflow = Math.min((centerY - startImgRect.y) * 2, (startImgRect.bottom - centerY) * 2);\n      const leftOverflow = startImgRect.x > centerX - (newWidth / 2);\n      const rightOverflow = centerX + (newWidth / 2) > startImgRect.right;\n      const minWidthOnOverflow = Math.min((centerX - startImgRect.x) * 2, (startImgRect.right - centerX) * 2);\n      const minOnOverflow = Math.min(minWidthOnOverflow, minHeightOnOverflow);\n      if (round) {\n        if (topOverflow || bottomOverflow || leftOverflow || rightOverflow) {\n          newHeight = newWidth = minOnOverflow;\n        }\n      } else if (keepAspectRatio) {\n        const newNewWidth: number[] = [];\n        const newNewHeight: number[] = [];\n        if ((topOverflow || bottomOverflow) && Math.min()) {\n          newHeight = minHeightOnOverflow;\n          newNewHeight.push(newHeight);\n          newWidth = width / (height / minHeightOnOverflow);\n          newNewWidth.push(newWidth);\n        }\n        if ((leftOverflow || rightOverflow)) {\n          newWidth = minWidthOnOverflow;\n          newNewWidth.push(newWidth);\n          newHeight = height / (width / minWidthOnOverflow);\n          newNewHeight.push(newHeight);\n        }\n        if (newNewWidth.length === 2) {\n          newWidth = Math.min(...newNewWidth);\n        }\n        if (newNewHeight.length === 2) {\n          newHeight = Math.min(...newNewHeight);\n        }\n      } else {\n        if (topOverflow || bottomOverflow) {\n          newHeight = minHeightOnOverflow;\n        }\n        if (leftOverflow || rightOverflow) {\n          newWidth = minWidthOnOverflow;\n        }\n      }\n\n      // Do not overflow the container\n      if (round) {\n        const min = Math.min(rootRect.width, rootRect.height);\n        if (newWidth > min) {\n          newWidth = newHeight = min;\n        } else if (newHeight > min) {\n          newWidth = newHeight = min;\n        }\n      } else if (keepAspectRatio) {\n        if (newWidth > rootRect.width) {\n          newWidth = rootRect.width;\n          newHeight = height / (width / rootRect.width);\n        } else if (newHeight > rootRect.height) {\n          newWidth = width / (height / rootRect.height);\n          newHeight = rootRect.height;\n        }\n      } else {\n        if (newWidth > rootRect.width) {\n          newWidth = rootRect.width;\n        } else if (newHeight > rootRect.height) {\n          newHeight = rootRect.height;\n        }\n      }\n\n\n      // round values\n      newWidth = Math.round(newWidth);\n      newHeight = Math.round(newHeight);\n\n      element.style.width = `${newWidth}px`;\n      element.style.height = `${newHeight}px`;\n      this._currentWidth = newWidth;\n      this._currentHeight = newHeight;\n    }\n  }\n\n  /** Called when the user has lifted their pointer. */\n  private _pointerUp = (event: TouchEvent | MouseEvent) => {\n    if (this._isSliding) {\n      event.preventDefault();\n      this._removeGlobalEvents();\n      this._cropper._primaryAreaWidth = this._cropper.config.width = this._currentWidth;\n      this._cropper._primaryAreaHeight = this._cropper.config.height = this._currentHeight;\n      this._cropper.config = this._cropper.config;\n      this._cropper._updateMinScale();\n      this._isSliding = false;\n      this._startPointerEvent = null;\n    }\n  }\n\n  /** Called when the window has lost focus. */\n  private _windowBlur = () => {\n    // If the window is blurred while dragging we need to stop dragging because the\n    // browser won't dispatch the `mouseup` and `touchend` events anymore.\n    if (this._lastPointerEvent) {\n      this._pointerUp(this._lastPointerEvent);\n    }\n  }\n\n  private _bindGlobalEvents(triggerEvent: TouchEvent | MouseEvent) {\n    const element = this._document;\n    const isTouch = isTouchEvent(triggerEvent);\n    const moveEventName = isTouch ? 'touchmove' : 'mousemove';\n    const endEventName = isTouch ? 'touchend' : 'mouseup';\n    element.addEventListener(moveEventName, this._pointerMove, activeEventOptions);\n    element.addEventListener(endEventName, this._pointerUp, activeEventOptions);\n\n    if (isTouch) {\n      element.addEventListener('touchcancel', this._pointerUp, activeEventOptions);\n    }\n\n    const window = this._getWindow();\n\n    if (typeof window !== 'undefined' && window) {\n      window.addEventListener('blur', this._windowBlur);\n    }\n  }\n\n  /** Removes any global event listeners that we may have added. */\n  private _removeGlobalEvents() {\n    const element = this._document;\n    element.removeEventListener('mousemove', this._pointerMove, activeEventOptions);\n    element.removeEventListener('mouseup', this._pointerUp, activeEventOptions);\n    element.removeEventListener('touchmove', this._pointerMove, activeEventOptions);\n    element.removeEventListener('touchend', this._pointerUp, activeEventOptions);\n    element.removeEventListener('touchcancel', this._pointerUp, activeEventOptions);\n\n    const window = this._getWindow();\n\n    if (typeof window !== 'undefined' && window) {\n      window.removeEventListener('blur', this._windowBlur);\n    }\n  }\n\n  /** Use defaultView of injected document if available or fallback to global window reference */\n  private _getWindow(): Window {\n    return this._document.defaultView || window;\n  }\n}\n\nfunction getGesturePointFromEvent(event: TouchEvent | MouseEvent) {\n\n  // `touches` will be empty for start/end events so we have to fall back to `changedTouches`.\n  const point = isTouchEvent(event)\n    ? (event.touches[0] || event.changedTouches[0])\n    : event;\n\n  return {\n    x: point.clientX,\n    y: point.clientY\n  };\n}\n\n/** Returns whether an event is a touch event. */\nfunction isTouchEvent(event: MouseEvent | TouchEvent): event is TouchEvent {\n  return event.type[0] === 't';\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\n\nimport { LyImageCropper } from './image-cropper';\nimport { LyCropperArea } from './image-cropper-area';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [LyImageCropper],\n  declarations: [LyImageCropper, LyCropperArea]\n})\nexport class LyImageCropperModule { }\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n\nexport {LyCropperArea as ɵa} from './image-cropper-area';"],"names":["activeEventOptions","isTouchEvent","getGesturePointFromEvent"],"mappings":"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"}