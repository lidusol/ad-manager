import { __decorate, __metadata } from "tslib";
import { Directive, Input, ComponentFactoryResolver, ViewContainerRef, ComponentFactory, ComponentRef, ElementRef, EventEmitter, Output, OnInit } from '@angular/core';
import { Subject } from 'rxjs';
import { takeUntil, distinctUntilChanged } from 'rxjs/operators';
import { EmojiPickerComponent } from '../components/emoji-picker.component';
import { DIRECTIONS } from '../misc/picker-directions';
import { EmojiEvent } from '../misc/emoji-event';
import * as ɵngcc0 from '@angular/core';
var EmojiPickerApiDirective = /** @class */ (function () {
    function EmojiPickerApiDirective(_cfr, _vcr, _el) {
        var _this = this;
        this._cfr = _cfr;
        this._vcr = _vcr;
        this._el = _el;
        this._directionCode = DIRECTIONS.bottom;
        this._searchBar = false;
        this.emojiPickerIfEmitter = new EventEmitter();
        this.selectEmitter = new EventEmitter();
        this._emojiPickerOpenState = new Subject();
        this._destroyed = new Subject();
        this._emojiSubs = [];
        this.initPicker();
        this._emojiPickerOpenState
            .pipe(takeUntil(this._destroyed), distinctUntilChanged())
            .subscribe(function (value) {
            var _a, _b, _c, _d, _e, _f;
            if (value) {
                (_c = (_b = (_a = _this._emojiPickerRef) === null || _a === void 0 ? void 0 : _a.instance) === null || _b === void 0 ? void 0 : _b.show) === null || _c === void 0 ? void 0 : _c.call(_b);
            }
            else {
                (_f = (_e = (_d = _this._emojiPickerRef) === null || _d === void 0 ? void 0 : _d.instance) === null || _e === void 0 ? void 0 : _e.hide) === null || _f === void 0 ? void 0 : _f.call(_e);
            }
        });
    }
    Object.defineProperty(EmojiPickerApiDirective.prototype, "emojiPickerDirection", {
        set: function (direction) {
            if (DIRECTIONS[direction] === undefined) {
                console.error("Emoji-Picker: direction '" + direction + "' passed as input does not exist in DIRECTIONS table, defaulting to 'bottom'");
                this._directionCode = DIRECTIONS.bottom;
            }
            else {
                this._directionCode = DIRECTIONS[direction];
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(EmojiPickerApiDirective.prototype, "emojiPickerIf", {
        set: function (condition) {
            this._emojiPickerOpenState.next(condition);
        },
        enumerable: true,
        configurable: true
    });
    EmojiPickerApiDirective.prototype.initPicker = function () {
        var _this = this;
        this._emojiPickerFactory = this._emojiPickerFactory || this._cfr.resolveComponentFactory(EmojiPickerComponent);
        this._emojiPickerRef = this._emojiPickerRef || this._vcr.createComponent(this._emojiPickerFactory);
        this._emojiPickerRef.instance.setPosition(this._el, this._directionCode);
        this._emojiSubs.push(this._emojiPickerRef.instance.pickerCloseEmitter.subscribe(function (event) { return _this.emojiPickerIfEmitter.emit(false); }), this._emojiPickerRef.instance.selectionEmitter.subscribe(function (event) { return _this.selectEmitter.emit(EmojiEvent.fromArray(event)); }));
    };
    EmojiPickerApiDirective.prototype.closePicker = function () {
        if (!this._emojiPickerRef || !this._emojiPickerRef.destroy) {
            return;
        }
        this._emojiSubs.forEach(function (subscription) { return subscription.unsubscribe(); });
        this._emojiPickerRef.destroy();
        this._emojiSubs = [];
        delete this._emojiPickerRef;
    };
    EmojiPickerApiDirective.prototype.ngOnDestroy = function () {
        this._destroyed.next(true);
    };
    EmojiPickerApiDirective.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: ViewContainerRef },
        { type: ElementRef }
    ]; };
    __decorate([
        Input('emojiPickerDirection'),
        __metadata("design:type", String),
        __metadata("design:paramtypes", [String])
    ], EmojiPickerApiDirective.prototype, "emojiPickerDirection", null);
    __decorate([
        Input('emojiPickerIf'),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [Boolean])
    ], EmojiPickerApiDirective.prototype, "emojiPickerIf", null);
    __decorate([
        Output('emojiPickerIfChange'),
        __metadata("design:type", Object)
    ], EmojiPickerApiDirective.prototype, "emojiPickerIfEmitter", void 0);
    __decorate([
        Output('emojiPickerSelect'),
        __metadata("design:type", Object)
    ], EmojiPickerApiDirective.prototype, "selectEmitter", void 0);
    EmojiPickerApiDirective = __decorate([ __metadata("design:paramtypes", [ComponentFactoryResolver,
            ViewContainerRef,
            ElementRef])
    ], EmojiPickerApiDirective);
EmojiPickerApiDirective.ɵfac = function EmojiPickerApiDirective_Factory(t) { return new (t || EmojiPickerApiDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ComponentFactoryResolver), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ViewContainerRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
EmojiPickerApiDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: EmojiPickerApiDirective, selectors: [["", "emojiPickerIf", ""]], hostBindings: function EmojiPickerApiDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function EmojiPickerApiDirective_click_HostBindingHandler($event) { return $event.emojiPickerExempt = true; });
    } }, inputs: { emojiPickerDirection: "emojiPickerDirection", emojiPickerIf: "emojiPickerIf" }, outputs: { emojiPickerIfEmitter: "emojiPickerIfChange", selectEmitter: "emojiPickerSelect" } });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(EmojiPickerApiDirective, [{
        type: Directive,
        args: [{
                selector: '[emojiPickerIf]',
                host: {
                    '(click)': '$event.emojiPickerExempt = true' // marking off event listening on anchor
                }
            }]
    }], function () { return [{ type: ɵngcc0.ComponentFactoryResolver }, { type: ɵngcc0.ViewContainerRef }, { type: ɵngcc0.ElementRef }]; }, { emojiPickerIfEmitter: [{
            type: Output,
            args: ['emojiPickerIfChange']
        }], selectEmitter: [{
            type: Output,
            args: ['emojiPickerSelect']
        }], emojiPickerDirection: [{
            type: Input,
            args: ['emojiPickerDirection']
        }], emojiPickerIf: [{
            type: Input,
            args: ['emojiPickerIf']
        }] }); })();
    return EmojiPickerApiDirective;
}());
export { EmojiPickerApiDirective };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1vamktcGlja2VyLWFwaS5kaXJlY3RpdmUuanMiLCJzb3VyY2VzIjpbIm5nOi9uZ3gtZW1vamktcGlja2VyL2xpYi9kaXJlY3RpdmVzL2Vtb2ppLXBpY2tlci1hcGkuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULEtBQUssRUFDTCx3QkFBd0IsRUFDeEIsZ0JBQWdCLEVBQ2hCLGdCQUFnQixFQUNoQixZQUFZLEVBQ1osVUFBVSxFQUNWLFlBQVksRUFDWixNQUFNLEVBQ04sTUFBTSxFQUNQLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxPQUFPLEVBQWtCLE1BQU0sTUFBTSxDQUFDO0FBQy9DLE9BQU8sRUFBRSxTQUFTLEVBQUUsb0JBQW9CLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUdoRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUM1RSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDdkQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDOztBQVFqRDtBQUNvQixJQTJCbEIsaUNBQ1UsSUFBOEIsRUFDOUIsSUFBc0IsRUFDdEIsR0FBZTtBQUN4QixRQUpELGlCQW1CQztBQUNILFFBbkJZLFNBQUksR0FBSixJQUFJLENBQTBCO0FBQUMsUUFDL0IsU0FBSSxHQUFKLElBQUksQ0FBa0I7QUFBQyxRQUN2QixRQUFHLEdBQUgsR0FBRyxDQUFZO0FBQzNCLFFBL0JVLG1CQUFjLEdBQWUsVUFBVSxDQUFDLE1BQU0sQ0FBQztBQUN6RCxRQUFVLGVBQVUsR0FBWSxLQUFLLENBQUM7QUFDdEMsUUFjaUMseUJBQW9CLEdBQUcsSUFBSSxZQUFZLEVBQVcsQ0FBQztBQUNwRixRQUMrQixrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7QUFDbEUsUUFDVSwwQkFBcUIsR0FBRyxJQUFJLE9BQU8sRUFBVyxDQUFDO0FBQ3pE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M0VELElBMkVDO0FBQ0QsU0E1RWEsdUJBQXVCO0FBQ25DIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRGlyZWN0aXZlLFxuICBJbnB1dCxcbiAgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICBWaWV3Q29udGFpbmVyUmVmLFxuICBDb21wb25lbnRGYWN0b3J5LFxuICBDb21wb25lbnRSZWYsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgT3V0cHV0LFxuICBPbkluaXRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJqZWN0ICwgIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsLCBkaXN0aW5jdFVudGlsQ2hhbmdlZH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5cbmltcG9ydCB7IEVtb2ppUGlja2VyQ29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50cy9lbW9qaS1waWNrZXIuY29tcG9uZW50JztcbmltcG9ydCB7IERJUkVDVElPTlMgfSBmcm9tICcuLi9taXNjL3BpY2tlci1kaXJlY3Rpb25zJztcbmltcG9ydCB7IEVtb2ppRXZlbnQgfSBmcm9tICcuLi9taXNjL2Vtb2ppLWV2ZW50JztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2Vtb2ppUGlja2VySWZdJyxcbiAgaG9zdDoge1xuICAgICcoY2xpY2spJzogJyRldmVudC5lbW9qaVBpY2tlckV4ZW1wdCA9IHRydWUnIC8vIG1hcmtpbmcgb2ZmIGV2ZW50IGxpc3RlbmluZyBvbiBhbmNob3JcbiAgfVxuIH0pXG5leHBvcnQgY2xhc3MgRW1vamlQaWNrZXJBcGlEaXJlY3RpdmUge1xuICBwcml2YXRlIF9kaXJlY3Rpb25Db2RlOiBESVJFQ1RJT05TID0gRElSRUNUSU9OUy5ib3R0b207XG4gIHByaXZhdGUgX3NlYXJjaEJhcjogQm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgnZW1vamlQaWNrZXJEaXJlY3Rpb24nKSBzZXQgZW1vamlQaWNrZXJEaXJlY3Rpb24oZGlyZWN0aW9uOiBzdHJpbmcpIHtcbiAgICBpZiAoRElSRUNUSU9OU1tkaXJlY3Rpb25dID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEVtb2ppLVBpY2tlcjogZGlyZWN0aW9uICcke2RpcmVjdGlvbn0nIHBhc3NlZCBhcyBpbnB1dCBkb2VzIG5vdCBleGlzdCBpbiBESVJFQ1RJT05TIHRhYmxlLCBkZWZhdWx0aW5nIHRvICdib3R0b20nYCk7XG4gICAgICB0aGlzLl9kaXJlY3Rpb25Db2RlID0gRElSRUNUSU9OUy5ib3R0b207XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2RpcmVjdGlvbkNvZGUgPSBESVJFQ1RJT05TW2RpcmVjdGlvbl07XG4gICAgfVxuICB9XG5cblxuICBASW5wdXQoJ2Vtb2ppUGlja2VySWYnKSBzZXQgZW1vamlQaWNrZXJJZihjb25kaXRpb246IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9lbW9qaVBpY2tlck9wZW5TdGF0ZS5uZXh0KGNvbmRpdGlvbik7XG4gIH1cbiAgQE91dHB1dCgnZW1vamlQaWNrZXJJZkNoYW5nZScpIGVtb2ppUGlja2VySWZFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuICBcbiAgQE91dHB1dCgnZW1vamlQaWNrZXJTZWxlY3QnKSBzZWxlY3RFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIHByaXZhdGUgX2Vtb2ppUGlja2VyT3BlblN0YXRlID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcbiAgcHJpdmF0ZSBfZGVzdHJveWVkID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcblxuICBwcml2YXRlIF9lbW9qaVBpY2tlckZhY3Rvcnk6IENvbXBvbmVudEZhY3Rvcnk8RW1vamlQaWNrZXJDb21wb25lbnQ+O1xuICBwcml2YXRlIF9lbW9qaVBpY2tlclJlZjogQ29tcG9uZW50UmVmPEVtb2ppUGlja2VyQ29tcG9uZW50PjtcbiAgcHJpdmF0ZSBfZW1vamlTdWJzOiBTdWJzY3JpcHRpb25bXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgX2NmcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgIHByaXZhdGUgX3ZjcjogVmlld0NvbnRhaW5lclJlZixcbiAgICBwcml2YXRlIF9lbDogRWxlbWVudFJlZlxuICApIHtcbiAgICB0aGlzLmluaXRQaWNrZXIoKTtcblxuICAgIHRoaXMuX2Vtb2ppUGlja2VyT3BlblN0YXRlXG4gICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkKSxcbiAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSh2YWx1ZSA9PiB7XG4gICAgICAgXG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgIHRoaXMuX2Vtb2ppUGlja2VyUmVmPy5pbnN0YW5jZT8uc2hvdz8uKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5fZW1vamlQaWNrZXJSZWY/Lmluc3RhbmNlPy5oaWRlPy4oKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gIH1cblxuICBpbml0UGlja2VyKCkge1xuICAgIHRoaXMuX2Vtb2ppUGlja2VyRmFjdG9yeSA9IHRoaXMuX2Vtb2ppUGlja2VyRmFjdG9yeSB8fCB0aGlzLl9jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoRW1vamlQaWNrZXJDb21wb25lbnQpO1xuICAgIHRoaXMuX2Vtb2ppUGlja2VyUmVmID0gdGhpcy5fZW1vamlQaWNrZXJSZWYgfHwgdGhpcy5fdmNyLmNyZWF0ZUNvbXBvbmVudCh0aGlzLl9lbW9qaVBpY2tlckZhY3RvcnkpO1xuXG4gICAgdGhpcy5fZW1vamlQaWNrZXJSZWYuaW5zdGFuY2Uuc2V0UG9zaXRpb24odGhpcy5fZWwsIHRoaXMuX2RpcmVjdGlvbkNvZGUpO1xuICAgIHRoaXMuX2Vtb2ppU3Vicy5wdXNoKFxuICAgICAgdGhpcy5fZW1vamlQaWNrZXJSZWYuaW5zdGFuY2UucGlja2VyQ2xvc2VFbWl0dGVyLnN1YnNjcmliZShldmVudCA9PiB0aGlzLmVtb2ppUGlja2VySWZFbWl0dGVyLmVtaXQoZmFsc2UpKSxcbiAgICAgIHRoaXMuX2Vtb2ppUGlja2VyUmVmLmluc3RhbmNlLnNlbGVjdGlvbkVtaXR0ZXIuc3Vic2NyaWJlKGV2ZW50ID0+IHRoaXMuc2VsZWN0RW1pdHRlci5lbWl0KEVtb2ppRXZlbnQuZnJvbUFycmF5KGV2ZW50KSkpXG4gICAgKTtcbiAgfVxuXG4gIGNsb3NlUGlja2VyKCkge1xuICAgIGlmICghdGhpcy5fZW1vamlQaWNrZXJSZWYgfHwgIXRoaXMuX2Vtb2ppUGlja2VyUmVmLmRlc3Ryb3kpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9lbW9qaVN1YnMuZm9yRWFjaCgoc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb24pID0+IHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpKTtcbiAgICB0aGlzLl9lbW9qaVBpY2tlclJlZi5kZXN0cm95KCk7XG4gICAgXG4gICAgdGhpcy5fZW1vamlTdWJzID0gW107XG4gICAgZGVsZXRlIHRoaXMuX2Vtb2ppUGlja2VyUmVmO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5fZGVzdHJveWVkLm5leHQodHJ1ZSk7XG4gIH1cbn1cbiJdfQ==