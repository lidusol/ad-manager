import { Directive, Input, Output, HostListener, Inject, EventEmitter, ElementRef, ChangeDetectorRef } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { Meta } from '@angular/platform-browser';
import { Platform } from '@angular/cdk/platform';
import { Clipboard } from '@angular/cdk/clipboard';
import { EMPTY, Observable, Subject } from 'rxjs';
import { takeUntil, tap } from 'rxjs/operators';
import { ShareService } from './share.service';
import { SharerMethod } from './share.models';
import { getValidUrl } from './utils';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/platform-browser';
import * as ɵngcc2 from '@angular/cdk/platform';
import * as ɵngcc3 from '@angular/cdk/clipboard';
export class ShareDirective {
    constructor(_el, _meta, _platform, _clipboard, _share, _cd, _document) {
        this._meta = _meta;
        this._platform = _platform;
        this._clipboard = _clipboard;
        this._share = _share;
        this._cd = _cd;
        this._document = _document;
        /** Stream that emits when button is destroyed */
        this._destroyed = new Subject();
        /** Stream that emit when share button need to be updated */
        this._updater = new Subject();
        /** Set meta tags from document head, useful when SEO is supported */
        this.autoSetMeta = this._share.config.autoSetMeta;
        /** Sharing link */
        this.url = this._share.config.url;
        /** Sets the title parameter */
        this.title = this._share.config.title;
        /** Sets the description parameter */
        this.description = this._share.config.description;
        /** Sets the image parameter for sharing on Pinterest */
        this.image = this._share.config.image;
        /** Sets the tags parameter for sharing on Twitter and Tumblr */
        this.tags = this._share.config.tags;
        /** Stream that emits when share dialog is opened */
        this.opened = new EventEmitter();
        /** Stream that emits when share dialog is closed */
        this.closed = new EventEmitter();
        this._el = _el.nativeElement;
    }
    /**
     * Share the link
     */
    share() {
        // Avoid SSR error
        if (this._platform.isBrowser && this.shareButton) {
            // Prepare sharer url params
            const params = this.autoSetMeta ? this.getParamsFromMetaTags() : this.getParamsFromInputs();
            // Prepare share button click
            const click = this.shareButton.share ? this.open(params) : this.shareButton.func({
                params,
                data: this.shareButton.data,
                clipboard: this._clipboard,
                updater: this._updater
            });
            click.pipe(takeUntil(this._destroyed)).subscribe();
        }
        else {
            console.warn(`${this.text} button is not compatible on this Platform`);
        }
    }
    ngOnInit() {
        // This stream is mainly used to update the copy button text and icon when it is being clicked
        this._updater.pipe(tap((data) => {
            this.icon = data.icon;
            this.text = data.text;
            this._el.style.pointerEvents = data.disabled ? 'none' : 'auto';
            this._cd.markForCheck();
        }), takeUntil(this._destroyed)).subscribe();
    }
    ngOnChanges(changes) {
        // Avoid SSR error
        if (this._platform.isBrowser) {
            // Create share button
            if (this._shareButtonChanged(changes.shareButtonName)) {
                this._createShareButton();
            }
            // Prepare share url
            if (this._urlChanged(changes.url)) {
                this.url = getValidUrl(this.autoSetMeta
                    ? this.url || this._getMetaTagContent('og:url')
                    : this.url, this._document.defaultView.location.href);
            }
        }
    }
    ngOnDestroy() {
        this._destroyed.next();
        this._destroyed.complete();
    }
    _createShareButton() {
        const button = this._share.config.prop[this.shareButtonName];
        if (button) {
            // Set share button properties
            this.shareButton = button;
            // Remove previous button class
            this._el.classList.remove(`sb-${this._buttonClass}`);
            // Add new button class
            this._el.classList.add(`sb-${this.shareButtonName}`);
            // Set button css color variable
            this._el.style.setProperty('--button-color', this.shareButton.color);
            // Keep a copy of the class for future replacement
            this._buttonClass = this.shareButtonName;
            this.color = this.shareButton.color;
            this.text = this.shareButton.text;
            this.icon = this.shareButton.icon;
            // Set aria-label attribute
            this._el.setAttribute('aria-label', button.ariaLabel);
        }
        else {
            console.error(`[ShareButtons]: The share button '${this.shareButtonName}' does not exist!`);
        }
    }
    /**
     * Get meta tag content
     */
    _getMetaTagContent(key) {
        const metaUsingProperty = this._meta.getTag(`property="${key}"`);
        if (metaUsingProperty) {
            return metaUsingProperty.getAttribute('content');
        }
        const metaUsingName = this._meta.getTag(`name="${key}"`);
        if (metaUsingName) {
            return metaUsingName.getAttribute('content');
        }
    }
    _shareButtonChanged(change) {
        return change && (change.firstChange || change.previousValue !== change.currentValue);
    }
    _urlChanged(change) {
        return !this.url || (change && change.previousValue !== change.currentValue);
    }
    /**
     * Get share params from meta tags first and fallback to user inputs
     */
    getParamsFromMetaTags() {
        return {
            url: this.url,
            title: this.title || this._getMetaTagContent('og:title'),
            description: this.description || this._getMetaTagContent('og:description'),
            image: this.image || this._getMetaTagContent('og:image'),
            via: this._share.config.twitterAccount,
            tags: this.tags
        };
    }
    /**
     * Get share params from user inputs
     */
    getParamsFromInputs() {
        return {
            url: this.url,
            title: this.title,
            description: this.description,
            image: this.image,
            tags: this.tags,
            via: this._share.config.twitterAccount,
        };
    }
    open(params) {
        // Set sharer link based on user's device
        let sharerLink;
        if (this._platform.IOS && this.shareButton.share.ios) {
            sharerLink = this.shareButton.share.ios;
        }
        else if (this._platform.ANDROID && this.shareButton.share.android) {
            sharerLink = this.shareButton.share.android;
        }
        else {
            sharerLink = this.shareButton.share.desktop;
        }
        if (sharerLink) {
            // Set sharer link params
            this._finalUrl = sharerLink + this._serializeParams(params);
            // Log the sharer link in debug mode
            if (this._share.config.debug) {
                console.log('[DEBUG SHARE BUTTON]: ', this._finalUrl);
            }
            // Open the share window
            // There are two methods available for opening the share window:
            // 1. Using a real anchor
            // 2. Using window.open
            const sharerMethod = this.shareButton.method || this._share.config.sharerMethod;
            const sharerTarget = this.shareButton.target || this._share.config.sharerTarget;
            switch (sharerMethod) {
                case SharerMethod.Anchor:
                    const linkElement = this._document.createElement('a');
                    // Make it open in a new tab/window (depends on user's browser configuration)
                    linkElement.setAttribute('target', sharerTarget);
                    // Prevent security vulnerability https://medium.com/@jitbit/target-blank-the-most-underestimated-vulnerability-ever-96e328301f4c
                    linkElement.setAttribute('rel', 'noopener noreferrer');
                    linkElement.href = this._finalUrl;
                    linkElement.click();
                    linkElement.remove();
                    break;
                case SharerMethod.Window:
                    // Open link using Window object
                    const openWindow = this._share.config.windowObj[this._share.config.windowFuncName];
                    const popUpWindow = openWindow(this._finalUrl, sharerTarget, this._share.windowSize);
                    // Prevent security vulnerability https://medium.com/@jitbit/target-blank-the-most-underestimated-vulnerability-ever-96e328301f4c
                    this._share.config.windowObj.opener = null;
                    // Resolve when share dialog is closed
                    if (popUpWindow) {
                        return new Observable((sub) => {
                            const pollTimer = this._document.defaultView.setInterval(() => {
                                if (popUpWindow.closed) {
                                    this._document.defaultView.clearInterval(pollTimer);
                                    // Emit when share windows is closed
                                    this.closed.emit(this.shareButtonName);
                                    sub.next();
                                    sub.complete();
                                }
                            }, 200);
                        });
                    }
                    break;
            }
            // Emit when share window is opened
            this.opened.emit(this.shareButtonName);
        }
        return EMPTY;
    }
    _serializeParams(params) {
        return Object.entries(this.shareButton.params)
            .map(([key, value]) => {
            // Check if share button param has a map function
            const paramFunc = this.shareButton.paramsFunc ? this.shareButton.paramsFunc[key] : null;
            if (params[key] || paramFunc) {
                const paramValue = paramFunc ? paramFunc(params) : params[key];
                return `${value}=${encodeURIComponent(paramValue)}`;
            }
            return '';
        })
            .filter(urlParam => urlParam !== '')
            .join('&');
    }
}
ShareDirective.ɵfac = function ShareDirective_Factory(t) { return new (t || ShareDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Meta), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.Platform), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.Clipboard), ɵngcc0.ɵɵdirectiveInject(ShareService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(DOCUMENT)); };
ShareDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: ShareDirective, selectors: [["", "shareButton", ""]], hostBindings: function ShareDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("click", function ShareDirective_click_HostBindingHandler() { return ctx.share(); });
    } }, inputs: { autoSetMeta: "autoSetMeta", url: "url", title: "title", description: "description", image: "image", tags: "tags", shareButtonName: ["shareButton", "shareButtonName"] }, outputs: { opened: "opened", closed: "closed" }, exportAs: ["shareButton"], features: [ɵngcc0.ɵɵNgOnChangesFeature] });
ShareDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Meta },
    { type: Platform },
    { type: Clipboard },
    { type: ShareService },
    { type: ChangeDetectorRef },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
ShareDirective.propDecorators = {
    shareButtonName: [{ type: Input, args: ['shareButton',] }],
    autoSetMeta: [{ type: Input }],
    url: [{ type: Input }],
    title: [{ type: Input }],
    description: [{ type: Input }],
    image: [{ type: Input }],
    tags: [{ type: Input }],
    opened: [{ type: Output }],
    closed: [{ type: Output }],
    share: [{ type: HostListener, args: ['click',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ShareDirective, [{
        type: Directive,
        args: [{
                selector: '[shareButton]',
                exportAs: 'shareButton'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc1.Meta }, { type: ɵngcc2.Platform }, { type: ɵngcc3.Clipboard }, { type: ShareService }, { type: ɵngcc0.ChangeDetectorRef }, { type: undefined, decorators: [{
                type: Inject,
                args: [DOCUMENT]
            }] }]; }, { autoSetMeta: [{
            type: Input
        }], url: [{
            type: Input
        }], title: [{
            type: Input
        }], description: [{
            type: Input
        }], image: [{
            type: Input
        }], tags: [{
            type: Input
        }], opened: [{
            type: Output
        }], closed: [{
            type: Output
        }], share: [{
            type: HostListener,
            args: ['click']
        }], shareButtonName: [{
            type: Input,
            args: ['shareButton']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcmUtYnV0dG9uLmRpcmVjdGl2ZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vcHJvamVjdHMvbmd4LXNoYXJlYnV0dG9ucy9zcmMvbGliL3NoYXJlLWJ1dHRvbi5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixNQUFNLEVBTU4sWUFBWSxFQUNaLFVBQVUsRUFDVixpQkFBaUIsRUFDbEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNqRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDakQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ25ELE9BQU8sRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUM5RCxPQUFPLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRWhELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQXFFLFlBQVksRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2pILE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxTQUFTLENBQUM7Ozs7O0FBTXRDLE1BQU0sT0FBTyxjQUFjO0FBQUcsSUF3RDVCLFlBQVksR0FBZSxFQUNQLEtBQVcsRUFDWCxTQUFtQixFQUNuQixVQUFxQixFQUNyQixNQUFvQixFQUNwQixHQUFzQixFQUNKLFNBQWM7QUFDdEQsUUFOc0IsVUFBSyxHQUFMLEtBQUssQ0FBTTtBQUFDLFFBQ1osY0FBUyxHQUFULFNBQVMsQ0FBVTtBQUFDLFFBQ3BCLGVBQVUsR0FBVixVQUFVLENBQVc7QUFBQyxRQUN0QixX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LENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZFLGdCQUFRLE9BQU8sR0FBSSxLQUFNLElBQUssa0JBQWtCLENBQUMsVUFBVSxDQUFFLEVBQUUsQ0FBQztBQUNoRSxhQUFPO0FBQ1AsWUFBTSxPQUFPLEVBQUUsQ0FBQztBQUNoQixRQUFJLENBQUMsQ0FBQztBQUNOLGFBQUssTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsUUFBUSxLQUFLLEVBQUUsQ0FBQztBQUN4QyxhQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNmLElBQUUsQ0FBQztBQUNIOzBDQTNTQyxTQUFTLFNBQUMsa0JBQ1QsUUFBUSxFQUFFLGVBQWUsa0JBQ3pCLFFBQVEsRUFBRSxhQUFhLGNBQ3hCOzs7bVRBQ0k7QUFBQztBQUF3QyxZQWxCNUMsVUFBVTtBQUNWLFlBR08sSUFBSTtBQUFJLFlBQ1IsUUFBUTtBQUFJLFlBQ1osU0FBUztBQUFJLFlBSWIsWUFBWTtBQUFJLFlBVHZCLGlCQUFpQjtBQUNoQiw0Q0E4RVksTUFBTSxTQUFDLFFBQVE7QUFBUTtBQUFHO0FBQ3hCLDhCQWpDZCxLQUFLLFNBQUMsYUFBYTtBQUFPLDBCQUcxQixLQUFLO0FBQUssa0JBR1YsS0FBSztBQUFLLG9CQUdWLEtBQUs7QUFBSywwQkFHVixLQUFLO0FBQUssb0JBR1YsS0FBSztBQUFLLG1CQUdWLEtBQUs7QUFBSyxxQkFHVixNQUFNO0FBQUsscUJBR1gsTUFBTTtBQUFLLG9CQWVYLFlBQVksU0FBQyxPQUFPO0FBQ25COzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRGlyZWN0aXZlLFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBIb3N0TGlzdGVuZXIsXG4gIEluamVjdCxcbiAgT25Jbml0LFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgU2ltcGxlQ2hhbmdlLFxuICBFdmVudEVtaXR0ZXIsXG4gIEVsZW1lbnRSZWYsXG4gIENoYW5nZURldGVjdG9yUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgTWV0YSB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xuaW1wb3J0IHsgUGxhdGZvcm0gfSBmcm9tICdAYW5ndWxhci9jZGsvcGxhdGZvcm0nO1xuaW1wb3J0IHsgQ2xpcGJvYXJkIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NsaXBib2FyZCc7XG5pbXBvcnQgeyBFTVBUWSwgT2JzZXJ2YWJsZSwgU3ViamVjdCwgU3Vic2NyaWJlciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFrZVVudGlsLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IFNoYXJlU2VydmljZSB9IGZyb20gJy4vc2hhcmUuc2VydmljZSc7XG5pbXBvcnQgeyBJU2hhcmVCdXR0b24sIFNoYXJlRGlyZWN0aXZlVXBkYXRlciwgU2hhcmVQYXJhbXMsIFNoYXJlUGFyYW1zRnVuYywgU2hhcmVyTWV0aG9kIH0gZnJvbSAnLi9zaGFyZS5tb2RlbHMnO1xuaW1wb3J0IHsgZ2V0VmFsaWRVcmwgfSBmcm9tICcuL3V0aWxzJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3NoYXJlQnV0dG9uXScsXG4gIGV4cG9ydEFzOiAnc2hhcmVCdXR0b24nXG59KVxuZXhwb3J0IGNsYXNzIFNoYXJlRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG5cbiAgLyoqIFZhcmlhYmxlIHVzZWQgdG8gY2hlY2sgZm9yIHRoZSBmaW5hbCBzaGFyZXIgdXJsIChGb3IgdGVzdGluZyBvbmx5KSAqL1xuICBwcml2YXRlIF9maW5hbFVybDogc3RyaW5nO1xuXG4gIC8qKiBTaGFyZSBkaXJlY3RpdmUgZWxlbWVudCByZWYgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfZWw6IEhUTUxCdXR0b25FbGVtZW50O1xuXG4gIC8qKiBBIHJlZiB0byBidXR0b24gY2xhc3MgLSB1c2VkIHRvIHJlbW92ZSBwcmV2aW91cyBjbGFzcyB3aGVuIHRoZSBidXR0b24gdHlwZSBpcyBjaGFuZ2VkICovXG4gIHByaXZhdGUgX2J1dHRvbkNsYXNzOiBzdHJpbmc7XG5cbiAgLyoqIFN0cmVhbSB0aGF0IGVtaXRzIHdoZW4gYnV0dG9uIGlzIGRlc3Ryb3llZCAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9kZXN0cm95ZWQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gIC8qKiBTdHJlYW0gdGhhdCBlbWl0IHdoZW4gc2hhcmUgYnV0dG9uIG5lZWQgdG8gYmUgdXBkYXRlZCAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF91cGRhdGVyID0gbmV3IFN1YmplY3Q8U2hhcmVEaXJlY3RpdmVVcGRhdGVyPigpO1xuXG4gIC8qKiBTaGFyZSBidXR0b24gcHJvcGVydGllcyAqL1xuICBzaGFyZUJ1dHRvbjogSVNoYXJlQnV0dG9uO1xuXG4gIC8qKiBTaGFyZSBidXR0b24gY29sb3IgKi9cbiAgY29sb3I6IHN0cmluZztcblxuICAvKiogU2hhcmUgYnV0dG9uIHRleHQgKi9cbiAgdGV4dDogc3RyaW5nO1xuXG4gIC8qKiBTaGFyZSBidXR0b24gaWNvbiAqL1xuICBpY29uOiBzdHJpbmcgfCBzdHJpbmdbXTtcblxuICAvKiogU2hhcmUgYnV0dG9uIHR5cGUgKi9cbiAgQElucHV0KCdzaGFyZUJ1dHRvbicpIHNoYXJlQnV0dG9uTmFtZTogc3RyaW5nO1xuXG4gIC8qKiBTZXQgbWV0YSB0YWdzIGZyb20gZG9jdW1lbnQgaGVhZCwgdXNlZnVsIHdoZW4gU0VPIGlzIHN1cHBvcnRlZCAqL1xuICBASW5wdXQoKSBhdXRvU2V0TWV0YTogYm9vbGVhbiA9IHRoaXMuX3NoYXJlLmNvbmZpZy5hdXRvU2V0TWV0YTtcblxuICAvKiogU2hhcmluZyBsaW5rICovXG4gIEBJbnB1dCgpIHVybDogc3RyaW5nID0gdGhpcy5fc2hhcmUuY29uZmlnLnVybDtcblxuICAvKiogU2V0cyB0aGUgdGl0bGUgcGFyYW1ldGVyICovXG4gIEBJbnB1dCgpIHRpdGxlOiBzdHJpbmcgPSB0aGlzLl9zaGFyZS5jb25maWcudGl0bGU7XG5cbiAgLyoqIFNldHMgdGhlIGRlc2NyaXB0aW9uIHBhcmFtZXRlciAqL1xuICBASW5wdXQoKSBkZXNjcmlwdGlvbjogc3RyaW5nID0gdGhpcy5fc2hhcmUuY29uZmlnLmRlc2NyaXB0aW9uO1xuXG4gIC8qKiBTZXRzIHRoZSBpbWFnZSBwYXJhbWV0ZXIgZm9yIHNoYXJpbmcgb24gUGludGVyZXN0ICovXG4gIEBJbnB1dCgpIGltYWdlOiBzdHJpbmcgPSB0aGlzLl9zaGFyZS5jb25maWcuaW1hZ2U7XG5cbiAgLyoqIFNldHMgdGhlIHRhZ3MgcGFyYW1ldGVyIGZvciBzaGFyaW5nIG9uIFR3aXR0ZXIgYW5kIFR1bWJsciAqL1xuICBASW5wdXQoKSB0YWdzOiBzdHJpbmcgPSB0aGlzLl9zaGFyZS5jb25maWcudGFncztcblxuICAvKiogU3RyZWFtIHRoYXQgZW1pdHMgd2hlbiBzaGFyZSBkaWFsb2cgaXMgb3BlbmVkICovXG4gIEBPdXRwdXQoKSBvcGVuZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcblxuICAvKiogU3RyZWFtIHRoYXQgZW1pdHMgd2hlbiBzaGFyZSBkaWFsb2cgaXMgY2xvc2VkICovXG4gIEBPdXRwdXQoKSBjbG9zZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcblxuICBjb25zdHJ1Y3RvcihfZWw6IEVsZW1lbnRSZWYsXG4gICAgICAgICAgICAgIHByaXZhdGUgX21ldGE6IE1ldGEsXG4gICAgICAgICAgICAgIHByaXZhdGUgX3BsYXRmb3JtOiBQbGF0Zm9ybSxcbiAgICAgICAgICAgICAgcHJpdmF0ZSBfY2xpcGJvYXJkOiBDbGlwYm9hcmQsXG4gICAgICAgICAgICAgIHByaXZhdGUgX3NoYXJlOiBTaGFyZVNlcnZpY2UsXG4gICAgICAgICAgICAgIHByaXZhdGUgX2NkOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICAgICAgICAgICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBfZG9jdW1lbnQ6IGFueSkge1xuICAgIHRoaXMuX2VsID0gX2VsLm5hdGl2ZUVsZW1lbnQ7XG4gIH1cblxuICAvKipcbiAgICogU2hhcmUgdGhlIGxpbmtcbiAgICovXG4gIEBIb3N0TGlzdGVuZXIoJ2NsaWNrJylcbiAgc2hhcmUoKSB7XG4gICAgLy8gQXZvaWQgU1NSIGVycm9yXG4gICAgaWYgKHRoaXMuX3BsYXRmb3JtLmlzQnJvd3NlciAmJiB0aGlzLnNoYXJlQnV0dG9uKSB7XG4gICAgICAvLyBQcmVwYXJlIHNoYXJlciB1cmwgcGFyYW1zXG4gICAgICBjb25zdCBwYXJhbXM6IFNoYXJlUGFyYW1zID0gdGhpcy5hdXRvU2V0TWV0YSA/IHRoaXMuZ2V0UGFyYW1zRnJvbU1ldGFUYWdzKCkgOiB0aGlzLmdldFBhcmFtc0Zyb21JbnB1dHMoKTtcblxuICAgICAgLy8gUHJlcGFyZSBzaGFyZSBidXR0b24gY2xpY2tcbiAgICAgIGNvbnN0IGNsaWNrID0gdGhpcy5zaGFyZUJ1dHRvbi5zaGFyZSA/IHRoaXMub3BlbihwYXJhbXMpIDogdGhpcy5zaGFyZUJ1dHRvbi5mdW5jKHtcbiAgICAgICAgcGFyYW1zLFxuICAgICAgICBkYXRhOiB0aGlzLnNoYXJlQnV0dG9uLmRhdGEsXG4gICAgICAgIGNsaXBib2FyZDogdGhpcy5fY2xpcGJvYXJkLFxuICAgICAgICB1cGRhdGVyOiB0aGlzLl91cGRhdGVyXG4gICAgICB9KTtcblxuICAgICAgY2xpY2sucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkKSkuc3Vic2NyaWJlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybihgJHsgdGhpcy50ZXh0IH0gYnV0dG9uIGlzIG5vdCBjb21wYXRpYmxlIG9uIHRoaXMgUGxhdGZvcm1gKTtcbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICAvLyBUaGlzIHN0cmVhbSBpcyBtYWlubHkgdXNlZCB0byB1cGRhdGUgdGhlIGNvcHkgYnV0dG9uIHRleHQgYW5kIGljb24gd2hlbiBpdCBpcyBiZWluZyBjbGlja2VkXG4gICAgdGhpcy5fdXBkYXRlci5waXBlKFxuICAgICAgdGFwKChkYXRhOiBhbnkpID0+IHtcbiAgICAgICAgdGhpcy5pY29uID0gZGF0YS5pY29uO1xuICAgICAgICB0aGlzLnRleHQgPSBkYXRhLnRleHQ7XG4gICAgICAgIHRoaXMuX2VsLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBkYXRhLmRpc2FibGVkID8gJ25vbmUnIDogJ2F1dG8nO1xuICAgICAgICB0aGlzLl9jZC5tYXJrRm9yQ2hlY2soKTtcbiAgICAgIH0pLFxuICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZClcbiAgICApLnN1YnNjcmliZSgpO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIC8vIEF2b2lkIFNTUiBlcnJvclxuICAgIGlmICh0aGlzLl9wbGF0Zm9ybS5pc0Jyb3dzZXIpIHtcblxuICAgICAgLy8gQ3JlYXRlIHNoYXJlIGJ1dHRvblxuICAgICAgaWYgKHRoaXMuX3NoYXJlQnV0dG9uQ2hhbmdlZChjaGFuZ2VzLnNoYXJlQnV0dG9uTmFtZSkpIHtcbiAgICAgICAgdGhpcy5fY3JlYXRlU2hhcmVCdXR0b24oKTtcbiAgICAgIH1cbiAgICAgIC8vIFByZXBhcmUgc2hhcmUgdXJsXG4gICAgICBpZiAodGhpcy5fdXJsQ2hhbmdlZChjaGFuZ2VzLnVybCkpIHtcbiAgICAgICAgdGhpcy51cmwgPSBnZXRWYWxpZFVybChcbiAgICAgICAgICB0aGlzLmF1dG9TZXRNZXRhXG4gICAgICAgICAgICA/IHRoaXMudXJsIHx8IHRoaXMuX2dldE1ldGFUYWdDb250ZW50KCdvZzp1cmwnKVxuICAgICAgICAgICAgOiB0aGlzLnVybCxcbiAgICAgICAgICB0aGlzLl9kb2N1bWVudC5kZWZhdWx0Vmlldy5sb2NhdGlvbi5ocmVmXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5fZGVzdHJveWVkLm5leHQoKTtcbiAgICB0aGlzLl9kZXN0cm95ZWQuY29tcGxldGUoKTtcbiAgfVxuXG4gIHByaXZhdGUgX2NyZWF0ZVNoYXJlQnV0dG9uKCkge1xuICAgIGNvbnN0IGJ1dHRvbjogSVNoYXJlQnV0dG9uID0gdGhpcy5fc2hhcmUuY29uZmlnLnByb3BbdGhpcy5zaGFyZUJ1dHRvbk5hbWVdO1xuICAgIGlmIChidXR0b24pIHtcbiAgICAgIC8vIFNldCBzaGFyZSBidXR0b24gcHJvcGVydGllc1xuICAgICAgdGhpcy5zaGFyZUJ1dHRvbiA9IGJ1dHRvbjtcblxuICAgICAgLy8gUmVtb3ZlIHByZXZpb3VzIGJ1dHRvbiBjbGFzc1xuICAgICAgdGhpcy5fZWwuY2xhc3NMaXN0LnJlbW92ZShgc2ItJHsgdGhpcy5fYnV0dG9uQ2xhc3MgfWApO1xuXG4gICAgICAvLyBBZGQgbmV3IGJ1dHRvbiBjbGFzc1xuICAgICAgdGhpcy5fZWwuY2xhc3NMaXN0LmFkZChgc2ItJHsgdGhpcy5zaGFyZUJ1dHRvbk5hbWUgfWApO1xuXG4gICAgICAvLyBTZXQgYnV0dG9uIGNzcyBjb2xvciB2YXJpYWJsZVxuICAgICAgdGhpcy5fZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0tYnV0dG9uLWNvbG9yJywgdGhpcy5zaGFyZUJ1dHRvbi5jb2xvcik7XG5cbiAgICAgIC8vIEtlZXAgYSBjb3B5IG9mIHRoZSBjbGFzcyBmb3IgZnV0dXJlIHJlcGxhY2VtZW50XG4gICAgICB0aGlzLl9idXR0b25DbGFzcyA9IHRoaXMuc2hhcmVCdXR0b25OYW1lO1xuXG4gICAgICB0aGlzLmNvbG9yID0gdGhpcy5zaGFyZUJ1dHRvbi5jb2xvcjtcbiAgICAgIHRoaXMudGV4dCA9IHRoaXMuc2hhcmVCdXR0b24udGV4dDtcbiAgICAgIHRoaXMuaWNvbiA9IHRoaXMuc2hhcmVCdXR0b24uaWNvbjtcblxuICAgICAgLy8gU2V0IGFyaWEtbGFiZWwgYXR0cmlidXRlXG4gICAgICB0aGlzLl9lbC5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBidXR0b24uYXJpYUxhYmVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5lcnJvcihgW1NoYXJlQnV0dG9uc106IFRoZSBzaGFyZSBidXR0b24gJyR7IHRoaXMuc2hhcmVCdXR0b25OYW1lIH0nIGRvZXMgbm90IGV4aXN0IWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbWV0YSB0YWcgY29udGVudFxuICAgKi9cbiAgcHJpdmF0ZSBfZ2V0TWV0YVRhZ0NvbnRlbnQoa2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IG1ldGFVc2luZ1Byb3BlcnR5OiBIVE1MTWV0YUVsZW1lbnQgPSB0aGlzLl9tZXRhLmdldFRhZyhgcHJvcGVydHk9XCIkeyBrZXkgfVwiYCk7XG4gICAgaWYgKG1ldGFVc2luZ1Byb3BlcnR5KSB7XG4gICAgICByZXR1cm4gbWV0YVVzaW5nUHJvcGVydHkuZ2V0QXR0cmlidXRlKCdjb250ZW50Jyk7XG4gICAgfVxuICAgIGNvbnN0IG1ldGFVc2luZ05hbWU6IEhUTUxNZXRhRWxlbWVudCA9IHRoaXMuX21ldGEuZ2V0VGFnKGBuYW1lPVwiJHsga2V5IH1cImApO1xuICAgIGlmIChtZXRhVXNpbmdOYW1lKSB7XG4gICAgICByZXR1cm4gbWV0YVVzaW5nTmFtZS5nZXRBdHRyaWJ1dGUoJ2NvbnRlbnQnKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9zaGFyZUJ1dHRvbkNoYW5nZWQoY2hhbmdlOiBTaW1wbGVDaGFuZ2UpOiBib29sZWFuIHtcbiAgICByZXR1cm4gY2hhbmdlICYmIChjaGFuZ2UuZmlyc3RDaGFuZ2UgfHwgY2hhbmdlLnByZXZpb3VzVmFsdWUgIT09IGNoYW5nZS5jdXJyZW50VmFsdWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBfdXJsQ2hhbmdlZChjaGFuZ2U6IFNpbXBsZUNoYW5nZSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy51cmwgfHwgKGNoYW5nZSAmJiBjaGFuZ2UucHJldmlvdXNWYWx1ZSAhPT0gY2hhbmdlLmN1cnJlbnRWYWx1ZSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNoYXJlIHBhcmFtcyBmcm9tIG1ldGEgdGFncyBmaXJzdCBhbmQgZmFsbGJhY2sgdG8gdXNlciBpbnB1dHNcbiAgICovXG4gIHByaXZhdGUgZ2V0UGFyYW1zRnJvbU1ldGFUYWdzKCk6IFNoYXJlUGFyYW1zIHtcbiAgICByZXR1cm4ge1xuICAgICAgdXJsOiB0aGlzLnVybCxcbiAgICAgIHRpdGxlOiB0aGlzLnRpdGxlIHx8IHRoaXMuX2dldE1ldGFUYWdDb250ZW50KCdvZzp0aXRsZScpLFxuICAgICAgZGVzY3JpcHRpb246IHRoaXMuZGVzY3JpcHRpb24gfHwgdGhpcy5fZ2V0TWV0YVRhZ0NvbnRlbnQoJ29nOmRlc2NyaXB0aW9uJyksXG4gICAgICBpbWFnZTogdGhpcy5pbWFnZSB8fCB0aGlzLl9nZXRNZXRhVGFnQ29udGVudCgnb2c6aW1hZ2UnKSxcbiAgICAgIHZpYTogdGhpcy5fc2hhcmUuY29uZmlnLnR3aXR0ZXJBY2NvdW50LFxuICAgICAgdGFnczogdGhpcy50YWdzXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc2hhcmUgcGFyYW1zIGZyb20gdXNlciBpbnB1dHNcbiAgICovXG4gIHByaXZhdGUgZ2V0UGFyYW1zRnJvbUlucHV0cygpOiBTaGFyZVBhcmFtcyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVybDogdGhpcy51cmwsXG4gICAgICB0aXRsZTogdGhpcy50aXRsZSxcbiAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uLFxuICAgICAgaW1hZ2U6IHRoaXMuaW1hZ2UsXG4gICAgICB0YWdzOiB0aGlzLnRhZ3MsXG4gICAgICB2aWE6IHRoaXMuX3NoYXJlLmNvbmZpZy50d2l0dGVyQWNjb3VudCxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBvcGVuKHBhcmFtczogU2hhcmVQYXJhbXMpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcbiAgICAvLyBTZXQgc2hhcmVyIGxpbmsgYmFzZWQgb24gdXNlcidzIGRldmljZVxuICAgIGxldCBzaGFyZXJMaW5rOiBzdHJpbmc7XG4gICAgaWYgKHRoaXMuX3BsYXRmb3JtLklPUyAmJiB0aGlzLnNoYXJlQnV0dG9uLnNoYXJlLmlvcykge1xuICAgICAgc2hhcmVyTGluayA9IHRoaXMuc2hhcmVCdXR0b24uc2hhcmUuaW9zO1xuICAgIH0gZWxzZSBpZiAodGhpcy5fcGxhdGZvcm0uQU5EUk9JRCAmJiB0aGlzLnNoYXJlQnV0dG9uLnNoYXJlLmFuZHJvaWQpIHtcbiAgICAgIHNoYXJlckxpbmsgPSB0aGlzLnNoYXJlQnV0dG9uLnNoYXJlLmFuZHJvaWQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNoYXJlckxpbmsgPSB0aGlzLnNoYXJlQnV0dG9uLnNoYXJlLmRlc2t0b3A7XG4gICAgfVxuXG4gICAgaWYgKHNoYXJlckxpbmspIHtcbiAgICAgIC8vIFNldCBzaGFyZXIgbGluayBwYXJhbXNcbiAgICAgIHRoaXMuX2ZpbmFsVXJsID0gc2hhcmVyTGluayArIHRoaXMuX3NlcmlhbGl6ZVBhcmFtcyhwYXJhbXMpO1xuXG4gICAgICAvLyBMb2cgdGhlIHNoYXJlciBsaW5rIGluIGRlYnVnIG1vZGVcbiAgICAgIGlmICh0aGlzLl9zaGFyZS5jb25maWcuZGVidWcpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tERUJVRyBTSEFSRSBCVVRUT05dOiAnLCB0aGlzLl9maW5hbFVybCk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9wZW4gdGhlIHNoYXJlIHdpbmRvd1xuICAgICAgLy8gVGhlcmUgYXJlIHR3byBtZXRob2RzIGF2YWlsYWJsZSBmb3Igb3BlbmluZyB0aGUgc2hhcmUgd2luZG93OlxuICAgICAgLy8gMS4gVXNpbmcgYSByZWFsIGFuY2hvclxuICAgICAgLy8gMi4gVXNpbmcgd2luZG93Lm9wZW5cbiAgICAgIGNvbnN0IHNoYXJlck1ldGhvZCA9IHRoaXMuc2hhcmVCdXR0b24ubWV0aG9kIHx8IHRoaXMuX3NoYXJlLmNvbmZpZy5zaGFyZXJNZXRob2Q7XG4gICAgICBjb25zdCBzaGFyZXJUYXJnZXQgPSB0aGlzLnNoYXJlQnV0dG9uLnRhcmdldCB8fCB0aGlzLl9zaGFyZS5jb25maWcuc2hhcmVyVGFyZ2V0O1xuXG4gICAgICBzd2l0Y2ggKHNoYXJlck1ldGhvZCkge1xuXG4gICAgICAgIGNhc2UgU2hhcmVyTWV0aG9kLkFuY2hvcjpcbiAgICAgICAgICBjb25zdCBsaW5rRWxlbWVudDogSFRNTExpbmtFbGVtZW50ID0gdGhpcy5fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgICAgIC8vIE1ha2UgaXQgb3BlbiBpbiBhIG5ldyB0YWIvd2luZG93IChkZXBlbmRzIG9uIHVzZXIncyBicm93c2VyIGNvbmZpZ3VyYXRpb24pXG4gICAgICAgICAgbGlua0VsZW1lbnQuc2V0QXR0cmlidXRlKCd0YXJnZXQnLCBzaGFyZXJUYXJnZXQpO1xuXG4gICAgICAgICAgLy8gUHJldmVudCBzZWN1cml0eSB2dWxuZXJhYmlsaXR5IGh0dHBzOi8vbWVkaXVtLmNvbS9Aaml0Yml0L3RhcmdldC1ibGFuay10aGUtbW9zdC11bmRlcmVzdGltYXRlZC12dWxuZXJhYmlsaXR5LWV2ZXItOTZlMzI4MzAxZjRjXG4gICAgICAgICAgbGlua0VsZW1lbnQuc2V0QXR0cmlidXRlKCdyZWwnLCAnbm9vcGVuZXIgbm9yZWZlcnJlcicpO1xuICAgICAgICAgIGxpbmtFbGVtZW50LmhyZWYgPSB0aGlzLl9maW5hbFVybDtcbiAgICAgICAgICBsaW5rRWxlbWVudC5jbGljaygpO1xuICAgICAgICAgIGxpbmtFbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgU2hhcmVyTWV0aG9kLldpbmRvdzpcbiAgICAgICAgICAvLyBPcGVuIGxpbmsgdXNpbmcgV2luZG93IG9iamVjdFxuICAgICAgICAgIGNvbnN0IG9wZW5XaW5kb3cgPSB0aGlzLl9zaGFyZS5jb25maWcud2luZG93T2JqW3RoaXMuX3NoYXJlLmNvbmZpZy53aW5kb3dGdW5jTmFtZV07XG4gICAgICAgICAgY29uc3QgcG9wVXBXaW5kb3cgPSBvcGVuV2luZG93KHRoaXMuX2ZpbmFsVXJsLCBzaGFyZXJUYXJnZXQsIHRoaXMuX3NoYXJlLndpbmRvd1NpemUpO1xuXG4gICAgICAgICAgLy8gUHJldmVudCBzZWN1cml0eSB2dWxuZXJhYmlsaXR5IGh0dHBzOi8vbWVkaXVtLmNvbS9Aaml0Yml0L3RhcmdldC1ibGFuay10aGUtbW9zdC11bmRlcmVzdGltYXRlZC12dWxuZXJhYmlsaXR5LWV2ZXItOTZlMzI4MzAxZjRjXG4gICAgICAgICAgdGhpcy5fc2hhcmUuY29uZmlnLndpbmRvd09iai5vcGVuZXIgPSBudWxsO1xuXG4gICAgICAgICAgLy8gUmVzb2x2ZSB3aGVuIHNoYXJlIGRpYWxvZyBpcyBjbG9zZWRcbiAgICAgICAgICBpZiAocG9wVXBXaW5kb3cpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZTx2b2lkPigoc3ViOiBTdWJzY3JpYmVyPHZvaWQ+KSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHBvbGxUaW1lciA9IHRoaXMuX2RvY3VtZW50LmRlZmF1bHRWaWV3LnNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocG9wVXBXaW5kb3cuY2xvc2VkKSB7XG4gICAgICAgICAgICAgICAgICB0aGlzLl9kb2N1bWVudC5kZWZhdWx0Vmlldy5jbGVhckludGVydmFsKHBvbGxUaW1lcik7XG5cbiAgICAgICAgICAgICAgICAgIC8vIEVtaXQgd2hlbiBzaGFyZSB3aW5kb3dzIGlzIGNsb3NlZFxuICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZWQuZW1pdCh0aGlzLnNoYXJlQnV0dG9uTmFtZSk7XG4gICAgICAgICAgICAgICAgICBzdWIubmV4dCgpO1xuICAgICAgICAgICAgICAgICAgc3ViLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LCAyMDApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICAvLyBFbWl0IHdoZW4gc2hhcmUgd2luZG93IGlzIG9wZW5lZFxuICAgICAgdGhpcy5vcGVuZWQuZW1pdCh0aGlzLnNoYXJlQnV0dG9uTmFtZSk7XG4gICAgfVxuICAgIHJldHVybiBFTVBUWTtcbiAgfVxuXG4gIHByaXZhdGUgX3NlcmlhbGl6ZVBhcmFtcyhwYXJhbXM6IFNoYXJlUGFyYW1zKTogc3RyaW5nIHtcbiAgICByZXR1cm4gT2JqZWN0LmVudHJpZXModGhpcy5zaGFyZUJ1dHRvbi5wYXJhbXMpXG4gICAgLm1hcCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAvLyBDaGVjayBpZiBzaGFyZSBidXR0b24gcGFyYW0gaGFzIGEgbWFwIGZ1bmN0aW9uXG4gICAgICBjb25zdCBwYXJhbUZ1bmM6IFNoYXJlUGFyYW1zRnVuYyA9IHRoaXMuc2hhcmVCdXR0b24ucGFyYW1zRnVuYyA/IHRoaXMuc2hhcmVCdXR0b24ucGFyYW1zRnVuY1trZXldIDogbnVsbDtcblxuICAgICAgaWYgKHBhcmFtc1trZXldIHx8IHBhcmFtRnVuYykge1xuICAgICAgICBjb25zdCBwYXJhbVZhbHVlID0gcGFyYW1GdW5jID8gcGFyYW1GdW5jKHBhcmFtcykgOiBwYXJhbXNba2V5XTtcbiAgICAgICAgcmV0dXJuIGAkeyB2YWx1ZSB9PSR7IGVuY29kZVVSSUNvbXBvbmVudChwYXJhbVZhbHVlKSB9YDtcbiAgICAgIH1cbiAgICAgIHJldHVybiAnJztcbiAgICB9KVxuICAgIC5maWx0ZXIodXJsUGFyYW0gPT4gdXJsUGFyYW0gIT09ICcnKVxuICAgIC5qb2luKCcmJyk7XG4gIH1cbn1cbiJdfQ==